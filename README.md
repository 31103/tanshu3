# 短期滞在手術等基本料３判定プログラム

## 概要

このプログラムは、DPC対象病院において、入院EF統合ファイルから短期滞在手術等基本料３（以下「短手３」）に該当する症例を自動で判別するためのツールです。医療機関における対象症例の効率的な抽出と、適切な診療報酬請求を支援します。

## 主な機能

- 入院EF統合ファイルの読み込み（タブ区切りテキスト形式）
- 連続した複数月のファイルを一括処理（月をまたぐ患者データの追跡）
- 短手３の判定条件に基づいた該当症例の抽出
- ファイル形式の自動検証（エラー/警告の表示）
- 日付フォーマット選択（YYYYMMDD / YYYY/MM/DD）
- 結果のタブ区切りテキストファイル出力
- 結果のクリップボードコピー機能
- ドラッグ＆ドロップによるファイル選択

## 動作環境

- **OS**: Windows 10以上
- **ブラウザ**: Google Chrome、Microsoft Edge、Firefox（最新版推奨）
- **その他**: ローカル環境で動作（インターネット接続不要、`file://` プロトコル対応）

## 使用方法

1. `index.html` をブラウザで開く
2. 「ファイルを選択」ボタンから入院EF統合ファイルを選択（複数選択可能）、またはファイルをドラッグ＆ドロップ
3. 出力オプション（全症例/対象症例のみ、日付フォーマット）を選択
4. 「実行」ボタンをクリックして処理を開始
5. 処理完了後、短手３該当症例の一覧が表示される
6. 「結果をダウンロード」ボタンで結果をファイルとして保存、または「クリップボードにコピー」で結果をコピー
7. 「クリア」ボタンでファイル選択や結果表示をリセット

## 開発者向け情報

### セットアップ

```powershell
# リポジトリのクローン
git clone https://github.com/31103/tanshu3.git
cd tanshu3

# 依存パッケージのインストール
npm install

# ビルド
npm run build
```

### 開発環境

- **Node.js**: 18.x以上
- **パッケージマネージャ**: npm
- **ビルドツール**: Parcel v2
- **言語**: TypeScript
- **テスト**: Jest + jsdom
- **コード品質**: ESLint v9 + Prettier

### ファイル構成

```
tanshu3/
├── .github/                # GitHub Actionsなどの設定
├── .husky/                 # Gitフック設定
├── coverage/               # テストカバレッジレポート
├── dist/                   # ビルド出力ディレクトリ
├── docs/                   # ドキュメント
│   ├── 短期滞在手術等基本料３について.md # 短手３判定ロジック詳細
│   └── 入院EF統合ファイルについて.md   # EFファイル仕様
├── memory-bank/            # プロジェクトメモリーバンク
├── public/                 # 公開ファイル (ブラウザで直接アクセス)
├── src/                    # ソースコード (TypeScript)
│   ├── browser/            # ブラウザ環境依存コード
│   ├── core/               # コアロジック (ブラウザ/Node.js共通)
│   └── ui/                 # UI関連コード
└── test/                   # テストコード
    ├── fixtures/           # テスト用データ
    └── jest/               # Jestテスト
```

### コマンド一覧

| コマンド                | 説明                                   |
| ----------------------- | -------------------------------------- |
| `npm start`             | 開発サーバー起動（ホットリロード対応） |
| `npm run build`         | プロダクション用ビルド                 |
| `npm test`              | すべてのテスト実行                     |
| `npm run test:coverage` | テストカバレッジレポート生成           |
| `npm run lint`          | ESLintによるコード検証                 |
| `npm run lint:fix`      | ESLintによるコード検証と自動修正       |
| `npm run check-format`  | Prettierによるフォーマット検証         |
| `npm run check-all`     | すべての検証を実行                     |

## 短手３判定ロジック

短期滞在手術等基本料３に該当する主な条件：

1. 入院中に対象手術等（特定の診療行為コード）を1つのみ実施
2. 入院期間が5日以内
3. 入院期間中に他の手術を実施していない
4. 特定の加算を算定していない（内視鏡的大腸ポリープ・粘膜切除術の場合）

詳細は `docs/短期滞在手術等基本料３について.md` を参照してください。

## トラブルシューティング

| 問題                   | 対処方法                                                               |
| ---------------------- | ---------------------------------------------------------------------- |
| ファイルが読み込めない | ファイル形式（タブ区切りテキスト）を確認してください                   |
| 処理が遅い             | 大量データの場合は処理に時間がかかります。ブラウザを閉じないでください |
| 判定結果が期待と異なる | `docs/短期滞在手術等基本料３について.md` の条件を確認してください      |
| エラーが表示される     | ブラウザのコンソールに表示されるエラーメッセージを確認してください     |

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。詳細は `LICENSE` ファイルをご覧ください。
