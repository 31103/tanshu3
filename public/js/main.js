var y=class{toastContainer;activeToasts=[];toastHistory=[];MAX_VISIBLE_TOASTS=3;MAX_HISTORY_ITEMS=10;constructor(e="toastContainer"){this.toastContainer=document.getElementById(e)||this.createToastContainer(e),this.setupHistoryButton()}createToastContainer(e){let t=document.createElement("div");return t.id=e,t.className="toast-container",document.body.appendChild(t),t}setupHistoryButton(){let e=document.getElementById("notificationHistoryButton");e||(e=document.createElement("button"),e.id="notificationHistoryButton",e.className="notification-history-button hidden",e.setAttribute("aria-label","\u901A\u77E5\u5C65\u6B74\u3092\u8868\u793A"),e.innerHTML='<span class="history-icon">\u{1F514}</span>',document.body.appendChild(e),e.addEventListener("click",()=>this.showNotificationHistory()))}showToast(e,t,i,s=5e3,a=3){let r=Date.now(),o="toast-"+r,l={id:o,type:e,title:t,message:i,timestamp:r,priority:a,duration:s};this.addToastToHistory(l),this.activeToasts.push(l),this.activeToasts.sort((c,d)=>c.priority!==d.priority?d.priority-c.priority:d.timestamp-c.timestamp),this.manageActiveToasts(),this.activeToasts.some(c=>c.id===o)&&this.renderToast(l)}addToastToHistory(e){this.toastHistory.unshift({type:e.type,title:e.title,message:e.message,timestamp:e.timestamp}),this.toastHistory.length>this.MAX_HISTORY_ITEMS&&(this.toastHistory=this.toastHistory.slice(0,this.MAX_HISTORY_ITEMS)),this.updateHistoryButton()}updateHistoryButton(){let e=document.getElementById("notificationHistoryButton");e&&this.toastHistory.length>0&&(e.classList.remove("hidden"),e.setAttribute("data-count",this.toastHistory.length.toString()))}manageActiveToasts(){if(this.activeToasts.sort((e,t)=>e.priority!==t.priority?t.priority-e.priority:t.timestamp-e.timestamp),this.activeToasts.length>this.MAX_VISIBLE_TOASTS){let e=this.activeToasts.slice(0,this.MAX_VISIBLE_TOASTS);this.activeToasts.slice(this.MAX_VISIBLE_TOASTS).forEach(i=>{i.element&&this.removeToastElement(i.id)}),this.activeToasts=e}}showNotificationHistory(){let e=document.getElementById("notificationHistoryModal");e&&e.parentNode?.removeChild(e);let t=document.createElement("div");t.id="notificationHistoryModal",t.className="notification-history-modal",t.setAttribute("role","dialog"),t.setAttribute("aria-labelledby","notificationHistoryTitle"),t.setAttribute("aria-modal","true");let i="";this.toastHistory.forEach(r=>{if(r.timestamp){let l=new Date(r.timestamp).toLocaleTimeString();i+=`
          <div class="history-item history-item-${r.type}">
            <div class="history-item-time">${l}</div>
            <div class="history-item-content">
              <h4 class="history-item-title">${r.title||""}</h4>
              <p class="history-item-message">${r.message||""}</p>
            </div>
          </div>
        `}}),t.innerHTML=`
      <div class="notification-history-content">
        <div class="notification-history-header">
          <h3 id="notificationHistoryTitle">\u901A\u77E5\u5C65\u6B74</h3>
          <button class="notification-history-close" aria-label="\u5C65\u6B74\u3092\u9589\u3058\u308B">\xD7</button>
        </div>
        <div class="notification-history-list">
          ${i.length?i:'<p class="no-history">\u901A\u77E5\u5C65\u6B74\u306F\u3042\u308A\u307E\u305B\u3093</p>'}
        </div>
        <div class="notification-history-footer">
          <button class="secondary-button notification-history-clear">\u5C65\u6B74\u3092\u30AF\u30EA\u30A2</button>
          <button class="primary-button notification-history-close-btn">\u9589\u3058\u308B</button>
        </div>
      </div>
    `,document.body.appendChild(t),setTimeout(()=>{t.classList.add("active")},10),t.querySelectorAll(".notification-history-close, .notification-history-close-btn").forEach(r=>{r.addEventListener("click",()=>{this.closeNotificationHistory()})}),t.querySelector(".notification-history-clear")?.addEventListener("click",()=>{this.clearNotificationHistory(),this.closeNotificationHistory()}),t.addEventListener("click",r=>{r.target===t&&this.closeNotificationHistory()}),document.addEventListener("keydown",this.handleHistoryEscKey)}handleHistoryEscKey=e=>{e.key==="Escape"&&this.closeNotificationHistory()};closeNotificationHistory(){let e=document.getElementById("notificationHistoryModal");e&&(e.classList.remove("active"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)),document.removeEventListener("keydown",this.handleHistoryEscKey)}clearNotificationHistory(){this.toastHistory=[],this.updateHistoryButton()}renderToast(e){let t=document.createElement("div");t.id=e.id,t.className=`toast toast-${e.type}`,t.setAttribute("role","alert"),t.setAttribute("aria-live","assertive");let i="";switch(e.type){case"success":i="\u2705";break;case"warning":i="\u26A0\uFE0F";break;case"error":i="\u274C";break;case"info":i="\u2139\uFE0F";break}t.innerHTML=`
      <div class="toast-icon">${i}</div>
      <div class="toast-content">
        <h3 class="toast-title">${e.title}</h3>
        <p class="toast-message">${e.message}</p>
      </div>
      <button class="toast-close" aria-label="\u901A\u77E5\u3092\u9589\u3058\u308B">\xD7</button>
    `,this.toastContainer.appendChild(t),e.element=t,t.querySelector(".toast-close")?.addEventListener("click",()=>{this.removeToast(e.id)}),e.duration>0&&setTimeout(()=>{this.removeToast(e.id)},e.duration)}removeToast(e){this.activeToasts=this.activeToasts.filter(t=>t.id!==e),this.removeToastElement(e)}removeToastElement(e){let t=document.getElementById(e);t&&(t.style.opacity="0",t.style.transform="translateX(100%)",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300))}showRecoveryToast(e){let t="toast-recovery-"+Date.now(),i=document.createElement("div");i.id=t,i.className="toast toast-info",i.setAttribute("role","alert"),i.setAttribute("aria-live","assertive"),i.innerHTML=`
      <div class="toast-icon">\u{1F504}</div>
      <div class="toast-content">
        <h3 class="toast-title">\u56DE\u5FA9\u30A2\u30AF\u30B7\u30E7\u30F3</h3>
        <p class="toast-message">${e.message}</p>
      </div>
      <button class="toast-action" aria-label="${e.label}">${e.label}</button>
      <button class="toast-close" aria-label="\u901A\u77E5\u3092\u9589\u3058\u308B">\xD7</button>
    `,this.toastContainer.appendChild(i),i.querySelector(".toast-action")?.addEventListener("click",()=>{e.handler(),this.removeToastElement(t)}),i.querySelector(".toast-close")?.addEventListener("click",()=>{this.removeToastElement(t)}),setTimeout(()=>{this.removeToastElement(t)},15e3)}},p=null;function h(){if(!p)if(typeof document>"u"||document.readyState==="loading")try{p=new y}catch(n){throw console.error("Failed to initialize NotificationSystem likely due to missing document.",n),new Error("NotificationSystem cannot be initialized without a document.")}else p=new y;if(!p)throw new Error("Failed to get NotificationSystem instance.");return p}async function S(n){if(!n||n.length===0)throw new Error("\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093");let e=[];for(let t of n)try{let i=await T(t),s=_(t,i);e.push(s)}catch{e.push({file:t,isValid:!1,warnings:[],errors:["\u4E0D\u660E\u306A\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F"]})}return e}function T(n){return!n.type.includes("text")&&!n.name.endsWith(".txt")?Promise.reject(new Error("Read error: Invalid file format")):new Promise((e,t)=>{let i=new FileReader;i.onload=s=>{typeof s.target?.result=="string"?e(s.target.result):t(new Error("Read error: Invalid file format"))},i.onerror=()=>{t(new Error("Read error: File read failed"))};try{i.readAsText(n)}catch{t(new Error("Read error: Cannot start reading file"))}})}function _(n,e){let t={file:n,isValid:!0,warnings:[],errors:[]};if(!k(e,t))return t;let i=e.split(/\r?\n/);return P(i[0],t),U(i,t),t}function k(n,e){return n.trim()?n.split(/\r?\n/).filter(i=>i.trim()).length<2?(e.isValid=!1,e.errors.push("\u30D5\u30A1\u30A4\u30EB\u304C\u7A7A\u304B\u3001\u30D8\u30C3\u30C0\u30FC\u884C\u307E\u305F\u306F\u30C7\u30FC\u30BF\u884C\u304C\u4E0D\u8DB3\u3057\u3066\u3044\u307E\u3059"),!1):!0:(e.isValid=!1,e.errors.push("\u30D5\u30A1\u30A4\u30EB\u304C\u7A7A\u3067\u3059"),!1)}function P(n,e){let t=n.trim();t?t.includes("	")||e.warnings.push("\u30D8\u30C3\u30C0\u30FC\u884C\u306B\u30BF\u30D6\u533A\u5207\u308A\u304C\u898B\u3089\u308C\u307E\u305B\u3093"):e.warnings.push("\u30D8\u30C3\u30C0\u30FC\u884C\u304C\u7A7A\u306E\u3088\u3046\u3067\u3059")}function U(n,e){let t=Math.min(5,n.length-1),i=!1,s=!1,a=!1;for(let r=1;r<=t;r++){if(n[r]===void 0)continue;let o=n[r].trim();if(!o)continue;let l=W(o,r,e);if(l.tabWarningIssued&&!i&&(e.warnings.push(`\u4E00\u90E8\u306E\u30C7\u30FC\u30BF\u884C\u306B\u30BF\u30D6\u533A\u5207\u308A\u304C\u898B\u3089\u308C\u307E\u305B\u3093 (\u6700\u521D\u306E\u4F8B: \u884C ${r+1})`),i=!0),l.columnCountWarningIssued&&!s){let c=o.split("	");c.length<4?e.warnings.push(`\u4E00\u90E8\u306E\u30C7\u30FC\u30BF\u884C\u3067\u5165\u9662\u5E74\u6708\u65E5(4\u5217\u76EE)\u304C\u78BA\u8A8D\u3067\u304D\u307E\u305B\u3093 (\u5217\u6570\u4E0D\u8DB3) (\u6700\u521D\u306E\u4F8B: \u884C ${r+1})`):c.length<7?e.warnings.push(`\u4E00\u90E8\u306E\u30C7\u30FC\u30BF\u884C\u3067\u884C\u70BA\u660E\u7D30\u756A\u53F7(7\u5217\u76EE)\u304C\u78BA\u8A8D\u3067\u304D\u307E\u305B\u3093 (\u5217\u6570\u4E0D\u8DB3) (\u6700\u521D\u306E\u4F8B: \u884C ${r+1})`):e.warnings.push(`\u4E00\u90E8\u306E\u30C7\u30FC\u30BF\u884C\u306E\u5217\u6570\u304C\u5C11\u306A\u3044\u3088\u3046\u3067\u3059 (10\u5217\u672A\u6E80) (\u6700\u521D\u306E\u4F8B: \u884C ${r+1}, \u5217\u6570: ${c.length})`),s=!0}if(l.actionDetailNumWarningIssued&&!a){let c=o.split("	"),d=c.length>6?c[6].trim():"";e.warnings.push(`\u884C\u70BA\u660E\u7D30\u756A\u53F7(7\u5217\u76EE)\u306E\u5F62\u5F0F\u304C\u4E0D\u6B63\u306E\u3088\u3046\u3067\u3059 (000 or 3\u6841\u6570\u5B57) (\u6700\u521D\u306E\u4F8B: \u884C ${r+1}, \u5024: ${d})`),a=!0}}}function W(n,e,t){let i=!1,s=!1,a=!1;if(!n.includes("	"))return i=!0,{tabWarningIssued:i,columnCountWarningIssued:s,actionDetailNumWarningIssued:a};let r=n.split("	");if(r.length<10)return s=!0,{tabWarningIssued:i,columnCountWarningIssued:s,actionDetailNumWarningIssued:a};let o=Y(r,e,t);return s=o.columnCountWarningIssued,a=o.actionDetailNumWarningIssued,{tabWarningIssued:i,columnCountWarningIssued:s,actionDetailNumWarningIssued:a}}function Y(n,e,t){let i=!1,s=!1;if(n.length>3){let a=n[3].trim();/^(\d{8}|00000000)$/.test(a)||(t.isValid=!1,(t.errors.length===0||!t.errors.some(o=>o.startsWith("\u5165\u9662\u5E74\u6708\u65E5")))&&t.errors.push(`\u5165\u9662\u5E74\u6708\u65E5(4\u5217\u76EE)\u306E\u5F62\u5F0F\u304C\u4E0D\u6B63\u3067\u3059 (yyyymmdd or 00000000) (\u6700\u521D\u306E\u4F8B: \u884C ${e+1}, \u5024: ${a})`))}else i=!0;if(n.length>6){let a=n[6].trim();/^(000|\d{3})$/.test(a)||(s=!0)}else i||(i=!0);return{columnCountWarningIssued:i,actionDetailNumWarningIssued:s}}var v=class{fileInput;fileInfoArea;clearButton;executeButton;dropArea;selectedFiles=[];validFiles=0;notification;constructor(e){if(this.notification=e,this.fileInput=document.getElementById("fileInput"),this.fileInfoArea=document.getElementById("fileInfoArea"),this.clearButton=document.getElementById("clearButton"),this.executeButton=document.getElementById("executeButton"),this.dropArea=document.getElementById("dropArea"),!this.fileInput||!this.fileInfoArea||!this.clearButton||!this.executeButton||!this.dropArea)throw new Error("\u5FC5\u8981\u306ADOM\u8981\u7D20\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");this.setupEventListeners()}setupEventListeners(){let e=document.getElementById("fileSelectButton");e&&e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.fileInput.click()}),this.fileInput.addEventListener("change",()=>{this.processNewFiles(Array.from(this.fileInput.files||[]))}),this.dropArea.addEventListener("dragover",t=>this.handleDragOver(t)),this.dropArea.addEventListener("dragleave",t=>this.handleDragLeave(t)),this.dropArea.addEventListener("drop",t=>this.handleDrop(t)),this.dropArea.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.fileInput.click())}),this.dropArea.addEventListener("click",t=>{t.target.tagName!=="BUTTON"&&this.fileInput.click()}),this.clearButton.addEventListener("click",()=>{this.clearFiles()}),this.fileInfoArea.addEventListener("click",t=>{let i=t.target;if(i.classList.contains("delete-file-button")){let s=i.dataset.filename;s&&this.removeFile(s)}})}handleDragOver(e){e.preventDefault(),this.dropArea.classList.add("drag-over")}handleDragLeave(e){e.preventDefault(),this.dropArea.classList.remove("drag-over")}handleDrop(e){e.preventDefault(),this.dropArea.classList.remove("drag-over"),e.dataTransfer&&e.dataTransfer.files.length>0&&this.processNewFiles(Array.from(e.dataTransfer.files))}async processNewFiles(e){let t=Array.from(e).filter(r=>r.type==="text/plain"||r.name.endsWith(".txt"));if(t.length<e.length){this.handleError(new Error("\u30C6\u30AD\u30B9\u30C8\u30D5\u30A1\u30A4\u30EB\u4EE5\u5916\u304C\u542B\u307E\u308C\u3066\u3044\u307E\u3059"),"file-format");return}let i=Array.from(this.selectedFiles).map(r=>r.name),s=t.filter(r=>!i.includes(r.name)),a=t.length-s.length;s.forEach(r=>this.selectedFiles.push(r)),this.updateFileInfo(),s.length===0&&t.length>0?this.handleError(new Error("\u3059\u3079\u3066\u306E\u30D5\u30A1\u30A4\u30EB\u304C\u65E2\u306B\u8FFD\u52A0\u3055\u308C\u3066\u3044\u307E\u3059"),"file-duplicate",{recoveryAction:{message:"\u65E2\u5B58\u306E\u30D5\u30A1\u30A4\u30EB\u3092\u30AF\u30EA\u30A2\u3057\u3066\u65B0\u3057\u3044\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\u3057\u307E\u3059\u304B\uFF1F",label:"\u30AF\u30EA\u30A2\u3057\u3066\u8FFD\u52A0",handler:()=>{this.selectedFiles=[...t],this.updateFileInfo(),this.notification.showToast("success","\u30D5\u30A1\u30A4\u30EB\u66F4\u65B0\u5B8C\u4E86",`${t.length}\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F`),this.validateSelectedFiles()}}}):a>0?this.notification.showToast("warning","\u30D5\u30A1\u30A4\u30EB\u91CD\u8907",`${s.length}\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F (${a}\u30D5\u30A1\u30A4\u30EB\u306F\u91CD\u8907)`,5e3,3):s.length>0&&this.notification.showToast("success","\u30D5\u30A1\u30A4\u30EB\u8FFD\u52A0\u5B8C\u4E86",`${s.length}\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F`,5e3,2),(s.length>0||this.selectedFiles.length>0)&&await this.validateSelectedFiles()}clearFiles(){this.selectedFiles=[],this.fileInput.value="",this.validFiles=0,this.updateFileInfo();let e=new CustomEvent("filesClear");document.dispatchEvent(e),this.notification.showToast("info","\u30AF\u30EA\u30A2\u5B8C\u4E86","\u30D5\u30A1\u30A4\u30EB\u9078\u629E\u3092\u30AF\u30EA\u30A2\u3057\u307E\u3057\u305F")}removeFile(e){let t=this.selectedFiles.length;this.selectedFiles=this.selectedFiles.filter(i=>i.name!==e),this.selectedFiles.length<t&&(this.notification.showToast("info","\u30D5\u30A1\u30A4\u30EB\u524A\u9664",`${e} \u3092\u524A\u9664\u3057\u307E\u3057\u305F`),this.updateFileInfo(),this.validateSelectedFiles())}async validateSelectedFiles(){if(this.selectedFiles.length===0)return this.updateFileInfo(),!1;try{let e=await S(this.selectedFiles);return this.updateValidationUI(e),this.validFiles=e.filter(t=>t.isValid).length,this.executeButton.disabled=this.validFiles===0,this.validFiles>0}catch(e){return this.handleError(e instanceof Error?e:new Error("\u4E0D\u660E\u306A\u30A8\u30E9\u30FC"),"file-validation"),this.executeButton.disabled=!0,!1}}updateValidationUI(e){this.updateFileInfo(e)}updateFileInfo(e){if(this.selectedFiles.length===0){this.fileInfoArea.innerHTML='<p class="no-file-message">\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093</p>',this.clearButton.disabled=!0,this.executeButton.disabled=!0;return}let t="";this.selectedFiles.forEach(i=>{let s={status:"pending",messages:[]};if(e){let a=e.find(r=>r.file===i);a&&(s={status:a.isValid?a.warnings.length>0?"warning":"valid":"error",messages:[...a.errors.map(r=>({type:"error",text:r})),...a.warnings.map(r=>({type:"warning",text:r}))]})}t+=`
        <div class="file-item">
          <div class="file-icon">\u{1F4C4}</div>
          <div class="file-name">${i.name}</div>
      `,s.messages&&s.messages.length>0?(t+='<div class="validation-feedback">',s.messages.forEach(a=>{let r="";switch(a.type){case"error":r="\u274C";break;case"warning":r="\u26A0\uFE0F";break;case"info":r="\u2139\uFE0F";break}t+=`
            <div class="validation-message ${a.type}">
              <span class="validation-icon">${r}</span>
              <span class="validation-text">${a.text}</span>
            </div>
          `}),t+="</div>"):s.status==="valid"&&(t+=`
          <div class="validation-feedback">
            <div class="validation-message success">
              <span class="validation-icon">\u2705</span>
              <span class="validation-text">\u30D5\u30A1\u30A4\u30EB\u5F62\u5F0F\u306F\u6709\u52B9\u3067\u3059</span>
            </div>
          </div>
        `),t+=`
          <button class="delete-file-button" data-filename="${i.name}" aria-label="${i.name} \u3092\u524A\u9664">\xD7</button>
        </div>`}),this.fileInfoArea.innerHTML=t,this.clearButton.disabled=!1}handleError(e,t,i={}){console.error(`\u30A8\u30E9\u30FC (${t}):`,e);let s="\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F",a=e.message||"\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F",r="",o=4;switch(t){case"file-format":s="\u30D5\u30A1\u30A4\u30EB\u5F62\u5F0F\u30A8\u30E9\u30FC",r="\u30C6\u30AD\u30B9\u30C8\u30D5\u30A1\u30A4\u30EB(.txt)\u306E\u307F\u8FFD\u52A0\u3067\u304D\u307E\u3059\u3002\u30D5\u30A1\u30A4\u30EB\u5F62\u5F0F\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044";break;case"file-validation":s="\u30D5\u30A1\u30A4\u30EB\u691C\u8A3C\u30A8\u30E9\u30FC",r="\u6B63\u3057\u3044\u5F62\u5F0F\u306EEF\u7D71\u5408\u30D5\u30A1\u30A4\u30EB\u3067\u3042\u308B\u3053\u3068\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044";break;case"file-duplicate":s="\u30D5\u30A1\u30A4\u30EB\u91CD\u8907",r="\u5225\u306E\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3059\u308B\u304B\u3001\u65E2\u5B58\u306E\u30D5\u30A1\u30A4\u30EB\u3092\u30AF\u30EA\u30A2\u3057\u3066\u304F\u3060\u3055\u3044";break;default:r="\u554F\u984C\u304C\u89E3\u6C7A\u3057\u306A\u3044\u5834\u5408\u306F\u3001\u30DA\u30FC\u30B8\u3092\u518D\u8AAD\u307F\u8FBC\u307F\u3057\u3066\u304F\u3060\u3055\u3044"}let l=r?`${a}<br><span class="error-solution">\u89E3\u6C7A\u7B56: ${r}</span>`:a;if(this.notification.showToast("error",s,l,8e3,o),i.recoveryAction&&i.recoveryAction.message&&i.recoveryAction.label&&i.recoveryAction.handler){let c={message:i.recoveryAction.message,label:i.recoveryAction.label,handler:i.recoveryAction.handler};setTimeout(()=>{this.notification.showRecoveryToast(c)},1e3)}i.updateUI&&i.updateUI()}getSelectedFiles(){return this.selectedFiles}getValidFileCount(){return this.validFiles}};var E=class{resultTextarea;resultTable;textViewButton;tableViewButton;textResultView;tableResultView;copyButton;copyMessage;downloadLink;currentView="text";constructor(){if(this.resultTextarea=document.getElementById("resultTextarea"),this.resultTable=document.getElementById("resultTable"),this.textViewButton=document.getElementById("textViewButton"),this.tableViewButton=document.getElementById("tableViewButton"),this.textResultView=document.getElementById("textResultView"),this.tableResultView=document.getElementById("tableResultView"),this.copyButton=document.getElementById("copyButton"),this.copyMessage=document.getElementById("copyMessage"),this.downloadLink=document.getElementById("downloadLink"),!this.resultTextarea||!this.resultTable||!this.textViewButton||!this.tableViewButton||!this.textResultView||!this.tableResultView||!this.copyButton||!this.copyMessage||!this.downloadLink)throw new Error("\u5FC5\u8981\u306ADOM\u8981\u7D20\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");this.setupEventListeners()}setupEventListeners(){this.textViewButton.addEventListener("click",()=>{this.setResultView("text")}),this.tableViewButton.addEventListener("click",()=>{this.setResultView("table")}),this.copyButton.addEventListener("click",()=>{this.copyResultToClipboard()})}setResultView(e){this.currentView=e,e==="text"?(this.textResultView.style.display="block",this.tableResultView.style.display="none",this.textViewButton.classList.add("active"),this.tableViewButton.classList.remove("active"),this.textViewButton.setAttribute("aria-pressed","true"),this.tableViewButton.setAttribute("aria-pressed","false")):(this.textResultView.style.display="none",this.tableResultView.style.display="block",this.textViewButton.classList.remove("active"),this.tableViewButton.classList.add("active"),this.textViewButton.setAttribute("aria-pressed","false"),this.tableViewButton.setAttribute("aria-pressed","true"))}async copyResultToClipboard(){let e=this.resultTextarea.value;if(e)try{await navigator.clipboard.writeText(e),this.copyMessage.classList.remove("visible","error"),this.copyMessage.textContent="\u30B3\u30D4\u30FC\u3057\u307E\u3057\u305F\uFF01",this.copyMessage.classList.add("visible"),setTimeout(()=>{this.copyMessage.classList.remove("visible")},2e3)}catch(t){console.error("\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u3078\u306E\u30B3\u30D4\u30FC\u306B\u5931\u6557\u3057\u307E\u3057\u305F:",t),this.copyMessage.classList.remove("visible","error"),this.copyMessage.textContent="\u30B3\u30D4\u30FC\u306B\u5931\u6557\u3057\u307E\u3057\u305F",this.copyMessage.classList.add("visible"),this.copyMessage.classList.add("error"),setTimeout(()=>{this.copyMessage.classList.remove("visible"),this.copyMessage.classList.remove("error")},3e3)}}displayResult(e,t){let i=t?`=== \u30C7\u30D0\u30C3\u30B0\u60C5\u5831 ===
${t}

=== \u51E6\u7406\u7D50\u679C ===
${e}`:e;this.resultTextarea.value=i,this.updateResultTable(e);let s=document.getElementById("resultContainer");s&&s.classList.remove("hidden"),this.updateDownloadLink(e);let a=!!e;this.copyButton.disabled=!a,this.downloadLink.classList.toggle("hidden",!a),a||this.clearResultTable()}clearResultTable(){let e=this.resultTable.querySelector("tbody");e&&(e.innerHTML="")}updateResultTable(e){if(!e)return;let t=this.resultTable.querySelector("tbody");if(!t)return;this.clearResultTable();let i=e.trim().split(`
`);for(let s=1;s<i.length;s++){let a=i[s].split("	");if(a.length>=5){let r=document.createElement("tr");for(let o=0;o<5;o++){let l=document.createElement("td");l.textContent=a[o],o===3&&(a[o]==="Yes"?l.classList.add("eligible-yes"):l.classList.add("eligible-no")),r.appendChild(l)}t.appendChild(r)}}}updateDownloadLink(e){let t=new Blob([e],{type:"text/plain"}),i=URL.createObjectURL(t);this.downloadLink.href&&URL.revokeObjectURL(this.downloadLink.href),this.downloadLink.href=i;let s=new Date,a=`${s.getFullYear()}${(s.getMonth()+1).toString().padStart(2,"0")}${s.getDate().toString().padStart(2,"0")}`;this.downloadLink.setAttribute("download",`\u77ED\u624B3\u5224\u5B9A\u7D50\u679C_${a}.txt`),this.downloadLink.classList.remove("hidden")}getCurrentView(){return this.currentView}getOutputSettings(){let e=document.getElementById("eligibleOnly"),t=document.querySelectorAll('input[name="dateFormat"]'),i="yyyymmdd";for(let s of Array.from(t))if(s.checked){i=s.value;break}return{outputMode:e?.checked?"eligibleOnly":"allCases",dateFormat:i}}};var b="\u30C7\u30FC\u30BF\u8B58\u5225\u756A\u53F7	\u5165\u9662\u5E74\u6708\u65E5	\u9000\u9662\u5E74\u6708\u65E5	\u77ED\u624B\uFF13\u5BFE\u8C61\u75C7\u4F8B	\u7406\u7531",G="150285010",X="150183410",B=[G,X],L={160218510:"\u7D42\u591C\u7761\u7720\u30DD\u30EA\u30B0\u30E9\u30D5\u30A3\u30FC\uFF08\uFF11\u53CA\u3073\uFF12\u4EE5\u5916\u306E\u5834\u5408\uFF09\uFF08\u5B89\u5168\u7CBE\u5EA6\u7BA1\u7406\u4E0B\u3067\u884C\u3046\u3082\u306E\uFF09",160218610:"\u7D42\u591C\u7761\u7720\u30DD\u30EA\u30B0\u30E9\u30D5\u30A3\u30FC\uFF08\uFF11\u53CA\u3073\uFF12\u4EE5\u5916\u306E\u5834\u5408\uFF09\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09",160183110:"\u53CD\u5FA9\u7761\u7720\u6F5C\u6642\u8A66\u9A13\uFF08\uFF2D\uFF33\uFF2C\uFF34\uFF09",160119710:"\u4E0B\u5782\u4F53\u524D\u8449\u8CA0\u8377\u8A66\u9A13\u6210\u9577\u30DB\u30EB\u30E2\u30F3\uFF08\uFF27\uFF28\uFF09\uFF08\u4E00\u9023\u3068\u3057\u3066\uFF09",160180410:"\u5C0F\u5150\u98DF\u7269\u30A2\u30EC\u30EB\u30AE\u30FC\u8CA0\u8377\u691C\u67FB",160098110:"\u524D\u7ACB\u817A\u91DD\u751F\u691C\u6CD5\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09",150351910:"\u7D4C\u76AE\u7684\u653E\u5C04\u7DDA\u6CBB\u7642\u7528\u91D1\u5C5E\u30DE\u30FC\u30AB\u30FC\u7559\u7F6E\u8853",150011310:"\u56DB\u80A2\u30FB\u8EAF\u5E79\u8EDF\u90E8\u816B\u760D\u6458\u51FA\u8853\uFF08\u624B\uFF09",150294810:"\u9AA8\u6298\u89B3\u8840\u7684\u624B\u8853\uFF08\u624B\u821F\u72B6\u9AA8\uFF09",150020810:"\u9AA8\u5185\u7570\u7269\uFF08\u633F\u5165\u7269\u3092\u542B\u3080\u3002\uFF09\u9664\u53BB\u8853\uFF08\u524D\u8155\uFF09",150021010:"\u9AA8\u5185\u7570\u7269\uFF08\u633F\u5165\u7269\u3092\u542B\u3080\u3002\uFF09\u9664\u53BB\u8853\uFF08\u9396\u9AA8\uFF09",150021210:"\u9AA8\u5185\u7570\u7269\uFF08\u633F\u5165\u7269\u3092\u542B\u3080\u3002\uFF09\u9664\u53BB\u8853\uFF08\u624B\uFF09",150041010:"\u30AC\u30F3\u30B0\u30EA\u30AA\u30F3\u6458\u51FA\u8853\uFF08\u624B\uFF09",150314110:"\u95A2\u7BC0\u93E1\u4E0B\u624B\u6839\u7BA1\u958B\u653E\u624B\u8853",150273810:"\u80F8\u8154\u93E1\u4E0B\u4EA4\u611F\u795E\u7D4C\u7BC0\u5207\u9664\u8853\uFF08\u4E21\u5074\uFF09",150355810:"\u6D99\u7BA1\u30C1\u30E5\u30FC\u30D6\u633F\u5165\u8853\uFF08\u6D99\u9053\u5185\u8996\u93E1\u3092\u7528\u3044\u308B\u3082\u306E\uFF09",150355910:"\u773C\u77BC\u5185\u53CD\u75C7\u624B\u8853\uFF08\u76AE\u819A\u5207\u958B\u6CD5\uFF09",150078810:"\u773C\u77BC\u4E0B\u5782\u75C7\u624B\u8853\uFF08\u773C\u77BC\u6319\u7B4B\u524D\u8EE2\u6CD5\uFF09",150079010:"\u773C\u77BC\u4E0B\u5782\u75C7\u624B\u8853\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09",150080210:"\u7FFC\u72B6\u7247\u624B\u8853\uFF08\u5F01\u306E\u79FB\u690D\u3092\u8981\u3059\u308B\u3082\u306E\uFF09",150083410:"\u659C\u8996\u624B\u8853\uFF08\u5F8C\u8EE2\u6CD5\uFF09",150083510:"\u659C\u8996\u624B\u8853\uFF08\u524D\u8EE2\u6CD5\u53CA\u3073\u5F8C\u8EE2\u6CD5\u306E\u4F75\u65BD\uFF09",150344510:"\u6CBB\u7642\u7684\u89D2\u819C\u5207\u9664\u8853\uFF08\u30A8\u30AD\u30B7\u30DE\u30EC\u30FC\u30B6\u30FC\u306B\u3088\u308B\u3082\u306E\uFF08\u89D2\u819C\u30B8\u30B9\u30C8\u30ED\u30D5\u30A3\u30FC\u53C8\u306F\u5E2F\u72B6\u89D2\u819C\u5909\u6027\u306B\u4FC2\u308B\u3082\u306E\u306B\u9650\u308B\u3002\uFF09\uFF09",150395150:"\u7DD1\u5185\u969C\u624B\u8853\uFF08\u6C34\u6676\u4F53\u518D\u5EFA\u8853\u4F75\u7528\u773C\u5185\u30C9\u30EC\u30FC\u30F3\u633F\u5165\u8853\uFF09",150253010:"\u6C34\u6676\u4F53\u518D\u5EFA\u8853\uFF08\u773C\u5185\u30EC\u30F3\u30BA\u3092\u633F\u5165\u3059\u308B\u5834\u5408\uFF09\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09",150315610:"\u6C34\u6676\u4F53\u518D\u5EFA\u8853\uFF08\u773C\u5185\u30EC\u30F3\u30BA\u3092\u633F\u5165\u3057\u306A\u3044\u5834\u5408\uFF09",150096010:"\u9F13\u819C\u5F62\u6210\u624B\u8853",150097710:"\u9F3B\u9AA8\u9AA8\u6298\u6574\u5FA9\u56FA\u5B9A\u8853",150315910:"\u58F0\u5E2F\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u30D5\u30A1\u30A4\u30D0\u30FC\u30B9\u30B3\u30FC\u30D7\u306B\u3088\u308B\u3082\u306E\uFF09",150316010:"\u58F0\u5E2F\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u76F4\u9054\u5589\u982D\u93E1\u306B\u3088\u308B\u3082\u306E\uFF09",150106850:"\u5589\u982D\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u76F4\u9054\u5589\u982D\u93E1\u306B\u3088\u308B\u3082\u306E\uFF09",150299450:"\u5589\u982D\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u30D5\u30A1\u30A4\u30D0\u30FC\u30B9\u30B3\u30FC\u30D7\u306B\u3088\u308B\u3082\u306E\uFF09",150121110:"\u4E73\u817A\u816B\u760D\u6458\u51FA\u8853\uFF08\u9577\u5F84\uFF15\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u672A\u6E80\uFF09",150121210:"\u4E73\u817A\u816B\u760D\u6458\u51FA\u8853\uFF08\u9577\u5F84\uFF15\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u4EE5\u4E0A\uFF09",150416610:"\u7D4C\u76AE\u7684\u30B7\u30E3\u30F3\u30C8\u62E1\u5F35\u8853\u30FB\u8840\u6813\u9664\u53BB\u8853\uFF08\u521D\u56DE\uFF09",150416710:"\u7D4C\u76AE\u7684\u30B7\u30E3\u30F3\u30C8\u62E1\u5F35\u8853\u30FB\u8840\u6813\u9664\u53BB\u8853\uFF08\uFF11\u306E\u5B9F\u65BD\u5F8C\uFF13\u6708\u4EE5\u5185\u306B\u5B9F\u65BD\u3059\u308B\u5834\u5408\uFF09",150154010:"\u4E0B\u80A2\u9759\u8108\u7624\u624B\u8853\uFF08\u629C\u53BB\u5207\u9664\u8853\uFF09",150263410:"\u4E0B\u80A2\u9759\u8108\u7624\u624B\u8853\uFF08\u786C\u5316\u7642\u6CD5\uFF08\u4E00\u9023\u3068\u3057\u3066\uFF09\uFF09",150296510:"\u4E0B\u80A2\u9759\u8108\u7624\u624B\u8853\uFF08\u9AD8\u4F4D\u7D50\u7D2E\u8853\uFF09",150154150:"\u5927\u4F0F\u5728\u9759\u8108\u629C\u53BB\u8853",150360910:"\u4E0B\u80A2\u9759\u8108\u7624\u8840\u7BA1\u5185\u713C\u707C\u8853",150411150:"\u4E0B\u80A2\u9759\u8108\u7624\u8840\u7BA1\u5185\u585E\u6813\u8853",150159010:"\u30D8\u30EB\u30CB\u30A2\u624B\u8853\uFF08\u9F20\u5F84\u30D8\u30EB\u30CB\u30A2\uFF09",150263610:"\u8179\u8154\u93E1\u4E0B\u9F20\u5F84\u30D8\u30EB\u30CB\u30A2\u624B\u8853\uFF08\u4E21\u5074\uFF09",150285010:"\u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u30FB\u7C98\u819C\u5207\u9664\u8853\uFF08\u9577\u5F84\uFF12\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u672A\u6E80\uFF09",150183410:"\u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u30FB\u7C98\u819C\u5207\u9664\u8853\uFF08\u9577\u5F84\uFF12\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u4EE5\u4E0A\uFF09",150325410:"\u75D4\u6838\u624B\u8853\uFF08\u8131\u809B\u3092\u542B\u3080\u3002\uFF09\uFF08\u786C\u5316\u7642\u6CD5\uFF08\u56DB\u6BB5\u968E\u6CE8\u5C04\u6CD5\u306B\u3088\u308B\u3082\u306E\uFF09\uFF09",150190310:"\u809B\u9580\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853",150190410:"\u809B\u9580\u5C16\u572D\u30B3\u30F3\u30B8\u30ED\u30FC\u30E0\u5207\u9664\u8853",150194510:"\u4F53\u5916\u885D\u6483\u6CE2\u814E\u30FB\u5C3F\u7BA1\u7D50\u77F3\u7834\u7815\u8853\uFF08\u4E00\u9023\u306B\u3064\u304D\uFF09",150421110:"\u5C3F\u5931\u7981\u624B\u8853\uFF08\u30DC\u30C4\u30EA\u30CC\u30B9\u6BD2\u7D20\u306B\u3088\u308B\u3082\u306E\uFF09",150404310:"\u9855\u5FAE\u93E1\u4E0B\u7CBE\u7D22\u9759\u8108\u7624\u624B\u8853",150216510:"\u5B50\u5BAE\u9838\u90E8\uFF08\u815F\u90E8\uFF09\u5207\u9664\u8853",150421310:"\u5B50\u5BAE\u93E1\u4E0B\u6709\u830E\u7C98\u819C\u4E0B\u7B4B\u816B\u5207\u51FA\u8853\uFF08\u96FB\u89E3\u8CEA\u6EB6\u6DB2\u5229\u7528\u306E\u3082\u306E\uFF09",150421410:"\u5B50\u5BAE\u5185\u819C\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u96FB\u89E3\u8CEA\u6EB6\u6DB2\u5229\u7528\u306E\u3082\u306E\uFF09",150421510:"\u5B50\u5BAE\u93E1\u4E0B\u6709\u830E\u7C98\u819C\u4E0B\u7B4B\u816B\u5207\u51FA\u8853\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09",150421610:"\u5B50\u5BAE\u5185\u819C\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09",150421710:"\u5B50\u5BAE\u93E1\u4E0B\u5B50\u5BAE\u7B4B\u816B\u6458\u51FA\u8853\uFF08\u96FB\u89E3\u8CEA\u6EB6\u6DB2\u5229\u7528\u306E\u3082\u306E\uFF09",150421810:"\u5B50\u5BAE\u93E1\u4E0B\u5B50\u5BAE\u7B4B\u816B\u6458\u51FA\u8853\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09",150366110:"\u8179\u8154\u93E1\u4E0B\u5375\u7BA1\u5F62\u6210\u8853",180018910:"\u30AC\u30F3\u30DE\u30CA\u30A4\u30D5\u306B\u3088\u308B\u5B9A\u4F4D\u653E\u5C04\u7DDA\u6CBB\u7642"},f=Object.keys(L),M=["150429570","150437170"],F=5,m={UNDISCHARGED:"\u9000\u9662\u65E5\u672A\u78BA\u5B9A",NO_TARGET_PROCEDURE:"\u5BFE\u8C61\u624B\u8853\u7B49\u306A\u3057",HOSPITAL_DAYS_EXCEEDED:"\u5165\u9662\u671F\u9593\u304C\uFF16\u65E5\u4EE5\u4E0A",MULTIPLE_TARGET_PROCEDURES:"\u5BFE\u8C61\u624B\u8853\u7B49\u3092\uFF12\u4EE5\u4E0A\u5B9F\u65BD",OTHER_SURGERY:"\u5BFE\u8C61\u624B\u8853\u7B49\u4EE5\u5916\u306E\u624B\u8853\u3042\u308A",SPECIAL_ADDITION:"\u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u8853\u306B\u7279\u5B9A\u52A0\u7B97\u3042\u308A"};function q(n){if(n.length<4)return null;let e=n[1].trim();if(!e)return null;let t=n[3].trim(),i=n[2].trim();if((n.length>6?n[6].trim():null)==="000")return null;let a={dataId:e,admission:t,discharge:i},r=n.length>8?n[8].trim():null,o=n.length>10?n[10].trim():null;return!r||!f.includes(r)?{...a,procedure:null,procedureName:null}:{...a,procedure:r,procedureName:o??"(\u540D\u79F0\u306A\u3057)"}}function H(n){let e=n.split(/\r?\n/),t={};for(let i=1;i<e.length;i++){let s=e[i].trim();if(s)try{let a=s.split("	"),r=q(a);if(r){let{dataId:o,discharge:l,admission:c,procedure:d,procedureName:g}=r,R=`${o}_${c}`,u=t[R];u||(u={id:o,admission:c,discharge:l,procedures:[],procedureNames:[]},t[R]=u),l&&l!=="00000000"&&(!u.discharge||u.discharge==="00000000"||l>u.discharge)&&(u.discharge=l),d&&!u.procedures.includes(d)&&(u.procedures.push(d),u.procedureNames||(u.procedureNames=[]),u.procedureNames.push(g??"(\u540D\u79F0\u306A\u3057)"))}}catch{continue}}return Object.values(t)}function x(n,e){let t={};for(let i of n){let s=`${i.id}_${i.admission}`;t[s]=C(i)}for(let i of e){let s=`${i.id}_${i.admission}`;t[s]?K(t[s],i):t[s]=C(i)}return Object.values(t)}function K(n,e){e.discharge&&e.discharge!=="00000000"&&(!n.discharge||n.discharge==="00000000"||e.discharge>n.discharge)&&(n.discharge=e.discharge),Array.isArray(n.procedures)||(n.procedures=[]),Array.isArray(n.procedureNames)||(n.procedureNames=[]),j(n,e)}function C(n){return{...n,procedures:Array.isArray(n.procedures)?[...n.procedures]:[],procedureNames:Array.isArray(n.procedureNames)?[...n.procedureNames]:[]}}function j(n,e){let t=Array.isArray(e.procedures)?e.procedures:[],i=Array.isArray(e.procedureNames)?e.procedureNames:[];for(let s=0;s<t.length;s++){let a=t[s];n.procedures.includes(a)||(n.procedures.push(a),n.procedureNames||(n.procedureNames=[]),n.procedureNames.push(i[s]??"(\u540D\u79F0\u306A\u3057)"))}}function I(n){if(!n||n==="00000000")return null;try{let e=parseInt(n.substring(0,4),10),t=parseInt(n.substring(4,6),10)-1,i=parseInt(n.substring(6,8),10),s=new Date(e,t,i);return isNaN(s.getTime())?null:s}catch(e){return console.error(`\u65E5\u4ED8\u306E\u89E3\u6790\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F: ${n} - ${e instanceof Error?e.message:String(e)}`),null}}function N(n,e){let t=I(n),i=I(e);return!t||!i?null:Math.round((i.getTime()-t.getTime())/(1e3*60*60*24))+1}function w(n,e="yyyymmdd"){if(n==="00000000")return n;let t=I(n);if(!t)return n;let i=t.getFullYear(),s=t.getMonth()+1,a=t.getDate();return e==="yyyy/mm/dd"?`${i}/${s.toString().padStart(2,"0")}/${a.toString().padStart(2,"0")}`:`${i}${s.toString().padStart(2,"0")}${a.toString().padStart(2,"0")}`}function O(n){return n.map(t=>{try{let i={...t};if(!t.discharge||t.discharge==="00000000")return i.isEligible=!1,i.reason=m.UNDISCHARGED,i;let s=t.procedures.filter(d=>f.includes(d));if(s.length===0)return i.isEligible=!1,i.reason=m.NO_TARGET_PROCEDURE,i;let a=N(t.admission,t.discharge);if(a===null||a>F)return i.isEligible=!1,i.reason=m.HOSPITAL_DAYS_EXCEEDED,i;if(s.length>1&&new Set(s).size>1)return i.isEligible=!1,i.reason=m.MULTIPLE_TARGET_PROCEDURES,i;let r=t.procedures.some(d=>B.includes(d)),o=t.procedures.some(d=>M.includes(d));if(r&&o)return i.isEligible=!1,i.reason=m.SPECIAL_ADDITION,i;if(t.procedures.filter((d,g)=>!(f.includes(d)||!d.startsWith("15")||t.procedureNames&&t.procedureNames[g]&&t.procedureNames[g].includes("\u52A0\u7B97")||d.startsWith("1500")&&d.substring(4,6)==="00")).length>0)return i.isEligible=!1,i.reason=m.OTHER_SURGERY,i;i.isEligible=!0;let c=s[0];return i.reason=L[c]||"\u5BFE\u8C61\u624B\u8853\u7B49",i}catch(i){return console.error(`\u75C7\u4F8B ${t.id} \u306E\u8A55\u4FA1\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F: ${i instanceof Error?i.message:String(i)}`),{...t,isEligible:!1,reason:`\u8A55\u4FA1\u30A8\u30E9\u30FC: ${i instanceof Error?i.message:String(i)}`}}}).sort((t,i)=>t.id.localeCompare(i.id))}function V(n,e=b,t){let i=t.outputMode==="allCases"?n:n.filter(a=>a.isEligible===!0);if(i.length===0)return"\u8A72\u5F53\u3059\u308B\u75C7\u4F8B\u306F\u3042\u308A\u307E\u305B\u3093\u3002";let s=[e];return i.forEach(a=>{let r=w(a.admission,t.dateFormat),o=w(a.discharge,t.dateFormat),l=`${a.id}	${r}	${o}	${a.isEligible?"Yes":"No"}	${a.reason||""}`;s.push(l)}),s.join(`
`)}var A=class{async processFiles(e,t){try{if(!e||e.length===0)throw new Error("\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093");let i=[];for(let o of e){let l=await T(o);i.push(l)}let s=[];for(let o of i){let l=H(o);s=x(s,l)}let a=O(s);return V(a,b,t)}catch(i){throw console.error("\u30D5\u30A1\u30A4\u30EB\u51E6\u7406\u30A8\u30E9\u30FC:",i),i}}},$=new A;var D=class{loadingIndicator=null;executeButton=null;fileManagerInstance;resultViewerInstance;constructor(){let e=h();this.fileManagerInstance=new v(e),this.resultViewerInstance=new E}init(){this.loadingIndicator=document.getElementById("loadingIndicator"),this.executeButton=document.getElementById("executeButton"),this.setupEventListeners(),document.addEventListener("filesClear",()=>{})}setupEventListeners(){this.executeButton&&this.executeButton.addEventListener("click",()=>{this.processFiles()})}async processFiles(){try{let e=this.fileManagerInstance.getSelectedFiles();if(e.length===0){this.handleError(new Error("\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093"),"no-files",{recoveryAction:{message:"\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044",label:"\u30D5\u30A1\u30A4\u30EB\u9078\u629E",handler:()=>{let a=document.getElementById("fileInput");a&&a.click()}}});return}if(this.loadingIndicator&&this.loadingIndicator.classList.add("active"),!await this.fileManagerInstance.validateSelectedFiles()){this.loadingIndicator&&this.loadingIndicator.classList.remove("active");return}let i=this.resultViewerInstance.getOutputSettings(),s=await $.processFiles(e,i);this.resultViewerInstance.displayResult(s),h().showToast("success","\u51E6\u7406\u5B8C\u4E86","\u51E6\u7406\u304C\u6B63\u5E38\u306B\u5B8C\u4E86\u3057\u307E\u3057\u305F",5e3,2)}catch(e){this.handleError(e instanceof Error?e:new Error("\u4E0D\u660E\u306A\u30A8\u30E9\u30FC"),"processing",{recoveryAction:{message:"\u8A2D\u5B9A\u3092\u5909\u66F4\u3057\u3066\u518D\u8A66\u884C\u3057\u307E\u3059\u304B\uFF1F",label:"\u518D\u8A66\u884C",handler:()=>{this.executeButton&&this.executeButton.click()}},updateUI:()=>{}})}finally{this.loadingIndicator&&this.loadingIndicator.classList.remove("active")}}handleError(e,t,i={}){console.error(`\u30A8\u30E9\u30FC (${t}):`,e);let s="\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F",a=e.message||"\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F",r="",o=4;switch(t){case"processing":s="\u51E6\u7406\u30A8\u30E9\u30FC",e.message.includes("\u30E1\u30E2\u30EA")?r="\u30D5\u30A1\u30A4\u30EB\u30B5\u30A4\u30BA\u304C\u5927\u304D\u3059\u304E\u308B\u53EF\u80FD\u6027\u304C\u3042\u308A\u307E\u3059\u3002\u5C0F\u3055\u306A\u30D5\u30A1\u30A4\u30EB\u306B\u5206\u5272\u3057\u3066\u51E6\u7406\u3057\u3066\u304F\u3060\u3055\u3044":r="\u5165\u529B\u30C7\u30FC\u30BF\u3092\u78BA\u8A8D\u3057\u3001\u518D\u5EA6\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044";break;case"no-files":s="\u30D5\u30A1\u30A4\u30EB\u672A\u9078\u629E",a="\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093",r="\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3057\u3066\u304B\u3089\u51E6\u7406\u3092\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044";break;default:r="\u554F\u984C\u304C\u89E3\u6C7A\u3057\u306A\u3044\u5834\u5408\u306F\u3001\u30DA\u30FC\u30B8\u3092\u518D\u8AAD\u307F\u8FBC\u307F\u3057\u3066\u304F\u3060\u3055\u3044"}let l=r?`${a}<br><span class="error-solution">\u89E3\u6C7A\u7B56: ${r}</span>`:a;if(h().showToast("error",s,l,8e3,o),i.recoveryAction&&i.recoveryAction.message&&i.recoveryAction.label&&i.recoveryAction.handler){let c={message:i.recoveryAction.message,label:i.recoveryAction.label,handler:i.recoveryAction.handler};setTimeout(()=>{h().showRecoveryToast(c)},1e3)}i.updateUI&&i.updateUI()}};document.addEventListener("DOMContentLoaded",()=>{try{new D().init()}catch(n){console.error("\u521D\u671F\u5316\u30A8\u30E9\u30FC:",n);let e=document.createElement("div");e.className="initialization-error",e.textContent="\u521D\u671F\u5316\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002\u30DA\u30FC\u30B8\u3092\u518D\u8AAD\u307F\u8FBC\u307F\u3057\u3066\u304F\u3060\u3055\u3044\u3002",document.body.prepend(e)}});
//# sourceMappingURL=main.js.map
