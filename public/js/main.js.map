{
  "version": 3,
  "sources": ["../../src/ui/components/notification.ts", "../../src/core/validator.ts", "../../src/ui/components/file-manager.ts", "../../src/ui/components/result-viewer.ts", "../../src/core/common/constants.ts", "../../src/core/common/parsers.ts", "../../src/core/common/utils.ts", "../../src/core/common/evaluator.ts", "../../src/core/file-processor.ts", "../../src/browser/main.ts"],
  "sourcesContent": ["// \u30C8\u30FC\u30B9\u30C8\u901A\u77E5\u578B\nexport interface ToastData {\n  id: string;\n  type: 'success' | 'warning' | 'error' | 'info';\n  title: string;\n  message: string;\n  timestamp: number;\n  priority: number;\n  duration: number;\n  element?: HTMLElement;\n}\n\n// \u30BF\u30A4\u30D7\u512A\u5148\u5EA6\u30DE\u30C3\u30D7 (\u524A\u9664\u4E88\u5B9A\u3060\u304C\u3001\u4ED6\u306E\u7B87\u6240\u3067\u4F7F\u308F\u308C\u3066\u3044\u308B\u53EF\u80FD\u6027\u3092\u8003\u616E\u3057\u4E00\u65E6\u6B8B\u3059)\nexport interface TypePriorityMap {\n  [key: string]: number;\n  error: number;\n  warning: number;\n  info: number;\n  success: number;\n}\n\n/**\n * \u901A\u77E5\u30B7\u30B9\u30C6\u30E0\n * \u30E6\u30FC\u30B6\u30FC\u3078\u306E\u901A\u77E5\u8868\u793A\u3092\u7BA1\u7406\u3059\u308B\u30E2\u30B8\u30E5\u30FC\u30EB\n */\nexport class NotificationSystem {\n  private toastContainer: HTMLElement;\n  private activeToasts: ToastData[] = [];\n  private toastHistory: Partial<ToastData>[] = [];\n  private readonly MAX_VISIBLE_TOASTS = 3;\n  private readonly MAX_HISTORY_ITEMS = 10;\n\n  /**\n   * \u901A\u77E5\u30B7\u30B9\u30C6\u30E0\u306E\u30B3\u30F3\u30B9\u30C8\u30E9\u30AF\u30BF\n   * @param containerId \u901A\u77E5\u30B3\u30F3\u30C6\u30CA\u306EID\n   */\n  constructor(containerId: string = 'toastContainer') {\n    this.toastContainer = document.getElementById(containerId) ||\n      this.createToastContainer(containerId);\n    this.setupHistoryButton();\n  }\n\n  /**\n   * \u30C8\u30FC\u30B9\u30C8\u901A\u77E5\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\n   * @param containerId \u30B3\u30F3\u30C6\u30CAID\n   * @returns \u4F5C\u6210\u3055\u308C\u305F\u30B3\u30F3\u30C6\u30CA\u8981\u7D20\n   */\n  private createToastContainer(containerId: string): HTMLElement {\n    const container = document.createElement('div');\n    container.id = containerId;\n    container.className = 'toast-container';\n    document.body.appendChild(container);\n    return container;\n  }\n\n  /**\n   * \u5C65\u6B74\u30DC\u30BF\u30F3\u306E\u521D\u671F\u8A2D\u5B9A\n   */\n  private setupHistoryButton(): void {\n    let historyButton = document.getElementById('notificationHistoryButton');\n    if (!historyButton) {\n      historyButton = document.createElement('button');\n      historyButton.id = 'notificationHistoryButton';\n      historyButton.className = 'notification-history-button hidden';\n      historyButton.setAttribute('aria-label', '\u901A\u77E5\u5C65\u6B74\u3092\u8868\u793A');\n      historyButton.innerHTML = '<span class=\"history-icon\">\uD83D\uDD14</span>';\n      document.body.appendChild(historyButton);\n\n      historyButton.addEventListener('click', () => this.showNotificationHistory());\n    }\n  }\n\n  /**\n   * \u30C8\u30FC\u30B9\u30C8\u901A\u77E5\u3092\u8868\u793A\n   * @param type \u901A\u77E5\u30BF\u30A4\u30D7\uFF08success, warning, error, info\uFF09\n   * @param title \u901A\u77E5\u30BF\u30A4\u30C8\u30EB\n   * @param message \u901A\u77E5\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param duration \u8868\u793A\u6642\u9593\uFF08\u30DF\u30EA\u79D2\uFF09\n   * @param priority \u512A\u5148\u5EA6\uFF081-5\u30015\u304C\u6700\u9AD8\uFF09\n   */\n  public showToast(\n    type: 'success' | 'warning' | 'error' | 'info',\n    title: string,\n    message: string,\n    duration: number = 5000,\n    priority: number = 3,\n  ): void {\n    // \u901A\u77E5\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u3092\u4F5C\u6210\n    const timestamp = Date.now();\n    const toastId = 'toast-' + timestamp;\n    const toastData: ToastData = {\n      id: toastId,\n      type,\n      title,\n      message,\n      timestamp,\n      priority,\n      duration,\n    };\n\n    // \u901A\u77E5\u5C65\u6B74\u306B\u8FFD\u52A0\n    this.addToastToHistory(toastData);\n\n    // \u901A\u77E5\u3092\u8868\u793A\u30AD\u30E5\u30FC\u306B\u8FFD\u52A0\n    this.activeToasts.push(toastData);\n\n    // \u512A\u5148\u5EA6\u9806\u306B\u30BD\u30FC\u30C8\uFF08\u512A\u5148\u5EA6\u304C\u9AD8\u304F\u3001\u65B0\u3057\u3044\u3082\u306E\u304C\u4E0A\u4F4D\uFF09\n    this.activeToasts.sort((a, b) => {\n      if (a.priority !== b.priority) {\n        return b.priority - a.priority;\n      }\n      return b.timestamp - a.timestamp;\n    });\n\n    // \u8868\u793A\u6570\u3092\u5236\u9650\u3057\u3001\u30A2\u30AF\u30C6\u30A3\u30D6\u30EA\u30B9\u30C8\u3092\u66F4\u65B0\n    this.manageActiveToasts();\n\n    // \u3053\u306E\u30C8\u30FC\u30B9\u30C8\u304C\u8868\u793A\u5BFE\u8C61\u3068\u3057\u3066\u6B8B\u3063\u3066\u3044\u308B\u5834\u5408\u306E\u307F\u30EC\u30F3\u30C0\u30EA\u30F3\u30B0\n    if (this.activeToasts.some((toast) => toast.id === toastId)) {\n      this.renderToast(toastData);\n    }\n  }\n\n  /**\n   * \u901A\u77E5\u5C65\u6B74\u306B\u8FFD\u52A0\n   * @param toastData \u901A\u77E5\u30C7\u30FC\u30BF\n   */\n  private addToastToHistory(toastData: ToastData): void {\n    // \u5C65\u6B74\u306B\u8FFD\u52A0\n    this.toastHistory.unshift({\n      type: toastData.type,\n      title: toastData.title,\n      message: toastData.message,\n      timestamp: toastData.timestamp,\n    });\n\n    // \u5C65\u6B74\u306E\u6700\u5927\u6570\u3092\u5236\u9650\n    if (this.toastHistory.length > this.MAX_HISTORY_ITEMS) {\n      this.toastHistory = this.toastHistory.slice(0, this.MAX_HISTORY_ITEMS);\n    }\n\n    // \u5C65\u6B74\u30DC\u30BF\u30F3\u3092\u66F4\u65B0\n    this.updateHistoryButton();\n  }\n\n  /**\n   * \u5C65\u6B74\u30DC\u30BF\u30F3\u3092\u66F4\u65B0\n   */\n  private updateHistoryButton(): void {\n    const historyButton = document.getElementById('notificationHistoryButton');\n    if (historyButton && this.toastHistory.length > 0) {\n      historyButton.classList.remove('hidden');\n      historyButton.setAttribute('data-count', this.toastHistory.length.toString());\n    }\n  }\n\n  /**\n   * \u30A2\u30AF\u30C6\u30A3\u30D6\u306A\u901A\u77E5\u3092\u7BA1\u7406\uFF08\u8868\u793A\u4E0A\u9650\u306E\u307F\uFF09\n   */\n  private manageActiveToasts(): void {\n    // \u5E38\u306B\u512A\u5148\u5EA6\u3068\u6642\u9593\u3067\u30BD\u30FC\u30C8\u3057\u3066\u304A\u304F\n    this.activeToasts.sort((a, b) => {\n      if (a.priority !== b.priority) {\n        return b.priority - a.priority; // \u512A\u5148\u5EA6\u9AD8\u3044\u9806\n      }\n      return b.timestamp - a.timestamp; // \u65B0\u3057\u3044\u9806\n    });\n\n    // \u8868\u793A\u4E0A\u9650\u3092\u8D85\u3048\u3066\u3044\u308B\u5834\u5408\n    if (this.activeToasts.length > this.MAX_VISIBLE_TOASTS) {\n      // \u8868\u793A\u3055\u308C\u308B\u30C8\u30FC\u30B9\u30C8\u3068\u96A0\u308C\u308B\u30C8\u30FC\u30B9\u30C8\u306B\u5206\u3051\u308B\n      const visibleToasts = this.activeToasts.slice(0, this.MAX_VISIBLE_TOASTS);\n      const hiddenToasts = this.activeToasts.slice(this.MAX_VISIBLE_TOASTS);\n\n      // \u96A0\u308C\u308B\u30C8\u30FC\u30B9\u30C8\u306E\u8981\u7D20\u3092DOM\u304B\u3089\u524A\u9664\n      hiddenToasts.forEach((toast) => {\n        if (toast.element) {\n          this.removeToastElement(toast.id);\n        }\n      });\n\n      // \u30A2\u30AF\u30C6\u30A3\u30D6\u30EA\u30B9\u30C8\u3092\u8868\u793A\u3055\u308C\u308B\u3082\u306E\u3060\u3051\u306B\u66F4\u65B0\n      this.activeToasts = visibleToasts;\n    }\n    // \u96C6\u7D04\u901A\u77E5\u95A2\u9023\u306E\u30ED\u30B8\u30C3\u30AF\u306F\u524A\u9664\n  }\n\n  // \u4E0D\u8981\u306B\u306A\u3063\u305F getHighestPriorityType \u30E1\u30BD\u30C3\u30C9\u3092\u524A\u9664\n\n  // \u4E0D\u8981\u306B\u306A\u3063\u305F showAggregateToast \u30E1\u30BD\u30C3\u30C9\u3092\u524A\u9664\n\n  /**\n   * \u901A\u77E5\u5C65\u6B74\u3092\u8868\u793A\n   */\n  public showNotificationHistory(): void {\n    // \u65E2\u5B58\u306E\u5C65\u6B74\u30E2\u30FC\u30C0\u30EB\u3092\u524A\u9664\n    const existingModal = document.getElementById('notificationHistoryModal');\n    if (existingModal) {\n      existingModal.parentNode?.removeChild(existingModal);\n    }\n\n    // \u5C65\u6B74\u30E2\u30FC\u30C0\u30EB\u3092\u4F5C\u6210\n    const modal = document.createElement('div');\n    modal.id = 'notificationHistoryModal';\n    modal.className = 'notification-history-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-labelledby', 'notificationHistoryTitle');\n    modal.setAttribute('aria-modal', 'true');\n\n    // \u5C65\u6B74\u30EA\u30B9\u30C8\u3092\u4F5C\u6210\n    let historyItems = '';\n    this.toastHistory.forEach((item) => {\n      if (item.timestamp) {\n        const date = new Date(item.timestamp);\n        const timeString = date.toLocaleTimeString();\n        historyItems += `\n          <div class=\"history-item history-item-${item.type}\">\n            <div class=\"history-item-time\">${timeString}</div>\n            <div class=\"history-item-content\">\n              <h4 class=\"history-item-title\">${item.title || ''}</h4>\n              <p class=\"history-item-message\">${item.message || ''}</p>\n            </div>\n          </div>\n        `;\n      }\n    });\n\n    // \u30E2\u30FC\u30C0\u30EB\u306E\u5185\u5BB9\u3092\u8A2D\u5B9A\n    modal.innerHTML = `\n      <div class=\"notification-history-content\">\n        <div class=\"notification-history-header\">\n          <h3 id=\"notificationHistoryTitle\">\u901A\u77E5\u5C65\u6B74</h3>\n          <button class=\"notification-history-close\" aria-label=\"\u5C65\u6B74\u3092\u9589\u3058\u308B\">\u00D7</button>\n        </div>\n        <div class=\"notification-history-list\">\n          ${historyItems.length ? historyItems : '<p class=\"no-history\">\u901A\u77E5\u5C65\u6B74\u306F\u3042\u308A\u307E\u305B\u3093</p>'}\n        </div>\n        <div class=\"notification-history-footer\">\n          <button class=\"secondary-button notification-history-clear\">\u5C65\u6B74\u3092\u30AF\u30EA\u30A2</button>\n          <button class=\"primary-button notification-history-close-btn\">\u9589\u3058\u308B</button>\n        </div>\n      </div>\n    `;\n\n    // \u30E2\u30FC\u30C0\u30EB\u3092\u30DA\u30FC\u30B8\u306B\u8FFD\u52A0\n    document.body.appendChild(modal);\n\n    // \u30E2\u30FC\u30C0\u30EB\u3092\u8868\u793A\uFF08\u30A2\u30CB\u30E1\u30FC\u30B7\u30E7\u30F3\u7528\uFF09\n    setTimeout(() => {\n      modal.classList.add('active');\n    }, 10);\n\n    // \u9589\u3058\u308B\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u3092\u8A2D\u5B9A\n    const closeButtons = modal.querySelectorAll(\n      '.notification-history-close, .notification-history-close-btn',\n    );\n    closeButtons.forEach((button) => {\n      button.addEventListener('click', () => {\n        this.closeNotificationHistory();\n      });\n    });\n\n    // \u30AF\u30EA\u30A2\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u3092\u8A2D\u5B9A\n    const clearButton = modal.querySelector('.notification-history-clear');\n    clearButton?.addEventListener('click', () => {\n      this.clearNotificationHistory();\n      this.closeNotificationHistory();\n    });\n\n    // \u30E2\u30FC\u30C0\u30EB\u5916\u30AF\u30EA\u30C3\u30AF\u3067\u9589\u3058\u308B\n    modal.addEventListener('click', (e) => {\n      if (e.target === modal) {\n        this.closeNotificationHistory();\n      }\n    });\n\n    // ESC\u30AD\u30FC\u3067\u9589\u3058\u308B\n    document.addEventListener('keydown', this.handleHistoryEscKey);\n  }\n\n  /**\n   * \u5C65\u6B74\u30E2\u30FC\u30C0\u30EB\u306EESC\u30AD\u30FC\u30CF\u30F3\u30C9\u30E9\n   */\n  private handleHistoryEscKey = (e: KeyboardEvent): void => {\n    if (e.key === 'Escape') {\n      this.closeNotificationHistory();\n    }\n  };\n\n  /**\n   * \u901A\u77E5\u5C65\u6B74\u30E2\u30FC\u30C0\u30EB\u3092\u9589\u3058\u308B\n   */\n  private closeNotificationHistory(): void {\n    const modal = document.getElementById('notificationHistoryModal');\n    if (modal) {\n      modal.classList.remove('active');\n      setTimeout(() => {\n        if (modal.parentNode) {\n          modal.parentNode.removeChild(modal);\n        }\n      }, 300);\n    }\n\n    // ESC\u30AD\u30FC\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u3092\u524A\u9664\n    document.removeEventListener('keydown', this.handleHistoryEscKey);\n  }\n\n  /**\n   * \u901A\u77E5\u5C65\u6B74\u3092\u30AF\u30EA\u30A2\n   */\n  public clearNotificationHistory(): void {\n    this.toastHistory = [];\n    this.updateHistoryButton();\n  }\n\n  /**\n   * \u30C8\u30FC\u30B9\u30C8\u901A\u77E5\u3092\u63CF\u753B\n   * @param toastData \u901A\u77E5\u30C7\u30FC\u30BF\n   */\n  private renderToast(toastData: ToastData): void {\n    // \u30C8\u30FC\u30B9\u30C8\u306EHTML\u69CB\u9020\u3092\u4F5C\u6210\n    const toast = document.createElement('div');\n    toast.id = toastData.id;\n    toast.className = `toast toast-${toastData.type}`;\n    toast.setAttribute('role', 'alert');\n    toast.setAttribute('aria-live', 'assertive');\n\n    // \u30A2\u30A4\u30B3\u30F3\u3092\u8A2D\u5B9A\n    let icon = '';\n    switch (toastData.type) {\n      case 'success':\n        icon = '\u2705';\n        break;\n      case 'warning':\n        icon = '\u26A0\uFE0F';\n        break;\n      case 'error':\n        icon = '\u274C';\n        break;\n      case 'info':\n        icon = '\u2139\uFE0F';\n        break;\n    }\n\n    // \u30C8\u30FC\u30B9\u30C8\u306E\u5185\u5BB9\u3092\u8A2D\u5B9A\n    toast.innerHTML = `\n      <div class=\"toast-icon\">${icon}</div>\n      <div class=\"toast-content\">\n        <h3 class=\"toast-title\">${toastData.title}</h3>\n        <p class=\"toast-message\">${toastData.message}</p>\n      </div>\n      <button class=\"toast-close\" aria-label=\"\u901A\u77E5\u3092\u9589\u3058\u308B\">\u00D7</button>\n    `;\n\n    // \u30C8\u30FC\u30B9\u30C8\u3092\u30B3\u30F3\u30C6\u30CA\u306B\u8FFD\u52A0\n    this.toastContainer.appendChild(toast);\n\n    // \u8981\u7D20\u3078\u306E\u53C2\u7167\u3092\u4FDD\u5B58\n    toastData.element = toast;\n\n    // \u9589\u3058\u308B\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u3092\u8A2D\u5B9A\n    const closeButton = toast.querySelector('.toast-close');\n    closeButton?.addEventListener('click', () => {\n      this.removeToast(toastData.id);\n    });\n\n    // \u4E00\u5B9A\u6642\u9593\u5F8C\u306B\u81EA\u52D5\u7684\u306B\u9589\u3058\u308B\n    if (toastData.duration > 0) {\n      setTimeout(() => {\n        this.removeToast(toastData.id);\n      }, toastData.duration);\n    }\n  }\n\n  /**\n   * \u30C8\u30FC\u30B9\u30C8\u901A\u77E5\u3092\u524A\u9664\n   * @param toastId \u524A\u9664\u3059\u308B\u30C8\u30FC\u30B9\u30C8\u306EID\n   */\n  public removeToast(toastId: string): void {\n    // \u30A2\u30AF\u30C6\u30A3\u30D6\u30EA\u30B9\u30C8\u304B\u3089\u524A\u9664\n    this.activeToasts = this.activeToasts.filter((toast) => toast.id !== toastId);\n\n    // \u8981\u7D20\u3092\u524A\u9664\n    this.removeToastElement(toastId);\n  }\n\n  /**\n   * \u30C8\u30FC\u30B9\u30C8\u8981\u7D20\u3092\u524A\u9664\n   * @param toastId \u524A\u9664\u3059\u308B\u30C8\u30FC\u30B9\u30C8\u8981\u7D20\u306EID\n   */\n  private removeToastElement(toastId: string): void {\n    const toast = document.getElementById(toastId);\n    if (toast) {\n      // \u30D5\u30A7\u30FC\u30C9\u30A2\u30A6\u30C8\u306E\u305F\u3081\u306E\u30B9\u30BF\u30A4\u30EB\u3092\u9069\u7528\n      toast.style.opacity = '0';\n      toast.style.transform = 'translateX(100%)';\n\n      // \u30A2\u30CB\u30E1\u30FC\u30B7\u30E7\u30F3\u5B8C\u4E86\u5F8C\u306B\u8981\u7D20\u3092\u524A\u9664\n      setTimeout(() => {\n        if (toast.parentNode) {\n          toast.parentNode.removeChild(toast);\n        }\n      }, 300);\n    }\n  }\n\n  /**\n   * \u30A8\u30E9\u30FC\u56DE\u5FA9\u306E\u305F\u3081\u306E\u901A\u77E5\u3092\u8868\u793A\n   * @param action \u56DE\u5FA9\u30A2\u30AF\u30B7\u30E7\u30F3\u60C5\u5831\n   */\n  public showRecoveryToast(action: { message: string; label: string; handler: () => void }): void {\n    const recoveryToastId = 'toast-recovery-' + Date.now();\n    const toast = document.createElement('div');\n    toast.id = recoveryToastId;\n    toast.className = 'toast toast-info';\n    toast.setAttribute('role', 'alert');\n    toast.setAttribute('aria-live', 'assertive');\n\n    toast.innerHTML = `\n      <div class=\"toast-icon\">\uD83D\uDD04</div>\n      <div class=\"toast-content\">\n        <h3 class=\"toast-title\">\u56DE\u5FA9\u30A2\u30AF\u30B7\u30E7\u30F3</h3>\n        <p class=\"toast-message\">${action.message}</p>\n      </div>\n      <button class=\"toast-action\" aria-label=\"${action.label}\">${action.label}</button>\n      <button class=\"toast-close\" aria-label=\"\u901A\u77E5\u3092\u9589\u3058\u308B\">\u00D7</button>\n    `;\n\n    this.toastContainer.appendChild(toast);\n\n    // \u30A2\u30AF\u30B7\u30E7\u30F3\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u3092\u8A2D\u5B9A\n    const actionButton = toast.querySelector('.toast-action');\n    actionButton?.addEventListener('click', () => {\n      action.handler();\n      this.removeToastElement(recoveryToastId);\n    });\n\n    // \u9589\u3058\u308B\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u3092\u8A2D\u5B9A\n    const closeButton = toast.querySelector('.toast-close');\n    closeButton?.addEventListener('click', () => {\n      this.removeToastElement(recoveryToastId);\n    });\n\n    // \u4E00\u5B9A\u6642\u9593\u5F8C\u306B\u81EA\u52D5\u7684\u306B\u9589\u3058\u308B\n    setTimeout(() => {\n      this.removeToastElement(recoveryToastId);\n    }, 15000); // \u56DE\u5FA9\u30A2\u30AF\u30B7\u30E7\u30F3\u306F\u9577\u3081\u306B\u8868\u793A\n  }\n}\n\n// \u30B0\u30ED\u30FC\u30D0\u30EB\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\uFF08\u9045\u5EF6\u521D\u671F\u5316\uFF09\nlet notificationSystemInstance: NotificationSystem | null = null;\n\n/**\n * NotificationSystem \u306E\u30B7\u30F3\u30B0\u30EB\u30C8\u30F3\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\u3059\u308B\u95A2\u6570\n * @returns NotificationSystem \u306E\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\n */\nexport function getNotificationSystem(): NotificationSystem {\n  if (!notificationSystemInstance) {\n    // DOM\u304C\u6E96\u5099\u3067\u304D\u3066\u3044\u308B\u304B\u78BA\u8A8D\u3057\u3066\u304B\u3089\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u5316\n    if (typeof document === 'undefined' || document.readyState === 'loading') {\n      // DOM\u6E96\u5099\u524D\u306B\u547C\u3070\u308C\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC\u30CF\u30F3\u30C9\u30EA\u30F3\u30B0\uFF08\u30C6\u30B9\u30C8\u74B0\u5883\u306A\u3069\u3092\u8003\u616E\uFF09\n      // console.warn('NotificationSystem accessed before DOM ready.');\n      // \u4EEE\u306E\u30B3\u30F3\u30C6\u30CAID\u3067\u521D\u671F\u5316\u3059\u308B\u304B\u3001\u30A8\u30E9\u30FC\u3092\u6295\u3052\u308B\u304B\u691C\u8A0E\u3002\n      // \u3053\u3053\u3067\u306F\u3001\u30C6\u30B9\u30C8\u74B0\u5883\u3067 document \u304C\u672A\u5B9A\u7FA9\u306E\u5834\u5408\u3092\u8003\u616E\u3057\u3001\n      // document\u30A2\u30AF\u30BB\u30B9\u3092\u907F\u3051\u308B\u304B\u3001\u30E2\u30C3\u30AF\u3092\u671F\u5F85\u3059\u308B\u3002\n      // \u5B9F\u969B\u306E\u30D6\u30E9\u30A6\u30B6\u74B0\u5883\u3067\u306F DOMContentLoaded \u5F8C\u306B\u547C\u3070\u308C\u308B\u60F3\u5B9A\u3002\n      // \u7C21\u5358\u306E\u305F\u3081\u3001\u3053\u3053\u3067\u306F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u5316\u3092\u8A66\u307F\u308B\u3002\n      // \u30C6\u30B9\u30C8\u5074\u3067 document \u3092\u9069\u5207\u306B\u30E2\u30C3\u30AF\u3059\u308B\u5FC5\u8981\u304C\u3042\u308B\u3002\n      try {\n        notificationSystemInstance = new NotificationSystem();\n      } catch (e) {\n        // document \u304C\u5229\u7528\u3067\u304D\u306A\u3044\u5834\u5408\u306E\u30A8\u30E9\u30FC\u51E6\u7406\n        console.error('Failed to initialize NotificationSystem likely due to missing document.', e);\n        // \u4EE3\u66FF\u5B9F\u88C5\u3084\u30A8\u30E9\u30FC\u3092\u6295\u3052\u308B\u306A\u3069\u3001\u9069\u5207\u306A\u51E6\u7406\u3092\u8FFD\u52A0\n        throw new Error('NotificationSystem cannot be initialized without a document.');\n      }\n    } else {\n      notificationSystemInstance = new NotificationSystem();\n    }\n  }\n  if (!notificationSystemInstance) {\n    // \u4E0A\u8A18 try-catch \u3067\u521D\u671F\u5316\u5931\u6557\u3057\u305F\u5834\u5408\u306E\u30D5\u30A9\u30FC\u30EB\u30D0\u30C3\u30AF\n    throw new Error('Failed to get NotificationSystem instance.');\n  }\n  return notificationSystemInstance;\n}\n\n// notificationSystem \u3092\u76F4\u63A5\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8\u3059\u308B\u4EE3\u308F\u308A\u306B\u30B2\u30C3\u30BF\u30FC\u3092\u4F7F\u7528\n// export const notificationSystem = getNotificationSystem(); // \u3053\u308C\u306F\u5373\u6642\u5B9F\u884C\u3055\u308C\u308B\u305F\u3081NG\n", "import { FileValidationResult } from './file-processor.ts'; // Import from file-processor where it was moved\n\n/**\n * \u30D5\u30A1\u30A4\u30EB\u306E\u30D0\u30EA\u30C7\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3059\u308B\u95A2\u6570\n * @param files \u30D0\u30EA\u30C7\u30FC\u30B7\u30E7\u30F3\u5BFE\u8C61\u306E\u30D5\u30A1\u30A4\u30EB\u914D\u5217\n * @returns \u691C\u8A3C\u7D50\u679C\u306E\u914D\u5217\n */\nexport async function validateFiles(files: File[]): Promise<FileValidationResult[]> {\n  if (!files || files.length === 0) {\n    throw new Error('\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093');\n  }\n\n  // \u691C\u8A3C\u7D50\u679C\u306E\u914D\u5217\n  const validationResults: FileValidationResult[] = [];\n\n  // \u5404\u30D5\u30A1\u30A4\u30EB\u3092\u691C\u8A3C\n  for (const file of files) {\n    try {\n      const content = await readFileAsText(file);\n      const result = validateFileContent(file, content);\n      validationResults.push(result);\n    } catch {\n      // \u30D5\u30A1\u30A4\u30EB\u8AAD\u307F\u8FBC\u307F\u30A8\u30E9\u30FC\u306E\u5834\u5408\n      validationResults.push({\n        file,\n        isValid: false,\n        warnings: [],\n        errors: ['\u4E0D\u660E\u306A\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F'],\n      });\n    }\n  }\n\n  return validationResults;\n}\n\n/**\n * \u30D5\u30A1\u30A4\u30EB\u3092\u30C6\u30AD\u30B9\u30C8\u3068\u3057\u3066\u8AAD\u307F\u8FBC\u3080\n * @param file \u8AAD\u307F\u8FBC\u3080\u30D5\u30A1\u30A4\u30EB\n * @returns \u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\n */\nexport function readFileAsText(file: File): Promise<string> {\n  // \u30C6\u30AD\u30B9\u30C8\u30D5\u30A1\u30A4\u30EB\u3067\u306A\u3044\u5834\u5408\u306F\u30A8\u30E9\u30FC\n  if (!file.type.includes('text') && !file.name.endsWith('.txt')) {\n    return Promise.reject(new Error('Read error: Invalid file format'));\n  }\n\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onload = (event): void => {\n      if (typeof event.target?.result === 'string') {\n        resolve(event.target.result);\n      } else {\n        reject(new Error('Read error: Invalid file format'));\n      }\n    };\n\n    reader.onerror = (): void => {\n      reject(new Error('Read error: File read failed'));\n    };\n\n    try {\n      reader.readAsText(file);\n    } catch {\n      reject(new Error('Read error: Cannot start reading file'));\n    }\n  });\n}\n\n/**\n * \u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\u3092\u691C\u8A3C\u3059\u308B\n * @param file \u30D5\u30A1\u30A4\u30EB\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n * @param content \u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\n * @returns \u691C\u8A3C\u7D50\u679C\n */\nexport function validateFileContent(file: File, content: string): FileValidationResult {\n  // \u691C\u8A3C\u7D50\u679C\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u306E\u521D\u671F\u5316\n  const result: FileValidationResult = {\n    file,\n    isValid: true,\n    warnings: [],\n    errors: [],\n  };\n\n  // \u57FA\u672C\u30C1\u30A7\u30C3\u30AF\uFF08\u7A7A\u30D5\u30A1\u30A4\u30EB\u3001\u6700\u4F4E\u884C\u6570\uFF09\n  if (!validateBasicContent(content, result)) {\n    return result; // \u57FA\u672C\u30C1\u30A7\u30C3\u30AF\u306B\u5931\u6557\u3057\u305F\u5834\u5408\u306F\u4EE5\u964D\u306E\u30C1\u30A7\u30C3\u30AF\u4E0D\u8981\n  }\n\n  // \u884C\u306B\u5206\u5272 (CRLF\u3068LF\u306E\u4E21\u65B9\u306B\u5BFE\u5FDC)\n  const lines = content.split(/\\r?\\n/);\n\n  // \u30D8\u30C3\u30C0\u30FC\u884C\u306E\u30C1\u30A7\u30C3\u30AF\n  validateHeaderLine(lines[0], result);\n\n  // \u30C7\u30FC\u30BF\u884C\u306E\u30C1\u30A7\u30C3\u30AF\uFF08\u6700\u521D\u306E5\u884C\u307E\u3067\uFF09\n  validateDataLines(lines, result);\n\n  return result;\n}\n\n/**\n * \u30D5\u30A1\u30A4\u30EB\u306E\u57FA\u672C\u7684\u306A\u5185\u5BB9\u3092\u30C1\u30A7\u30C3\u30AF\u3059\u308B\n * @param content \u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\n * @param result \u691C\u8A3C\u7D50\u679C\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n * @returns \u57FA\u672C\u30C1\u30A7\u30C3\u30AF\u306B\u6210\u529F\u3057\u305F\u304B\u3069\u3046\u304B\n */\nfunction validateBasicContent(content: string, result: FileValidationResult): boolean {\n  // 1. \u30D5\u30A1\u30A4\u30EB\u5168\u4F53\u304C\u7A7A\u3067\u306A\u3044\u304B\u30C1\u30A7\u30C3\u30AF\n  if (!content.trim()) {\n    result.isValid = false;\n    result.errors.push('\u30D5\u30A1\u30A4\u30EB\u304C\u7A7A\u3067\u3059');\n    return false; // \u7A7A\u306E\u5834\u5408\u306F\u4EE5\u964D\u306E\u30C1\u30A7\u30C3\u30AF\u4E0D\u8981\n  }\n\n  // 2. \u6700\u4F4E\u884C\u6570\u30C1\u30A7\u30C3\u30AF (\u30D8\u30C3\u30C0\u30FC\u884C + \u30C7\u30FC\u30BF\u884C1\u884C\u4EE5\u4E0A)\n  const lines = content.split(/\\r?\\n/);\n  if (lines.filter((line) => line.trim()).length < 2) {\n    result.isValid = false;\n    result.errors.push('\u30D5\u30A1\u30A4\u30EB\u304C\u7A7A\u304B\u3001\u30D8\u30C3\u30C0\u30FC\u884C\u307E\u305F\u306F\u30C7\u30FC\u30BF\u884C\u304C\u4E0D\u8DB3\u3057\u3066\u3044\u307E\u3059');\n    return false; // \u884C\u6570\u304C\u8DB3\u308A\u306A\u3044\u5834\u5408\u306F\u4EE5\u964D\u306E\u30C1\u30A7\u30C3\u30AF\u4E0D\u8981\n  }\n\n  return true;\n}\n\n/**\n * \u30D8\u30C3\u30C0\u30FC\u884C\u3092\u691C\u8A3C\u3059\u308B\n * @param headerLine \u30D8\u30C3\u30C0\u30FC\u884C\u306E\u5185\u5BB9\n * @param result \u691C\u8A3C\u7D50\u679C\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n */\nfunction validateHeaderLine(headerLine: string, result: FileValidationResult): void {\n  const trimmedHeader = headerLine.trim();\n\n  if (!trimmedHeader) {\n    // \u30D8\u30C3\u30C0\u30FC\u884C\u304C\u7A7A\u306E\u5834\u5408 (\u901A\u5E38\u306F\u3042\u308A\u3048\u306A\u3044\u304C\u5FF5\u306E\u305F\u3081)\n    result.warnings.push('\u30D8\u30C3\u30C0\u30FC\u884C\u304C\u7A7A\u306E\u3088\u3046\u3067\u3059');\n  } else if (!trimmedHeader.includes('\\t')) {\n    // \u30D8\u30C3\u30C0\u30FC\u884C\u306B\u30BF\u30D6\u304C\u542B\u307E\u308C\u3066\u3044\u306A\u3044\u5834\u5408 (\u30BF\u30D6\u533A\u5207\u308A\u3067\u306A\u3044\u53EF\u80FD\u6027)\n    result.warnings.push('\u30D8\u30C3\u30C0\u30FC\u884C\u306B\u30BF\u30D6\u533A\u5207\u308A\u304C\u898B\u3089\u308C\u307E\u305B\u3093');\n  }\n}\n\n/**\n * \u30C7\u30FC\u30BF\u884C\u3092\u691C\u8A3C\u3059\u308B\n * @param lines \u30D5\u30A1\u30A4\u30EB\u306E\u5168\u884C\n * @param result \u691C\u8A3C\u7D50\u679C\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n */\nfunction validateDataLines(lines: string[], result: FileValidationResult): void {\n  const sampleSize = Math.min(5, lines.length - 1); // \u30C1\u30A7\u30C3\u30AF\u3059\u308B\u30C7\u30FC\u30BF\u884C\u6570 (\u6700\u59275\u884C)\n  let tabWarningIssued = false; // \u30BF\u30D6\u533A\u5207\u308A\u8B66\u544A\u767A\u884C\u6E08\u307F\u30D5\u30E9\u30B0\n  let columnCountWarningIssued = false; // \u5217\u6570\u4E0D\u8DB3\u8B66\u544A\u767A\u884C\u6E08\u307F\u30D5\u30E9\u30B0\n  let actionDetailNumWarningIssued = false; // \u884C\u70BA\u660E\u7D30\u756A\u53F7\u5F62\u5F0F\u8B66\u544A\u767A\u884C\u6E08\u307F\u30D5\u30E9\u30B0\n\n  // \u30C7\u30FC\u30BF\u884C\u306E\u30EB\u30FC\u30D7 (\u30A4\u30F3\u30C7\u30C3\u30AF\u30B9 1 \u304B\u3089\u958B\u59CB)\n  for (let i = 1; i <= sampleSize; i++) {\n    // lines[i] \u304C\u5B58\u5728\u3057\u306A\u3044\u5834\u5408 (\u30D5\u30A1\u30A4\u30EB\u672B\u5C3E\u306E\u7A7A\u884C\u306A\u3069) \u306F\u30B9\u30AD\u30C3\u30D7\n    if (lines[i] === undefined) continue;\n\n    const line = lines[i].trim();\n    // \u7A7A\u306E\u30C7\u30FC\u30BF\u884C\u306F\u30B9\u30AD\u30C3\u30D7\n    if (!line) continue;\n\n    // \u5404\u884C\u3092\u691C\u8A3C\u3057\u3001\u767A\u751F\u3057\u305F\u8B66\u544A\u30D5\u30E9\u30B0\u3092\u53D7\u3051\u53D6\u308B\n    const lineWarnings = validateDataLine(line, i, result);\n\n    // \u30BF\u30D6\u533A\u5207\u308A\u8B66\u544A (\u4E00\u5EA6\u3060\u3051\u8FFD\u52A0)\n    if (lineWarnings.tabWarningIssued && !tabWarningIssued) {\n      result.warnings.push(`\u4E00\u90E8\u306E\u30C7\u30FC\u30BF\u884C\u306B\u30BF\u30D6\u533A\u5207\u308A\u304C\u898B\u3089\u308C\u307E\u305B\u3093 (\u6700\u521D\u306E\u4F8B: \u884C ${i + 1})`);\n      tabWarningIssued = true;\n    }\n\n    // \u5217\u6570\u4E0D\u8DB3\u8B66\u544A (\u4E00\u5EA6\u3060\u3051\u8FFD\u52A0)\n    if (lineWarnings.columnCountWarningIssued && !columnCountWarningIssued) {\n      // validateDateAndActionDetail \u3067\u5217\u6570\u4E0D\u8DB3\u304C\u691C\u51FA\u3055\u308C\u305F\u5834\u5408\u3082\u8003\u616E\n      const columns = line.split('\\t'); // \u518D\u5EA6\u5206\u5272\u3057\u3066\u5B9F\u969B\u306E\u5217\u6570\u3092\u53D6\u5F97\n      if (columns.length < 4) {\n        result.warnings.push(\n          `\u4E00\u90E8\u306E\u30C7\u30FC\u30BF\u884C\u3067\u5165\u9662\u5E74\u6708\u65E5(4\u5217\u76EE)\u304C\u78BA\u8A8D\u3067\u304D\u307E\u305B\u3093 (\u5217\u6570\u4E0D\u8DB3) (\u6700\u521D\u306E\u4F8B: \u884C ${i + 1})`,\n        );\n      } else if (columns.length < 7) {\n        result.warnings.push(\n          `\u4E00\u90E8\u306E\u30C7\u30FC\u30BF\u884C\u3067\u884C\u70BA\u660E\u7D30\u756A\u53F7(7\u5217\u76EE)\u304C\u78BA\u8A8D\u3067\u304D\u307E\u305B\u3093 (\u5217\u6570\u4E0D\u8DB3) (\u6700\u521D\u306E\u4F8B: \u884C ${i + 1})`,\n        );\n      } else {\n        // \u4E0A\u8A18\u4EE5\u5916 (validateDataLine \u306E columns.length < 10 \u3067\u691C\u51FA)\n        result.warnings.push(\n          `\u4E00\u90E8\u306E\u30C7\u30FC\u30BF\u884C\u306E\u5217\u6570\u304C\u5C11\u306A\u3044\u3088\u3046\u3067\u3059 (10\u5217\u672A\u6E80) (\u6700\u521D\u306E\u4F8B: \u884C ${\n            i + 1\n          }, \u5217\u6570: ${columns.length})`,\n        );\n      }\n      columnCountWarningIssued = true;\n    }\n\n    // \u884C\u70BA\u660E\u7D30\u756A\u53F7\u5F62\u5F0F\u8B66\u544A (\u4E00\u5EA6\u3060\u3051\u8FFD\u52A0)\n    if (lineWarnings.actionDetailNumWarningIssued && !actionDetailNumWarningIssued) {\n      const columns = line.split('\\t'); // \u518D\u5EA6\u5206\u5272\n      const actionDetailNum = columns.length > 6 ? columns[6].trim() : '';\n      result.warnings.push(\n        `\u884C\u70BA\u660E\u7D30\u756A\u53F7(7\u5217\u76EE)\u306E\u5F62\u5F0F\u304C\u4E0D\u6B63\u306E\u3088\u3046\u3067\u3059 (000 or 3\u6841\u6570\u5B57) (\u6700\u521D\u306E\u4F8B: \u884C ${\n          i + 1\n        }, \u5024: ${actionDetailNum})`,\n      );\n      actionDetailNumWarningIssued = true;\n    }\n  }\n}\n\n/**\n * 1\u884C\u306E\u30C7\u30FC\u30BF\u3092\u691C\u8A3C\u3059\u308B\n * @param line \u691C\u8A3C\u5BFE\u8C61\u306E\u884C\n * @param lineIndex \u884C\u306E\u30A4\u30F3\u30C7\u30C3\u30AF\u30B9\uFF080\u8D77\u70B9\uFF09\n * @param result \u691C\u8A3C\u7D50\u679C\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n * @returns \u767A\u751F\u3057\u305F\u8B66\u544A\u30D5\u30E9\u30B0\u306E\u72B6\u614B\n */\nfunction validateDataLine(\n  line: string,\n  lineIndex: number,\n  result: FileValidationResult,\n): {\n  tabWarningIssued: boolean;\n  columnCountWarningIssued: boolean;\n  actionDetailNumWarningIssued: boolean;\n} {\n  let tabWarningIssued = false;\n  let columnCountWarningIssued = false;\n  let actionDetailNumWarningIssued = false;\n\n  // 5-1. \u30BF\u30D6\u533A\u5207\u308A\u5F62\u5F0F\u30C1\u30A7\u30C3\u30AF (\u8B66\u544A)\n  if (!line.includes('\\t')) {\n    tabWarningIssued = true;\n    // \u30BF\u30D6\u304C\u306A\u3044\u5834\u5408\u3001\u4EE5\u964D\u306E\u5217\u30C1\u30A7\u30C3\u30AF\u306F\u7121\u610F\u5473\u306A\u306E\u3067\u30B9\u30AD\u30C3\u30D7\n    return { tabWarningIssued, columnCountWarningIssued, actionDetailNumWarningIssued };\n  }\n\n  // \u30BF\u30D6\u3067\u5217\u306B\u5206\u5272\n  const columns = line.split('\\t');\n\n  // 5-2. \u5217\u6570\u30C1\u30A7\u30C3\u30AF (\u8B66\u544A) - 10\u5217\u672A\u6E80\n  if (columns.length < 10) {\n    columnCountWarningIssued = true;\n    // \u5217\u6570\u304C\u5C11\u306A\u3044\u5834\u5408\u3001\u7279\u5B9A\u306E\u5217\u3078\u306E\u30A2\u30AF\u30BB\u30B9\u306F\u5371\u967A\u306A\u306E\u3067\u30B9\u30AD\u30C3\u30D7\n    // (\u305F\u3060\u3057\u3001\u4ED6\u306E\u884C\u3067\u5341\u5206\u306A\u5217\u6570\u304C\u3042\u308B\u53EF\u80FD\u6027\u3082\u3042\u308B\u305F\u3081\u3001\u30EB\u30FC\u30D7\u306F\u7D99\u7D9A)\n    // \u8B66\u544A\u30E1\u30C3\u30BB\u30FC\u30B8\u306F\u547C\u3073\u51FA\u3057\u5143 (validateDataLines) \u3067\u8FFD\u52A0\n    return { tabWarningIssued, columnCountWarningIssued, actionDetailNumWarningIssued };\n  }\n\n  // \u5165\u9662\u5E74\u6708\u65E5\u3068\u884C\u70BA\u660E\u7D30\u756A\u53F7\u306E\u691C\u8A3C\n  const dateActionResult = validateDateAndActionDetail(columns, lineIndex, result);\n  // validateDateAndActionDetail\u5185\u3067\u5217\u6570\u4E0D\u8DB3\u304C\u5224\u660E\u3059\u308B\u5834\u5408\u304C\u3042\u308B\u305F\u3081\u3001\u3053\u3053\u3067\u66F4\u65B0\n  columnCountWarningIssued = dateActionResult.columnCountWarningIssued;\n  actionDetailNumWarningIssued = dateActionResult.actionDetailNumWarningIssued;\n\n  // \u8B66\u544A\u30E1\u30C3\u30BB\u30FC\u30B8\u306F\u547C\u3073\u51FA\u3057\u5143 (validateDataLines) \u3067\u8FFD\u52A0\n  return { tabWarningIssued, columnCountWarningIssued, actionDetailNumWarningIssued };\n}\n\n/**\n * \u5165\u9662\u5E74\u6708\u65E5\u3068\u884C\u70BA\u660E\u7D30\u756A\u53F7\u3092\u691C\u8A3C\u3059\u308B\n * @param columns \u884C\u306E\u5217\u30C7\u30FC\u30BF\n * @param lineIndex \u884C\u306E\u30A4\u30F3\u30C7\u30C3\u30AF\u30B9\uFF080\u8D77\u70B9\uFF09\n * @param result \u691C\u8A3C\u7D50\u679C\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n * @returns \u767A\u751F\u3057\u305F\u8B66\u544A\u30D5\u30E9\u30B0\u306E\u72B6\u614B { columnCountWarningIssued, actionDetailNumWarningIssued }\n */\nfunction validateDateAndActionDetail(\n  columns: string[],\n  lineIndex: number,\n  result: FileValidationResult,\n): { columnCountWarningIssued: boolean; actionDetailNumWarningIssued: boolean } {\n  let columnCountWarningIssued = false;\n  let actionDetailNumWarningIssued = false;\n\n  // 5-3. \u5165\u9662\u5E74\u6708\u65E5 (\u52174, \u30A4\u30F3\u30C7\u30C3\u30AF\u30B93) \u306E\u5F62\u5F0F\u30C1\u30A7\u30C3\u30AF (\u30A8\u30E9\u30FC)\n  if (columns.length > 3) {\n    const admission = columns[3].trim(); // 4\u5217\u76EE\u306E\u5024\u3092\u53D6\u5F97\n    const dateRegex = /^(\\d{8}|00000000)$/; // yyyymmdd \u307E\u305F\u306F 00000000\n    if (!dateRegex.test(admission)) {\n      result.isValid = false; // \u4E0D\u6B63\u306A\u5F62\u5F0F\u306A\u3089\u30D5\u30A1\u30A4\u30EB\u3092\u7121\u52B9\u3068\u3059\u308B\n      // \u30A8\u30E9\u30FC\u30E1\u30C3\u30BB\u30FC\u30B8\u306F\u6700\u521D\u306E\u4E00\u3064\u3060\u3051\u8A18\u9332\u3059\u308B\n      if (\n        result.errors.length === 0 ||\n        !result.errors.some((e: string) => e.startsWith('\u5165\u9662\u5E74\u6708\u65E5'))\n      ) {\n        result.errors.push(\n          `\u5165\u9662\u5E74\u6708\u65E5(4\u5217\u76EE)\u306E\u5F62\u5F0F\u304C\u4E0D\u6B63\u3067\u3059 (yyyymmdd or 00000000) (\u6700\u521D\u306E\u4F8B: \u884C ${\n            lineIndex + 1\n          }, \u5024: ${admission})`,\n        );\n      }\n      // \u30A8\u30E9\u30FC\u304C\u898B\u3064\u304B\u3063\u3066\u3082\u3001\u4ED6\u306E\u8B66\u544A\u3092\u62FE\u3046\u305F\u3081\u306B\u30EB\u30FC\u30D7\u306F\u7D99\u7D9A\n    }\n  } else {\n    // \u5217\u6570\u304C\u8DB3\u308A\u306A\u3044\u5834\u5408\n    columnCountWarningIssued = true; // \u5217\u6570\u4E0D\u8DB3\u306E\u8B66\u544A\u30D5\u30E9\u30B0\u3092\u7ACB\u3066\u308B\n  }\n\n  // 5-4. \u884C\u70BA\u660E\u7D30\u756A\u53F7 (\u52177, \u30A4\u30F3\u30C7\u30C3\u30AF\u30B96) \u306E\u5F62\u5F0F\u30C1\u30A7\u30C3\u30AF (\u8B66\u544A)\n  if (columns.length > 6) {\n    const actionDetailNum = columns[6].trim(); // 7\u5217\u76EE\u306E\u5024\u3092\u53D6\u5F97\n    const actionDetailRegex = /^(000|\\d{3})$/; // 000 \u307E\u305F\u306F 3\u6841\u306E\u6570\u5B57\n    if (!actionDetailRegex.test(actionDetailNum)) {\n      actionDetailNumWarningIssued = true; // \u8B66\u544A\u30D5\u30E9\u30B0\u3092\u7ACB\u3066\u308B\n    }\n  } else if (!columnCountWarningIssued) {\n    // \u5217\u6570\u304C\u8DB3\u308A\u306A\u3044\u5834\u5408 (\u5165\u9662\u5E74\u6708\u65E5\u306E\u30C1\u30A7\u30C3\u30AF\u3067\u65E2\u306B\u7ACB\u3063\u3066\u3044\u308B\u53EF\u80FD\u6027\u3082\u3042\u308B)\n    columnCountWarningIssued = true; // \u5217\u6570\u4E0D\u8DB3\u306E\u8B66\u544A\u30D5\u30E9\u30B0\u3092\u7ACB\u3066\u308B\n  }\n\n  // \u8B66\u544A\u30E1\u30C3\u30BB\u30FC\u30B8\u306E\u8FFD\u52A0\u306F\u547C\u3073\u51FA\u3057\u5143 (validateDataLines) \u3067\u884C\u3046\n  return { columnCountWarningIssued, actionDetailNumWarningIssued };\n}\n", "import { FileValidationResult } from '../../core/file-processor.ts';\nimport { ErrorHandlerOptions } from '../../core/common/types.ts';\nimport { getNotificationSystem, NotificationSystem } from './notification.ts'; // NotificationSystem \u578B\u3082\u30A4\u30F3\u30DD\u30FC\u30C8\nimport { validateFiles } from '../../core/validator.ts';\n\n/**\n * \u30D5\u30A1\u30A4\u30EB\u7BA1\u7406\u30AF\u30E9\u30B9\n * \u30D5\u30A1\u30A4\u30EB\u306E\u9078\u629E\u3001\u8868\u793A\u3001\u7BA1\u7406\u3092\u884C\u3046\u30B3\u30F3\u30DD\u30FC\u30CD\u30F3\u30C8\n */\nexport class FileManager {\n  private fileInput: HTMLInputElement;\n  private fileInfoArea: HTMLElement;\n  private clearButton: HTMLButtonElement;\n  private executeButton: HTMLButtonElement;\n  private dropArea: HTMLElement;\n  private selectedFiles: File[] = [];\n  private validFiles: number = 0;\n  private notification: NotificationSystem; // \u901A\u77E5\u30B7\u30B9\u30C6\u30E0\u3078\u306E\u53C2\u7167\u3092\u8FFD\u52A0\n\n  /**\n   * \u30D5\u30A1\u30A4\u30EB\u7BA1\u7406\u30AF\u30E9\u30B9\u306E\u30B3\u30F3\u30B9\u30C8\u30E9\u30AF\u30BF\n   * @param notificationSystemInstance - \u4F7F\u7528\u3059\u308B\u901A\u77E5\u30B7\u30B9\u30C6\u30E0\u306E\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\n   */\n  constructor(notificationSystemInstance: NotificationSystem) { // \u4F9D\u5B58\u6027\u6CE8\u5165\n    this.notification = notificationSystemInstance; // \u6CE8\u5165\u3055\u308C\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F7F\u7528\n\n    // DOM\u8981\u7D20\u306E\u53D6\u5F97\n    this.fileInput = document.getElementById('fileInput') as HTMLInputElement;\n    this.fileInfoArea = document.getElementById('fileInfoArea') as HTMLElement;\n    this.clearButton = document.getElementById('clearButton') as HTMLButtonElement;\n    this.executeButton = document.getElementById('executeButton') as HTMLButtonElement;\n    this.dropArea = document.getElementById('dropArea') as HTMLElement;\n\n    if (\n      !this.fileInput ||\n      !this.fileInfoArea ||\n      !this.clearButton ||\n      !this.executeButton ||\n      !this.dropArea\n    ) {\n      throw new Error('\u5FC5\u8981\u306ADOM\u8981\u7D20\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093');\n    }\n\n    this.setupEventListeners();\n  }\n\n  /**\n   * \u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\n   */\n  private setupEventListeners(): void {\n    // \u30D5\u30A1\u30A4\u30EB\u9078\u629E\u30DC\u30BF\u30F3\n    const fileSelectButton = document.getElementById('fileSelectButton');\n    if (fileSelectButton) {\n      fileSelectButton.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.fileInput.click();\n      });\n    }\n\n    // \u30D5\u30A1\u30A4\u30EB\u9078\u629E\u6642\u306E\u51E6\u7406\n    this.fileInput.addEventListener('change', () => {\n      this.processNewFiles(Array.from(this.fileInput.files || []));\n    });\n\n    // \u30C9\u30E9\u30C3\u30B0&\u30C9\u30ED\u30C3\u30D7\u51E6\u7406\n    this.dropArea.addEventListener('dragover', (e) => this.handleDragOver(e)); // Use public method\n    this.dropArea.addEventListener('dragleave', (e) => this.handleDragLeave(e)); // Use public method\n    this.dropArea.addEventListener('drop', (e) => this.handleDrop(e)); // Use public method\n\n    // \u30AD\u30FC\u30DC\u30FC\u30C9\u64CD\u4F5C\u306E\u30B5\u30DD\u30FC\u30C8\n    this.dropArea.addEventListener('keydown', (e) => {\n      // Enter\u30AD\u30FC\u307E\u305F\u306F\u30B9\u30DA\u30FC\u30B9\u30AD\u30FC\u3067\u30D5\u30A1\u30A4\u30EB\u9078\u629E\u30C0\u30A4\u30A2\u30ED\u30B0\u3092\u958B\u304F\n      if (e.key === 'Enter' || e.key === ' ') {\n        e.preventDefault();\n        this.fileInput.click();\n      }\n    });\n\n    // \u30C9\u30ED\u30C3\u30D7\u30A8\u30EA\u30A2\u5168\u4F53\u3092\u30AF\u30EA\u30C3\u30AF\u53EF\u80FD\u306B\n    this.dropArea.addEventListener('click', (e) => {\n      // button\u306E\u5834\u5408\u306F\u3001button\u306E\u30A4\u30D9\u30F3\u30C8\u306B\u4EFB\u305B\u308B\n      if ((e.target as HTMLElement).tagName !== 'BUTTON') {\n        this.fileInput.click();\n      }\n    });\n\n    // \u30AF\u30EA\u30A2\u30DC\u30BF\u30F3\u306E\u51E6\u7406\n    this.clearButton.addEventListener('click', () => {\n      this.clearFiles();\n    });\n\n    // \u30D5\u30A1\u30A4\u30EB\u524A\u9664\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC (\u30A4\u30D9\u30F3\u30C8\u59D4\u8B72)\n    this.fileInfoArea.addEventListener('click', (event) => {\n      const target = event.target as HTMLElement;\n      if (target.classList.contains('delete-file-button')) {\n        const fileName = target.dataset.filename;\n        if (fileName) {\n          this.removeFile(fileName);\n        }\n      }\n    });\n  }\n\n  /**\n   * \u30C9\u30E9\u30C3\u30B0\u30AA\u30FC\u30D0\u30FC\u30A4\u30D9\u30F3\u30C8\u306E\u30CF\u30F3\u30C9\u30E9\n   * @param event \u30C9\u30E9\u30C3\u30B0\u30A4\u30D9\u30F3\u30C8\n   */\n  public handleDragOver(event: DragEvent): void {\n    // Changed to public\n    event.preventDefault(); // \u30C7\u30D5\u30A9\u30EB\u30C8\u306E\u51E6\u7406\u3092\u30AD\u30E3\u30F3\u30BB\u30EB\n    this.dropArea.classList.add('drag-over');\n  }\n\n  /**\n   * \u30C9\u30E9\u30C3\u30B0\u30EA\u30FC\u30D6\u30A4\u30D9\u30F3\u30C8\u306E\u30CF\u30F3\u30C9\u30E9\n   * @param event \u30C9\u30E9\u30C3\u30B0\u30A4\u30D9\u30F3\u30C8\n   */\n  public handleDragLeave(event: DragEvent): void {\n    // Changed to public\n    event.preventDefault();\n    this.dropArea.classList.remove('drag-over');\n  }\n\n  /**\n   * \u30C9\u30ED\u30C3\u30D7\u30A4\u30D9\u30F3\u30C8\u306E\u30CF\u30F3\u30C9\u30E9\n   * @param event \u30C9\u30E9\u30C3\u30B0\u30A4\u30D9\u30F3\u30C8\n   */\n  public handleDrop(event: DragEvent): void {\n    // Changed to public\n    event.preventDefault();\n    this.dropArea.classList.remove('drag-over');\n\n    if (event.dataTransfer && event.dataTransfer.files.length > 0) {\n      // \u30C9\u30ED\u30C3\u30D7\u3055\u308C\u305F\u30D5\u30A1\u30A4\u30EB\u3092\u51E6\u7406\n      this.processNewFiles(Array.from(event.dataTransfer.files));\n    }\n  }\n\n  /**\n   * \u65B0\u3057\u304F\u9078\u629E\u3055\u308C\u305F\u30D5\u30A1\u30A4\u30EB\u3092\u51E6\u7406\u3059\u308B\n   * @param files \u51E6\u7406\u5BFE\u8C61\u306E\u30D5\u30A1\u30A4\u30EB\u914D\u5217\n   */\n  public async processNewFiles(files: File[]): Promise<void> {\n    // async \u3068 Promise<void> \u3092\u8FFD\u52A0\n    // \u30C6\u30AD\u30B9\u30C8\u30D5\u30A1\u30A4\u30EB\u306E\u307F\u3092\u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\n    const textFiles = Array.from(files).filter(\n      (file) => file.type === 'text/plain' || file.name.endsWith('.txt'),\n    );\n\n    // \u30C6\u30AD\u30B9\u30C8\u30D5\u30A1\u30A4\u30EB\u4EE5\u5916\u304C\u542B\u307E\u308C\u3066\u3044\u305F\u5834\u5408\n    if (textFiles.length < files.length) {\n      this.handleError(new Error('\u30C6\u30AD\u30B9\u30C8\u30D5\u30A1\u30A4\u30EB\u4EE5\u5916\u304C\u542B\u307E\u308C\u3066\u3044\u307E\u3059'), 'file-format');\n      return;\n    }\n\n    // \u65E2\u306B\u8FFD\u52A0\u3055\u308C\u3066\u3044\u308B\u30D5\u30A1\u30A4\u30EB\u3068\u91CD\u8907\u3059\u308B\u3082\u306E\u3092\u78BA\u8A8D\n    const existingFileNames = Array.from(this.selectedFiles).map((f) => f.name);\n    const newFiles = textFiles.filter((file) => !existingFileNames.includes(file.name));\n    const duplicateCount = textFiles.length - newFiles.length;\n\n    // \u65B0\u3057\u3044\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\n    newFiles.forEach((file) => this.selectedFiles.push(file));\n\n    // \u30D5\u30A1\u30A4\u30EB\u60C5\u5831\u3092\u66F4\u65B0\n    this.updateFileInfo();\n\n    // \u7D50\u679C\u3092\u30E6\u30FC\u30B6\u30FC\u306B\u901A\u77E5\n    if (newFiles.length === 0 && textFiles.length > 0) {\n      // Check if only duplicates were added\n      this.handleError(new Error('\u3059\u3079\u3066\u306E\u30D5\u30A1\u30A4\u30EB\u304C\u65E2\u306B\u8FFD\u52A0\u3055\u308C\u3066\u3044\u307E\u3059'), 'file-duplicate', {\n        recoveryAction: {\n          message: '\u65E2\u5B58\u306E\u30D5\u30A1\u30A4\u30EB\u3092\u30AF\u30EA\u30A2\u3057\u3066\u65B0\u3057\u3044\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\u3057\u307E\u3059\u304B\uFF1F',\n          label: '\u30AF\u30EA\u30A2\u3057\u3066\u8FFD\u52A0',\n          handler: () => {\n            this.selectedFiles = [...textFiles]; // Keep only the newly added (duplicate) files after clearing\n            this.updateFileInfo();\n            this.notification.showToast( // \u6CE8\u5165\u3055\u308C\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F7F\u7528\n              'success',\n              '\u30D5\u30A1\u30A4\u30EB\u66F4\u65B0\u5B8C\u4E86',\n              `${textFiles.length}\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F`,\n            );\n            this.validateSelectedFiles(); // Re-validate after clearing and adding\n          },\n        },\n      });\n    } else if (duplicateCount > 0) {\n      this.notification.showToast( // \u6CE8\u5165\u3055\u308C\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F7F\u7528\n        'warning',\n        '\u30D5\u30A1\u30A4\u30EB\u91CD\u8907',\n        `${newFiles.length}\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F (${duplicateCount}\u30D5\u30A1\u30A4\u30EB\u306F\u91CD\u8907)`, // Show count of actually added files\n        5000,\n        3,\n      );\n    } else if (newFiles.length > 0) {\n      // Only show success if new files were actually added\n      this.notification.showToast( // \u6CE8\u5165\u3055\u308C\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F7F\u7528\n        'success',\n        '\u30D5\u30A1\u30A4\u30EB\u8FFD\u52A0\u5B8C\u4E86',\n        `${newFiles.length}\u30D5\u30A1\u30A4\u30EB\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F`,\n        5000,\n        2,\n      );\n    }\n\n    // \u65B0\u3057\u3044\u30D5\u30A1\u30A4\u30EB\u304C\u3042\u308B\u5834\u5408\u3001\u307E\u305F\u306F\u91CD\u8907\u306E\u307F\u3067\u3082\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u308B\u5834\u5408\u306F\u691C\u8A3C\u3092\u5B9F\u884C\n    if (newFiles.length > 0 || this.selectedFiles.length > 0) {\n      await this.validateSelectedFiles(); // await \u3092\u8FFD\u52A0\n    }\n  }\n\n  /**\n   * \u9078\u629E\u3055\u308C\u305F\u30D5\u30A1\u30A4\u30EB\u3092\u30AF\u30EA\u30A2\u3059\u308B\n   */\n  public clearFiles(): void {\n    // \u9078\u629E\u3055\u308C\u305F\u30D5\u30A1\u30A4\u30EB\u3092\u30AF\u30EA\u30A2\n    this.selectedFiles = [];\n    this.fileInput.value = '';\n    this.validFiles = 0;\n\n    // \u30D5\u30A1\u30A4\u30EB\u60C5\u5831\u8868\u793A\u3092\u66F4\u65B0\n    this.updateFileInfo();\n\n    // \u30A4\u30D9\u30F3\u30C8\u901A\u77E5\n    const event = new CustomEvent('filesClear');\n    document.dispatchEvent(event);\n\n    this.notification.showToast('info', '\u30AF\u30EA\u30A2\u5B8C\u4E86', '\u30D5\u30A1\u30A4\u30EB\u9078\u629E\u3092\u30AF\u30EA\u30A2\u3057\u307E\u3057\u305F'); // \u6CE8\u5165\u3055\u308C\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F7F\u7528\n  }\n\n  /**\n   * \u6307\u5B9A\u3055\u308C\u305F\u30D5\u30A1\u30A4\u30EB\u3092\u30EA\u30B9\u30C8\u304B\u3089\u524A\u9664\u3059\u308B\n   * @param fileName \u524A\u9664\u3059\u308B\u30D5\u30A1\u30A4\u30EB\u540D\n   */\n  public removeFile(fileName: string): void {\n    const initialLength = this.selectedFiles.length;\n    this.selectedFiles = this.selectedFiles.filter((file) => file.name !== fileName);\n\n    // \u30D5\u30A1\u30A4\u30EB\u304C\u5B9F\u969B\u306B\u524A\u9664\u3055\u308C\u305F\u304B\u78BA\u8A8D\n    if (this.selectedFiles.length < initialLength) {\n      this.notification.showToast('info', '\u30D5\u30A1\u30A4\u30EB\u524A\u9664', `${fileName} \u3092\u524A\u9664\u3057\u307E\u3057\u305F`); // \u6CE8\u5165\u3055\u308C\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F7F\u7528\n      this.updateFileInfo(); // UI\u3092\u66F4\u65B0\n      this.validateSelectedFiles(); // \u518D\u691C\u8A3C\u3057\u3066\u5B9F\u884C\u30DC\u30BF\u30F3\u306E\u72B6\u614B\u3092\u66F4\u65B0\n    }\n  }\n\n  /**\n   * \u9078\u629E\u3055\u308C\u305F\u30D5\u30A1\u30A4\u30EB\u3092\u691C\u8A3C\u3059\u308B\n   */\n  public async validateSelectedFiles(): Promise<boolean> {\n    if (this.selectedFiles.length === 0) {\n      this.updateFileInfo(); // Ensure UI reflects no files selected\n      return false;\n    }\n\n    try {\n      // \u5916\u90E8\u306EvalidateFiles\u30E2\u30B8\u30E5\u30FC\u30EB\u3092\u4F7F\u7528\n      const results = await validateFiles(this.selectedFiles);\n      this.updateValidationUI(results);\n\n      // \u6709\u52B9\u306A\u30D5\u30A1\u30A4\u30EB\u6570\u3092\u8A08\u7B97\uFF08\u578B\u60C5\u5831\u3092\u660E\u793A\u7684\u306B\u6307\u5B9A\uFF09\n      this.validFiles = results.filter((result: FileValidationResult) => result.isValid).length;\n\n      // \u5B9F\u884C\u30DC\u30BF\u30F3\u306E\u6709\u52B9/\u7121\u52B9\u3092\u66F4\u65B0\n      this.executeButton.disabled = this.validFiles === 0;\n\n      return this.validFiles > 0;\n    } catch (error) {\n      this.handleError(\n        error instanceof Error ? error : new Error('\u4E0D\u660E\u306A\u30A8\u30E9\u30FC'),\n        'file-validation',\n      );\n      this.executeButton.disabled = true; // Disable execute button on validation error\n      return false;\n    }\n  }\n\n  /**\n   * \u691C\u8A3C\u7D50\u679C\u3092UI\u306B\u53CD\u6620\u3059\u308B\n   * @param results \u691C\u8A3C\u7D50\u679C\u306E\u914D\u5217\n   */\n  private updateValidationUI(results: FileValidationResult[]): void {\n    // \u30D5\u30A1\u30A4\u30EB\u60C5\u5831UI\u3092\u66F4\u65B0\n    this.updateFileInfo(results);\n  }\n\n  /**\n   * \u30D5\u30A1\u30A4\u30EB\u60C5\u5831\u8868\u793A\u3092\u66F4\u65B0\u3059\u308B\n   * @param validationResults \u691C\u8A3C\u7D50\u679C\u304C\u3042\u308C\u3070\u53CD\u6620\n   */\n  private updateFileInfo(validationResults?: FileValidationResult[]): void {\n    // \u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u308B\u304B\u78BA\u8A8D\n    if (this.selectedFiles.length === 0) {\n      this.fileInfoArea.innerHTML = '<p class=\"no-file-message\">\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093</p>';\n      this.clearButton.disabled = true;\n      this.executeButton.disabled = true;\n      return;\n    }\n\n    // \u30D5\u30A1\u30A4\u30EB\u30A2\u30A4\u30C6\u30E0\u306EHTML\u3092\u751F\u6210\n    let html = '';\n\n    this.selectedFiles.forEach((file) => {\n      // \u691C\u8A3C\u7D50\u679C\u3092\u63A2\u3059\n      type FileStatus = {\n        status: string;\n        messages: Array<{ type: string; text: string }>;\n      };\n      let fileStatus: FileStatus = { status: 'pending', messages: [] };\n\n      if (validationResults) {\n        const result = validationResults.find((r) => r.file === file);\n        if (result) {\n          fileStatus = {\n            status: result.isValid ? (result.warnings.length > 0 ? 'warning' : 'valid') : 'error',\n            messages: [\n              ...result.errors.map((msg: string) => ({ type: 'error', text: msg })), // Add string type to msg\n              ...result.warnings.map((msg: string) => ({ type: 'warning', text: msg })), // Add string type to msg\n            ],\n          };\n        }\n      }\n\n      html += `\n        <div class=\"file-item\">\n          <div class=\"file-icon\">\uD83D\uDCC4</div>\n          <div class=\"file-name\">${file.name}</div>\n      `;\n\n      // \u30D0\u30EA\u30C7\u30FC\u30B7\u30E7\u30F3\u30E1\u30C3\u30BB\u30FC\u30B8\u304C\u3042\u308B\u5834\u5408\u306F\u8868\u793A\n      if (fileStatus.messages && fileStatus.messages.length > 0) {\n        html += '<div class=\"validation-feedback\">';\n        fileStatus.messages.forEach((msg: { type: string; text: string }) => {\n          let icon = '';\n          switch (msg.type) {\n            case 'error':\n              icon = '\u274C';\n              break;\n            case 'warning':\n              icon = '\u26A0\uFE0F';\n              break;\n            case 'info':\n              icon = '\u2139\uFE0F';\n              break;\n          }\n          html += `\n            <div class=\"validation-message ${msg.type}\">\n              <span class=\"validation-icon\">${icon}</span>\n              <span class=\"validation-text\">${msg.text}</span>\n            </div>\n          `;\n        });\n        html += '</div>';\n      } else if (fileStatus.status === 'valid') {\n        html += `\n          <div class=\"validation-feedback\">\n            <div class=\"validation-message success\">\n              <span class=\"validation-icon\">\u2705</span>\n              <span class=\"validation-text\">\u30D5\u30A1\u30A4\u30EB\u5F62\u5F0F\u306F\u6709\u52B9\u3067\u3059</span>\n            </div>\n          </div>\n        `;\n      }\n\n      // \u524A\u9664\u30DC\u30BF\u30F3\u3092\u6700\u5F8C\uFF08\u53F3\u5074\uFF09\u306B\u914D\u7F6E\n      html += `\n          <button class=\"delete-file-button\" data-filename=\"${file.name}\" aria-label=\"${file.name} \u3092\u524A\u9664\">\u00D7</button>\n        </div>`; // file-item end\n    });\n\n    // HTML\u3092\u9069\u7528\n    this.fileInfoArea.innerHTML = html;\n    this.clearButton.disabled = false;\n    // Execute button state is handled by validateSelectedFiles\n  }\n\n  /**\n   * \u30A8\u30E9\u30FC\u3092\u51E6\u7406\u3059\u308B\n   * @param error \u30A8\u30E9\u30FC\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n   * @param context \u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u305F\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\n   * @param options \u8FFD\u52A0\u30AA\u30D7\u30B7\u30E7\u30F3\n   */\n  private handleError(error: Error, context: string, options: ErrorHandlerOptions = {}): void {\n    console.error(`\u30A8\u30E9\u30FC (${context}):`, error);\n\n    // \u30A8\u30E9\u30FC\u30BF\u30A4\u30D7\u306B\u57FA\u3065\u3044\u3066\u9069\u5207\u306A\u30E1\u30C3\u30BB\u30FC\u30B8\u3068\u89E3\u6C7A\u7B56\u3092\u63D0\u4F9B\n    let title = '\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F';\n    const message = error.message || '\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F';\n    let solution = '';\n    const priority = 4; // \u30A8\u30E9\u30FC\u306F\u9AD8\u3044\u512A\u5148\u5EA6\n\n    switch (context) {\n      case 'file-format':\n        title = '\u30D5\u30A1\u30A4\u30EB\u5F62\u5F0F\u30A8\u30E9\u30FC';\n        solution = '\u30C6\u30AD\u30B9\u30C8\u30D5\u30A1\u30A4\u30EB(.txt)\u306E\u307F\u8FFD\u52A0\u3067\u304D\u307E\u3059\u3002\u30D5\u30A1\u30A4\u30EB\u5F62\u5F0F\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044';\n        break;\n\n      case 'file-validation':\n        title = '\u30D5\u30A1\u30A4\u30EB\u691C\u8A3C\u30A8\u30E9\u30FC';\n        solution = '\u6B63\u3057\u3044\u5F62\u5F0F\u306EEF\u7D71\u5408\u30D5\u30A1\u30A4\u30EB\u3067\u3042\u308B\u3053\u3068\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044';\n        break;\n\n      case 'file-duplicate':\n        title = '\u30D5\u30A1\u30A4\u30EB\u91CD\u8907';\n        solution = '\u5225\u306E\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3059\u308B\u304B\u3001\u65E2\u5B58\u306E\u30D5\u30A1\u30A4\u30EB\u3092\u30AF\u30EA\u30A2\u3057\u3066\u304F\u3060\u3055\u3044';\n        break;\n\n      default:\n        solution = '\u554F\u984C\u304C\u89E3\u6C7A\u3057\u306A\u3044\u5834\u5408\u306F\u3001\u30DA\u30FC\u30B8\u3092\u518D\u8AAD\u307F\u8FBC\u307F\u3057\u3066\u304F\u3060\u3055\u3044';\n    }\n\n    // \u89E3\u6C7A\u7B56\u304C\u3042\u308B\u5834\u5408\u306F\u30E1\u30C3\u30BB\u30FC\u30B8\u306B\u8FFD\u52A0\n    const fullMessage = solution\n      ? `${message}<br><span class=\"error-solution\">\u89E3\u6C7A\u7B56: ${solution}</span>`\n      : message;\n\n    // \u901A\u77E5\u3092\u8868\u793A\n    this.notification.showToast('error', title, fullMessage, 8000, priority); // \u6CE8\u5165\u3055\u308C\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F7F\u7528\n\n    // \u30A8\u30E9\u30FC\u56DE\u5FA9\u306E\u305F\u3081\u306E\u30A2\u30AF\u30B7\u30E7\u30F3\u3092\u63D0\u4F9B\n    if (\n      options.recoveryAction &&\n      options.recoveryAction.message &&\n      options.recoveryAction.label &&\n      options.recoveryAction.handler\n    ) {\n      const recoveryAction = {\n        message: options.recoveryAction.message,\n        label: options.recoveryAction.label,\n        handler: options.recoveryAction.handler,\n      };\n\n      setTimeout(() => {\n        this.notification.showRecoveryToast(recoveryAction); // \u6CE8\u5165\u3055\u308C\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F7F\u7528\n      }, 1000);\n    }\n\n    // \u30A8\u30E9\u30FC\u72B6\u614B\u3092UI\u306B\u53CD\u6620\n    if (options.updateUI) {\n      options.updateUI();\n    }\n  }\n\n  /**\n   * \u9078\u629E\u3055\u308C\u305F\u30D5\u30A1\u30A4\u30EB\u3092\u53D6\u5F97\n   * @returns \u9078\u629E\u3055\u308C\u305F\u30D5\u30A1\u30A4\u30EB\u914D\u5217\n   */\n  public getSelectedFiles(): File[] {\n    return this.selectedFiles;\n  }\n\n  /**\n   * \u6709\u52B9\u306A\u30D5\u30A1\u30A4\u30EB\u6570\u3092\u53D6\u5F97\n   * @returns \u6709\u52B9\u306A\u30D5\u30A1\u30A4\u30EB\u6570\n   */\n  public getValidFileCount(): number {\n    return this.validFiles;\n  }\n}\n\n// \u30B0\u30ED\u30FC\u30D0\u30EB\u3067\u30A2\u30AF\u30BB\u30B9\u53EF\u80FD\u306A\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F5C\u6210\nlet fileManagerInstance: FileManager | null = null;\n\n// \u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\u307E\u305F\u306F\u4F5C\u6210\u3059\u308B\u95A2\u6570\n/**\n * \u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\u307E\u305F\u306F\u4F5C\u6210\u3059\u308B\u95A2\u6570\n * @returns FileManager\u306E\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\n */\nexport function getFileManager(): FileManager {\n  if (!fileManagerInstance) {\n    // DOM\u304C\u6E96\u5099\u3067\u304D\u3066\u3044\u308B\u304B\u78BA\u8A8D\n    if (document.readyState === 'loading') {\n      throw new Error('DOM is not ready. Call this function after DOMContentLoaded');\n    }\n    // \u4F9D\u5B58\u6027\u3092\u6CE8\u5165\u3057\u3066\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u5316\n    fileManagerInstance = new FileManager(getNotificationSystem());\n  }\n  return fileManagerInstance;\n}\n\n// \u65E2\u5B58\u306Eexport\u6587\u3092\u524A\u9664\u3057\u3001\u65B0\u3057\u3044\u521D\u671F\u5316\u65B9\u6CD5\u3092\u4F7F\u7528\nexport const fileManager = {\n  get instance(): FileManager {\n    // \u623B\u308A\u5024\u306E\u578B\u3092\u8FFD\u52A0\n    return getFileManager();\n  },\n};\n", "import { OutputSettings } from '../../core/common/types.ts'; // \u3055\u3089\u306B\u6B63\u3057\u3044\u30D1\u30B9\u306B\u4FEE\u6B63\n\n/**\n * \u7D50\u679C\u8868\u793A\u30AF\u30E9\u30B9\n * \u30C6\u30AD\u30B9\u30C8/\u30C6\u30FC\u30D6\u30EB\u5F62\u5F0F\u3067\u306E\u7D50\u679C\u8868\u793A\u3092\u7BA1\u7406\u3059\u308B\u30B3\u30F3\u30DD\u30FC\u30CD\u30F3\u30C8\n */\nexport class ResultViewer {\n  private resultTextarea: HTMLTextAreaElement;\n  private resultTable: HTMLTableElement;\n  private textViewButton: HTMLButtonElement;\n  private tableViewButton: HTMLButtonElement;\n  private textResultView: HTMLElement;\n  private tableResultView: HTMLElement;\n  private copyButton: HTMLButtonElement;\n  private copyMessage: HTMLElement;\n  private downloadLink: HTMLAnchorElement;\n  private currentView: 'text' | 'table' = 'text';\n\n  /**\n   * \u7D50\u679C\u8868\u793A\u30AF\u30E9\u30B9\u306E\u30B3\u30F3\u30B9\u30C8\u30E9\u30AF\u30BF\n   */\n  constructor() {\n    // DOM\u8981\u7D20\u306E\u53D6\u5F97\n    this.resultTextarea = document.getElementById('resultTextarea') as HTMLTextAreaElement;\n    this.resultTable = document.getElementById('resultTable') as HTMLTableElement;\n    this.textViewButton = document.getElementById('textViewButton') as HTMLButtonElement;\n    this.tableViewButton = document.getElementById('tableViewButton') as HTMLButtonElement;\n    this.textResultView = document.getElementById('textResultView') as HTMLElement;\n    this.tableResultView = document.getElementById('tableResultView') as HTMLElement;\n    this.copyButton = document.getElementById('copyButton') as HTMLButtonElement;\n    this.copyMessage = document.getElementById('copyMessage') as HTMLElement;\n    this.downloadLink = document.getElementById('downloadLink') as HTMLAnchorElement;\n\n    if (\n      !this.resultTextarea ||\n      !this.resultTable ||\n      !this.textViewButton ||\n      !this.tableViewButton ||\n      !this.textResultView ||\n      !this.tableResultView ||\n      !this.copyButton ||\n      !this.copyMessage ||\n      !this.downloadLink\n    ) {\n      throw new Error('\u5FC5\u8981\u306ADOM\u8981\u7D20\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093');\n    }\n\n    this.setupEventListeners();\n  }\n\n  /**\n   * \u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\n   */\n  private setupEventListeners(): void {\n    // \u8868\u793A\u5207\u66FF\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\n    this.textViewButton.addEventListener('click', () => {\n      this.setResultView('text');\n    });\n\n    this.tableViewButton.addEventListener('click', () => {\n      this.setResultView('table');\n    });\n\n    // \u30B3\u30D4\u30FC\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\n    this.copyButton.addEventListener('click', () => {\n      this.copyResultToClipboard();\n    });\n  }\n\n  /**\n   * \u7D50\u679C\u8868\u793A\u30E2\u30FC\u30C9\u3092\u8A2D\u5B9A\u3059\u308B\n   * @param viewMode \u8868\u793A\u30E2\u30FC\u30C9 ('text' \u307E\u305F\u306F 'table')\n   */\n  public setResultView(viewMode: 'text' | 'table'): void {\n    this.currentView = viewMode;\n\n    if (viewMode === 'text') {\n      this.textResultView.style.display = 'block';\n      this.tableResultView.style.display = 'none';\n      this.textViewButton.classList.add('active');\n      this.tableViewButton.classList.remove('active');\n      this.textViewButton.setAttribute('aria-pressed', 'true');\n      this.tableViewButton.setAttribute('aria-pressed', 'false');\n    } else {\n      this.textResultView.style.display = 'none';\n      this.tableResultView.style.display = 'block';\n      this.textViewButton.classList.remove('active');\n      this.tableViewButton.classList.add('active');\n      this.textViewButton.setAttribute('aria-pressed', 'false');\n      this.tableViewButton.setAttribute('aria-pressed', 'true');\n    }\n  }\n\n  /**\n   * \u7D50\u679C\u3092\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u306B\u30B3\u30D4\u30FC\u3059\u308B (navigator.clipboard API\u3092\u4F7F\u7528)\n   */\n  private async copyResultToClipboard(): Promise<void> {\n    const textToCopy = this.resultTextarea.value;\n    if (!textToCopy) return;\n\n    try {\n      // navigator.clipboard API\u3092\u4F7F\u7528\u3057\u3066\u30C6\u30AD\u30B9\u30C8\u3092\u30B3\u30D4\u30FC\n      await navigator.clipboard.writeText(textToCopy);\n\n      // \u65E2\u5B58\u306E\u30AF\u30E9\u30B9\u3092\u30AF\u30EA\u30A2\n      this.copyMessage.classList.remove('visible', 'error');\n      // \u30B3\u30D4\u30FC\u6210\u529F\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u8868\u793A\n      this.copyMessage.textContent = '\u30B3\u30D4\u30FC\u3057\u307E\u3057\u305F\uFF01';\n      this.copyMessage.classList.add('visible');\n\n      // \u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u4E00\u5B9A\u6642\u9593\u5F8C\u306B\u6D88\u3059\n      setTimeout(() => {\n        this.copyMessage.classList.remove('visible');\n      }, 2000);\n    } catch (err) {\n      console.error('\u30AF\u30EA\u30C3\u30D7\u30DC\u30FC\u30C9\u3078\u306E\u30B3\u30D4\u30FC\u306B\u5931\u6557\u3057\u307E\u3057\u305F:', err);\n      // \u65E2\u5B58\u306E\u30AF\u30E9\u30B9\u3092\u30AF\u30EA\u30A2\n      this.copyMessage.classList.remove('visible', 'error');\n      // \u30A8\u30E9\u30FC\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u8868\u793A (\u3088\u308A\u5177\u4F53\u7684\u306B)\n      this.copyMessage.textContent = '\u30B3\u30D4\u30FC\u306B\u5931\u6557\u3057\u307E\u3057\u305F';\n      this.copyMessage.classList.add('visible');\n      this.copyMessage.classList.add('error'); // \u30A8\u30E9\u30FC\u7528\u30B9\u30BF\u30A4\u30EB\u3092\u8FFD\u52A0 (CSS\u3067\u5B9A\u7FA9\u304C\u5FC5\u8981)\n\n      // \u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u4E00\u5B9A\u6642\u9593\u5F8C\u306B\u6D88\u3059\n      setTimeout(() => {\n        this.copyMessage.classList.remove('visible');\n        this.copyMessage.classList.remove('error');\n      }, 3000);\n    }\n  }\n\n  /**\n   * \u7D50\u679C\u3092\u8868\u793A\u3059\u308B\n   * @param resultText \u7D50\u679C\u306E\u30C6\u30AD\u30B9\u30C8\u30C7\u30FC\u30BF\n   */\n  public displayResult(resultText: string, debugInfo?: string): void {\n    // \u7A7A\u6587\u5B57\u5217\u306E\u5834\u5408\u3082\u51E6\u7406\u3092\u7D9A\u884C\u3057\u3001\u8868\u793A\u3092\u30AF\u30EA\u30A2\u3059\u308B\n\n    // \u30C7\u30D0\u30C3\u30B0\u60C5\u5831\u304C\u3042\u308B\u5834\u5408\u306F\u3001\u7D50\u679C\u306E\u524D\u306B\u8FFD\u52A0\n    const displayText = debugInfo\n      ? `=== \u30C7\u30D0\u30C3\u30B0\u60C5\u5831 ===\\n${debugInfo}\\n\\n=== \u51E6\u7406\u7D50\u679C ===\\n${resultText}`\n      : resultText;\n\n    // \u30C6\u30AD\u30B9\u30C8\u30A8\u30EA\u30A2\u306B\u8868\u793A\n    this.resultTextarea.value = displayText;\n\n    // \u30C6\u30FC\u30D6\u30EB\u306B\u8868\u793A\uFF08\u30C7\u30D0\u30C3\u30B0\u60C5\u5831\u306F\u9664\u5916\uFF09\n    this.updateResultTable(resultText);\n\n    // \u7D50\u679C\u8868\u793A\u30A8\u30EA\u30A2\u3092\u8868\u793A\n    const resultContainer = document.getElementById('resultContainer');\n    if (resultContainer) {\n      resultContainer.classList.remove('hidden');\n    }\n\n    // \u4FDD\u5B58\u7528\u30EA\u30F3\u30AF\u3092\u66F4\u65B0\n    this.updateDownloadLink(resultText);\n\n    // \u7D50\u679C\u304C\u3042\u308C\u3070\u30B3\u30D4\u30FC/\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u30DC\u30BF\u30F3\u3092\u6709\u52B9\u5316\u3001\u306A\u3051\u308C\u3070\u7121\u52B9\u5316\n    const hasResult = !!resultText;\n    this.copyButton.disabled = !hasResult;\n    this.downloadLink.classList.toggle('hidden', !hasResult);\n\n    // \u7D50\u679C\u304C\u7A7A\u306A\u3089\u30C6\u30FC\u30D6\u30EB\u3082\u30AF\u30EA\u30A2\n    if (!hasResult) {\n      this.clearResultTable();\n    }\n  }\n\n  /**\n   * \u7D50\u679C\u30C6\u30FC\u30D6\u30EB\u3092\u30AF\u30EA\u30A2\u3059\u308B\n   */\n  private clearResultTable(): void {\n    const tbody = this.resultTable.querySelector('tbody');\n    if (tbody) {\n      tbody.innerHTML = '';\n    }\n  }\n\n  /**\n   * \u7D50\u679C\u30C6\u30FC\u30D6\u30EB\u3092\u66F4\u65B0\u3059\u308B\n   * @param resultText \u30BF\u30D6\u533A\u5207\u308A\u306E\u30C6\u30AD\u30B9\u30C8\u7D50\u679C\n   */\n  private updateResultTable(resultText: string): void {\n    if (!resultText) return;\n\n    const tbody = this.resultTable.querySelector('tbody');\n    if (!tbody) return;\n\n    this.clearResultTable();\n\n    // \u30C6\u30AD\u30B9\u30C8\u3092\u884C\u306B\u5206\u5272\n    const lines = resultText.trim().split('\\n');\n\n    // \u30D8\u30C3\u30C0\u30FC\u884C\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u30662\u884C\u76EE\u304B\u3089\u51E6\u7406\n    for (let i = 1; i < lines.length; i++) {\n      const columns = lines[i].split('\\t');\n\n      // \u884C\u304C\u6B63\u3057\u3044\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u304B\u30C1\u30A7\u30C3\u30AF\n      if (columns.length >= 5) {\n        const row = document.createElement('tr');\n\n        // \u5404\u5217\u306E\u30C7\u30FC\u30BF\u3092\u30BB\u30EB\u306B\u8FFD\u52A0\n        for (let j = 0; j < 5; j++) {\n          const cell = document.createElement('td');\n          cell.textContent = columns[j];\n\n          // \u77ED\u624B\uFF13\u5BFE\u8C61\u75C7\u4F8B\u306E\u5217\u306B\u7279\u5225\u306A\u30B9\u30BF\u30A4\u30EB\u3092\u9069\u7528\n          if (j === 3) {\n            if (columns[j] === 'Yes') {\n              cell.classList.add('eligible-yes');\n            } else {\n              cell.classList.add('eligible-no');\n            }\n          }\n\n          row.appendChild(cell);\n        }\n\n        tbody.appendChild(row);\n      }\n    }\n  }\n\n  /**\n   * \u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u30EA\u30F3\u30AF\u3092\u66F4\u65B0\u3059\u308B\n   * @param resultText \u7D50\u679C\u30C6\u30AD\u30B9\u30C8\n   */\n  private updateDownloadLink(resultText: string): void {\n    const blob = new Blob([resultText], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n\n    // \u65E2\u5B58\u306EURL\u3092\u89E3\u653E\n    if (this.downloadLink.href) {\n      URL.revokeObjectURL(this.downloadLink.href);\n    }\n\n    // \u65B0\u3057\u3044URL\u3092\u8A2D\u5B9A\n    this.downloadLink.href = url;\n\n    // \u30D5\u30A1\u30A4\u30EB\u540D\u306E\u8A2D\u5B9A\n    const date = new Date();\n    const dateStr = `${date.getFullYear()}${(date.getMonth() + 1).toString().padStart(2, '0')}${\n      date.getDate().toString().padStart(2, '0')\n    }`;\n    this.downloadLink.setAttribute('download', `\u77ED\u624B3\u5224\u5B9A\u7D50\u679C_${dateStr}.txt`);\n\n    // \u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u30EA\u30F3\u30AF\u3092\u8868\u793A\n    this.downloadLink.classList.remove('hidden');\n  }\n\n  /**\n   * \u73FE\u5728\u306E\u8868\u793A\u30E2\u30FC\u30C9\u3092\u53D6\u5F97\n   * @returns \u73FE\u5728\u306E\u8868\u793A\u30E2\u30FC\u30C9\n   */\n  public getCurrentView(): 'text' | 'table' {\n    return this.currentView;\n  }\n\n  /**\n   * \u8868\u793A\u7528\u8A2D\u5B9A\u3092\u53D6\u5F97\n   * @returns \u51FA\u529B\u8A2D\u5B9A\n   */\n  public getOutputSettings(): OutputSettings {\n    // \u623B\u308A\u5024\u306E\u578B\u3092\u660E\u793A (\u30A4\u30F3\u30DD\u30FC\u30C8\u5143\u304C\u4FEE\u6B63\u3055\u308C\u305F\u305F\u3081)\n    const eligibleOnlyRadio = document.getElementById('eligibleOnly') as HTMLInputElement;\n    const dateFormatRadios = document.querySelectorAll(\n      'input[name=\"dateFormat\"]',\n    ) as NodeListOf<HTMLInputElement>;\n\n    // \u30C7\u30D5\u30A9\u30EB\u30C8\u5024\u3092\u5C0F\u6587\u5B57\u306B\u4FEE\u6B63\u3057\u3001\u578B\u3092\u660E\u793A\n    let dateFormat: 'yyyymmdd' | 'yyyy/mm/dd' = 'yyyymmdd';\n    for (const radio of Array.from(dateFormatRadios)) {\n      if (radio.checked) {\n        // radio.value \u304C\u6B63\u3057\u3044\u578B\u3067\u3042\u308B\u3053\u3068\u3092\u78BA\u8A8D (\u5FC5\u8981\u3067\u3042\u308C\u3070\u30A2\u30B5\u30FC\u30B7\u30E7\u30F3)\n        dateFormat = radio.value as 'yyyymmdd' | 'yyyy/mm/dd';\n        break;\n      }\n    }\n\n    return {\n      outputMode: eligibleOnlyRadio?.checked ? 'eligibleOnly' : 'allCases',\n      dateFormat,\n    };\n  }\n}\n\n// \u30B0\u30ED\u30FC\u30D0\u30EB\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u4F5C\u6210\u3092\u524A\u9664\u3002\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u306F main.ts \u306A\u3069\u3067\u5FC5\u8981\u306B\u5FDC\u3058\u3066\u4F5C\u6210\u3059\u308B\u3002\n", "/**\n * \u30C7\u30D5\u30A9\u30EB\u30C8\u306E\u7D50\u679C\u30D8\u30C3\u30C0\u30FC\u884C\n */\nexport const DEFAULT_RESULT_HEADER = '\u30C7\u30FC\u30BF\u8B58\u5225\u756A\u53F7\\t\u5165\u9662\u5E74\u6708\u65E5\\t\u9000\u9662\u5E74\u6708\u65E5\\t\u77ED\u624B\uFF13\u5BFE\u8C61\u75C7\u4F8B\\t\u7406\u7531';\n\n/**\n * \u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u30FB\u7C98\u819C\u5207\u9664\u8853\u306E\u8A3A\u7642\u884C\u70BA\u30B3\u30FC\u30C9\n */\nexport const COLONOSCOPY_PROCEDURE_CODE_SMALL = '150285010'; // \u9577\u5F84\uFF12\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u672A\u6E80\nexport const COLONOSCOPY_PROCEDURE_CODE_LARGE = '150183410'; // \u9577\u5F84\uFF12\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u4EE5\u4E0A\nexport const COLONOSCOPY_PROCEDURE_CODES: string[] = [\n  COLONOSCOPY_PROCEDURE_CODE_SMALL,\n  COLONOSCOPY_PROCEDURE_CODE_LARGE,\n]; // \u5C0F\u30FB\u5927\u306E\u4E21\u65B9\u306E\u30B3\u30FC\u30C9\u3092\u307E\u3068\u3081\u305F\u914D\u5217\n\n/**\n * \u5BFE\u8C61\u624B\u8853\u7B49\u306E\u30B3\u30FC\u30C9\u3068\u540D\u79F0\u306E\u30DE\u30C3\u30D4\u30F3\u30B0\n * \u77ED\u671F\u6EDE\u5728\u624B\u8853\u7B49\u57FA\u672C\u6599\uFF13\u306E\u5BFE\u8C61\u3068\u306A\u308B\u8A3A\u7642\u884C\u70BA\u30B3\u30FC\u30C9\u3068\u305D\u306E\u540D\u79F0\u306E\u30DE\u30C3\u30D4\u30F3\u30B0\n */\nexport const PROCEDURE_NAME_MAP: Record<string, string> = {\n  '160218510': '\u7D42\u591C\u7761\u7720\u30DD\u30EA\u30B0\u30E9\u30D5\u30A3\u30FC\uFF08\uFF11\u53CA\u3073\uFF12\u4EE5\u5916\u306E\u5834\u5408\uFF09\uFF08\u5B89\u5168\u7CBE\u5EA6\u7BA1\u7406\u4E0B\u3067\u884C\u3046\u3082\u306E\uFF09',\n  '160218610': '\u7D42\u591C\u7761\u7720\u30DD\u30EA\u30B0\u30E9\u30D5\u30A3\u30FC\uFF08\uFF11\u53CA\u3073\uFF12\u4EE5\u5916\u306E\u5834\u5408\uFF09\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09',\n  '160183110': '\u53CD\u5FA9\u7761\u7720\u6F5C\u6642\u8A66\u9A13\uFF08\uFF2D\uFF33\uFF2C\uFF34\uFF09',\n  '160119710': '\u4E0B\u5782\u4F53\u524D\u8449\u8CA0\u8377\u8A66\u9A13\u6210\u9577\u30DB\u30EB\u30E2\u30F3\uFF08\uFF27\uFF28\uFF09\uFF08\u4E00\u9023\u3068\u3057\u3066\uFF09',\n  '160180410': '\u5C0F\u5150\u98DF\u7269\u30A2\u30EC\u30EB\u30AE\u30FC\u8CA0\u8377\u691C\u67FB',\n  '160098110': '\u524D\u7ACB\u817A\u91DD\u751F\u691C\u6CD5\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09',\n  '150351910': '\u7D4C\u76AE\u7684\u653E\u5C04\u7DDA\u6CBB\u7642\u7528\u91D1\u5C5E\u30DE\u30FC\u30AB\u30FC\u7559\u7F6E\u8853',\n  '150011310': '\u56DB\u80A2\u30FB\u8EAF\u5E79\u8EDF\u90E8\u816B\u760D\u6458\u51FA\u8853\uFF08\u624B\uFF09',\n  '150294810': '\u9AA8\u6298\u89B3\u8840\u7684\u624B\u8853\uFF08\u624B\u821F\u72B6\u9AA8\uFF09',\n  '150020810': '\u9AA8\u5185\u7570\u7269\uFF08\u633F\u5165\u7269\u3092\u542B\u3080\u3002\uFF09\u9664\u53BB\u8853\uFF08\u524D\u8155\uFF09',\n  '150021010': '\u9AA8\u5185\u7570\u7269\uFF08\u633F\u5165\u7269\u3092\u542B\u3080\u3002\uFF09\u9664\u53BB\u8853\uFF08\u9396\u9AA8\uFF09',\n  '150021210': '\u9AA8\u5185\u7570\u7269\uFF08\u633F\u5165\u7269\u3092\u542B\u3080\u3002\uFF09\u9664\u53BB\u8853\uFF08\u624B\uFF09',\n  '150041010': '\u30AC\u30F3\u30B0\u30EA\u30AA\u30F3\u6458\u51FA\u8853\uFF08\u624B\uFF09',\n  '150314110': '\u95A2\u7BC0\u93E1\u4E0B\u624B\u6839\u7BA1\u958B\u653E\u624B\u8853',\n  '150273810': '\u80F8\u8154\u93E1\u4E0B\u4EA4\u611F\u795E\u7D4C\u7BC0\u5207\u9664\u8853\uFF08\u4E21\u5074\uFF09',\n  '150355810': '\u6D99\u7BA1\u30C1\u30E5\u30FC\u30D6\u633F\u5165\u8853\uFF08\u6D99\u9053\u5185\u8996\u93E1\u3092\u7528\u3044\u308B\u3082\u306E\uFF09',\n  '150355910': '\u773C\u77BC\u5185\u53CD\u75C7\u624B\u8853\uFF08\u76AE\u819A\u5207\u958B\u6CD5\uFF09',\n  '150078810': '\u773C\u77BC\u4E0B\u5782\u75C7\u624B\u8853\uFF08\u773C\u77BC\u6319\u7B4B\u524D\u8EE2\u6CD5\uFF09',\n  '150079010': '\u773C\u77BC\u4E0B\u5782\u75C7\u624B\u8853\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09',\n  '150080210': '\u7FFC\u72B6\u7247\u624B\u8853\uFF08\u5F01\u306E\u79FB\u690D\u3092\u8981\u3059\u308B\u3082\u306E\uFF09',\n  '150083410': '\u659C\u8996\u624B\u8853\uFF08\u5F8C\u8EE2\u6CD5\uFF09',\n  '150083510': '\u659C\u8996\u624B\u8853\uFF08\u524D\u8EE2\u6CD5\u53CA\u3073\u5F8C\u8EE2\u6CD5\u306E\u4F75\u65BD\uFF09',\n  '150344510':\n    '\u6CBB\u7642\u7684\u89D2\u819C\u5207\u9664\u8853\uFF08\u30A8\u30AD\u30B7\u30DE\u30EC\u30FC\u30B6\u30FC\u306B\u3088\u308B\u3082\u306E\uFF08\u89D2\u819C\u30B8\u30B9\u30C8\u30ED\u30D5\u30A3\u30FC\u53C8\u306F\u5E2F\u72B6\u89D2\u819C\u5909\u6027\u306B\u4FC2\u308B\u3082\u306E\u306B\u9650\u308B\u3002\uFF09\uFF09',\n  '150395150': '\u7DD1\u5185\u969C\u624B\u8853\uFF08\u6C34\u6676\u4F53\u518D\u5EFA\u8853\u4F75\u7528\u773C\u5185\u30C9\u30EC\u30FC\u30F3\u633F\u5165\u8853\uFF09',\n  '150253010': '\u6C34\u6676\u4F53\u518D\u5EFA\u8853\uFF08\u773C\u5185\u30EC\u30F3\u30BA\u3092\u633F\u5165\u3059\u308B\u5834\u5408\uFF09\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09',\n  '150315610': '\u6C34\u6676\u4F53\u518D\u5EFA\u8853\uFF08\u773C\u5185\u30EC\u30F3\u30BA\u3092\u633F\u5165\u3057\u306A\u3044\u5834\u5408\uFF09',\n  '150096010': '\u9F13\u819C\u5F62\u6210\u624B\u8853',\n  '150097710': '\u9F3B\u9AA8\u9AA8\u6298\u6574\u5FA9\u56FA\u5B9A\u8853',\n  '150315910': '\u58F0\u5E2F\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u30D5\u30A1\u30A4\u30D0\u30FC\u30B9\u30B3\u30FC\u30D7\u306B\u3088\u308B\u3082\u306E\uFF09',\n  '150316010': '\u58F0\u5E2F\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u76F4\u9054\u5589\u982D\u93E1\u306B\u3088\u308B\u3082\u306E\uFF09',\n  '150106850': '\u5589\u982D\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u76F4\u9054\u5589\u982D\u93E1\u306B\u3088\u308B\u3082\u306E\uFF09',\n  '150299450': '\u5589\u982D\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u30D5\u30A1\u30A4\u30D0\u30FC\u30B9\u30B3\u30FC\u30D7\u306B\u3088\u308B\u3082\u306E\uFF09',\n  '150121110': '\u4E73\u817A\u816B\u760D\u6458\u51FA\u8853\uFF08\u9577\u5F84\uFF15\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u672A\u6E80\uFF09',\n  '150121210': '\u4E73\u817A\u816B\u760D\u6458\u51FA\u8853\uFF08\u9577\u5F84\uFF15\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u4EE5\u4E0A\uFF09',\n  '150416610': '\u7D4C\u76AE\u7684\u30B7\u30E3\u30F3\u30C8\u62E1\u5F35\u8853\u30FB\u8840\u6813\u9664\u53BB\u8853\uFF08\u521D\u56DE\uFF09',\n  '150416710': '\u7D4C\u76AE\u7684\u30B7\u30E3\u30F3\u30C8\u62E1\u5F35\u8853\u30FB\u8840\u6813\u9664\u53BB\u8853\uFF08\uFF11\u306E\u5B9F\u65BD\u5F8C\uFF13\u6708\u4EE5\u5185\u306B\u5B9F\u65BD\u3059\u308B\u5834\u5408\uFF09',\n  '150154010': '\u4E0B\u80A2\u9759\u8108\u7624\u624B\u8853\uFF08\u629C\u53BB\u5207\u9664\u8853\uFF09',\n  '150263410': '\u4E0B\u80A2\u9759\u8108\u7624\u624B\u8853\uFF08\u786C\u5316\u7642\u6CD5\uFF08\u4E00\u9023\u3068\u3057\u3066\uFF09\uFF09',\n  '150296510': '\u4E0B\u80A2\u9759\u8108\u7624\u624B\u8853\uFF08\u9AD8\u4F4D\u7D50\u7D2E\u8853\uFF09',\n  '150154150': '\u5927\u4F0F\u5728\u9759\u8108\u629C\u53BB\u8853',\n  '150360910': '\u4E0B\u80A2\u9759\u8108\u7624\u8840\u7BA1\u5185\u713C\u707C\u8853',\n  '150411150': '\u4E0B\u80A2\u9759\u8108\u7624\u8840\u7BA1\u5185\u585E\u6813\u8853',\n  '150159010': '\u30D8\u30EB\u30CB\u30A2\u624B\u8853\uFF08\u9F20\u5F84\u30D8\u30EB\u30CB\u30A2\uFF09',\n  '150263610': '\u8179\u8154\u93E1\u4E0B\u9F20\u5F84\u30D8\u30EB\u30CB\u30A2\u624B\u8853\uFF08\u4E21\u5074\uFF09',\n  '150285010': '\u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u30FB\u7C98\u819C\u5207\u9664\u8853\uFF08\u9577\u5F84\uFF12\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u672A\u6E80\uFF09',\n  '150183410': '\u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u30FB\u7C98\u819C\u5207\u9664\u8853\uFF08\u9577\u5F84\uFF12\u30BB\u30F3\u30C1\u30E1\u30FC\u30C8\u30EB\u4EE5\u4E0A\uFF09',\n  '150325410': '\u75D4\u6838\u624B\u8853\uFF08\u8131\u809B\u3092\u542B\u3080\u3002\uFF09\uFF08\u786C\u5316\u7642\u6CD5\uFF08\u56DB\u6BB5\u968E\u6CE8\u5C04\u6CD5\u306B\u3088\u308B\u3082\u306E\uFF09\uFF09',\n  '150190310': '\u809B\u9580\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853',\n  '150190410': '\u809B\u9580\u5C16\u572D\u30B3\u30F3\u30B8\u30ED\u30FC\u30E0\u5207\u9664\u8853',\n  '150194510': '\u4F53\u5916\u885D\u6483\u6CE2\u814E\u30FB\u5C3F\u7BA1\u7D50\u77F3\u7834\u7815\u8853\uFF08\u4E00\u9023\u306B\u3064\u304D\uFF09',\n  '150421110': '\u5C3F\u5931\u7981\u624B\u8853\uFF08\u30DC\u30C4\u30EA\u30CC\u30B9\u6BD2\u7D20\u306B\u3088\u308B\u3082\u306E\uFF09',\n  '150404310': '\u9855\u5FAE\u93E1\u4E0B\u7CBE\u7D22\u9759\u8108\u7624\u624B\u8853',\n  '150216510': '\u5B50\u5BAE\u9838\u90E8\uFF08\u815F\u90E8\uFF09\u5207\u9664\u8853',\n  '150421310': '\u5B50\u5BAE\u93E1\u4E0B\u6709\u830E\u7C98\u819C\u4E0B\u7B4B\u816B\u5207\u51FA\u8853\uFF08\u96FB\u89E3\u8CEA\u6EB6\u6DB2\u5229\u7528\u306E\u3082\u306E\uFF09',\n  '150421410': '\u5B50\u5BAE\u5185\u819C\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u96FB\u89E3\u8CEA\u6EB6\u6DB2\u5229\u7528\u306E\u3082\u306E\uFF09',\n  '150421510': '\u5B50\u5BAE\u93E1\u4E0B\u6709\u830E\u7C98\u819C\u4E0B\u7B4B\u816B\u5207\u51FA\u8853\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09',\n  '150421610': '\u5B50\u5BAE\u5185\u819C\u30DD\u30EA\u30FC\u30D7\u5207\u9664\u8853\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09',\n  '150421710': '\u5B50\u5BAE\u93E1\u4E0B\u5B50\u5BAE\u7B4B\u816B\u6458\u51FA\u8853\uFF08\u96FB\u89E3\u8CEA\u6EB6\u6DB2\u5229\u7528\u306E\u3082\u306E\uFF09',\n  '150421810': '\u5B50\u5BAE\u93E1\u4E0B\u5B50\u5BAE\u7B4B\u816B\u6458\u51FA\u8853\uFF08\u305D\u306E\u4ED6\u306E\u3082\u306E\uFF09',\n  '150366110': '\u8179\u8154\u93E1\u4E0B\u5375\u7BA1\u5F62\u6210\u8853',\n  '180018910': '\u30AC\u30F3\u30DE\u30CA\u30A4\u30D5\u306B\u3088\u308B\u5B9A\u4F4D\u653E\u5C04\u7DDA\u6CBB\u7642',\n};\n\n/**\n * \u5BFE\u8C61\u624B\u8853\u7B49\u306E\u30B3\u30FC\u30C9\u4E00\u89A7\n * \u77ED\u671F\u6EDE\u5728\u624B\u8853\u7B49\u57FA\u672C\u6599\uFF13\u306E\u5BFE\u8C61\u3068\u306A\u308B\u8A3A\u7642\u884C\u70BA\u30B3\u30FC\u30C9\u306E\u30EA\u30B9\u30C8\n * PROCEDURE_NAME_MAP \u306E\u30AD\u30FC\u304B\u3089\u52D5\u7684\u306B\u751F\u6210\u3055\u308C\u307E\u3059\u3002\n */\nexport const TARGET_PROCEDURES: string[] = Object.keys(PROCEDURE_NAME_MAP);\n\n/**\n * \u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u30FB\u7C98\u819C\u5207\u9664\u8853\u306E\u7279\u5B9A\u52A0\u7B97\u30B3\u30FC\u30C9\n */\nexport const COLONOSCOPY_SPECIAL_ADDITIONS: string[] = ['150429570', '150437170'];\n\n/**\n * \u5165\u9662\u671F\u9593\u306E\u6700\u5927\u65E5\u6570\uFF08\u77ED\u671F\u6EDE\u5728\u624B\u8853\u7B49\u57FA\u672C\u6599\uFF13\u306E\u6761\u4EF6\uFF09\n */\nexport const MAX_HOSPITAL_DAYS = 5;\n\n/**\n * \u975E\u8A72\u5F53\u7406\u7531\u306E\u30E1\u30C3\u30BB\u30FC\u30B8\u5B9A\u6570\n */\nexport const INELIGIBILITY_REASONS = {\n  UNDISCHARGED: '\u9000\u9662\u65E5\u672A\u78BA\u5B9A',\n  NO_TARGET_PROCEDURE: '\u5BFE\u8C61\u624B\u8853\u7B49\u306A\u3057',\n  HOSPITAL_DAYS_EXCEEDED: '\u5165\u9662\u671F\u9593\u304C\uFF16\u65E5\u4EE5\u4E0A',\n  MULTIPLE_TARGET_PROCEDURES: '\u5BFE\u8C61\u624B\u8853\u7B49\u3092\uFF12\u4EE5\u4E0A\u5B9F\u65BD',\n  OTHER_SURGERY: '\u5BFE\u8C61\u624B\u8853\u7B49\u4EE5\u5916\u306E\u624B\u8853\u3042\u308A',\n  SPECIAL_ADDITION: '\u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u8853\u306B\u7279\u5B9A\u52A0\u7B97\u3042\u308A',\n};\n", "/**\n * \u77ED\u671F\u6EDE\u5728\u624B\u8853\u7B49\u57FA\u672C\u6599\uFF13\u5224\u5B9A\u30D7\u30ED\u30B0\u30E9\u30E0 - \u30D1\u30FC\u30B5\u30FC\u95A2\u6570\n * \u3053\u306E\u30D5\u30A1\u30A4\u30EB\u306B\u306F\u3001\u30D5\u30A1\u30A4\u30EB\u89E3\u6790\u306B\u95A2\u9023\u3059\u308B\u95A2\u6570\u3092\u542B\u307F\u307E\u3059\u3002\n */\n\nimport { CaseData, RawCaseData } from './types.ts';\nimport { TARGET_PROCEDURES } from './constants.ts';\n\n/**\n * EF\u30D5\u30A1\u30A4\u30EB\u306E\u884C\u304B\u3089\u30C7\u30FC\u30BF\u3092\u62BD\u51FA\u3059\u308B\u5171\u901A\u95A2\u6570\n * @param columns - \u30C7\u30FC\u30BF\u5217\u306E\u914D\u5217\n * @returns \u60A3\u8005\u30C7\u30FC\u30BF\uFF08\u5BFE\u8C61\u624B\u8853\u306E\u5834\u5408\u306F\u5B8C\u5168\u3001\u305D\u308C\u4EE5\u5916\u306F\u57FA\u672C\u60C5\u5831\u306E\u307F\uFF09\u307E\u305F\u306Fnull\uFF08\u30C7\u30FC\u30BF\u304C\u4E0D\u5341\u5206\u306A\u5834\u5408\uFF09\n */\nfunction extractCaseData(\n  columns: string[],\n):\n  | (RawCaseData & { procedure: string; procedureName: string | null })\n  | { dataId: string; admission: string; discharge: string; procedure: null; procedureName: null }\n  | null {\n  // \u5C11\u306A\u304F\u3068\u3082\u57FA\u672C\u60C5\u5831\uFF08ID, \u5165\u9662\u65E5, \u9000\u9662\u65E5\uFF09\u3092\u542B\u3080\u5217\u304C\u5FC5\u8981\n  if (columns.length < 4) {\n    return null;\n  }\n\n  const dataId = columns[1].trim();\n  if (!dataId) {\n    return null;\n  }\n  const admission = columns[3].trim();\n  const discharge = columns[2].trim();\n\n  // \u884C\u70BA\u660E\u7D30\u756A\u53F7\u3092\u53D6\u5F97 (\u5217\u304C\u5B58\u5728\u3059\u308B\u5834\u5408\u306E\u307F)\n  const actionDetailNo = columns.length > 6 ? columns[6].trim() : null;\n\n  // \u884C\u70BA\u660E\u7D30\u756A\u53F7\u304C\"000\"\u306E\u884C\uFF08E\u30D5\u30A1\u30A4\u30EB\uFF09\u306F\u65E5\u4ED8\u66F4\u65B0\u306B\u3082\u4E0D\u8981\u306A\u305F\u3081\u30B9\u30AD\u30C3\u30D7\n  if (actionDetailNo === '000') {\n    return null;\n  }\n\n  // \u57FA\u672C\u60C5\u5831\n  const basicInfo = { dataId, admission, discharge };\n\n  // \u30EC\u30BB\u30D7\u30C8\u96FB\u7B97\u30B3\u30FC\u30C9\u3068\u8A3A\u7642\u660E\u7D30\u540D\u79F0\u3092\u53D6\u5F97 (\u5217\u304C\u5B58\u5728\u3059\u308B\u5834\u5408\u306E\u307F)\n  const procedure = columns.length > 8 ? columns[8].trim() : null;\n  const procedureName = columns.length > 10 ? columns[10].trim() : null;\n\n  // \u77ED\u624B3\u306E\u5BFE\u8C61\u624B\u8853\u304B\u3069\u3046\u304B\u3092\u5224\u5B9A\n  if (!procedure || !TARGET_PROCEDURES.includes(procedure)) {\n    // \u5BFE\u8C61\u624B\u8853\u3067\u306A\u304F\u3066\u3082\u57FA\u672C\u60C5\u5831\u306F\u8FD4\u3059\uFF08\u65E5\u4ED8\u66F4\u65B0\u306E\u305F\u3081\uFF09\n    return { ...basicInfo, procedure: null, procedureName: null };\n  }\n\n  // \u5BFE\u8C61\u624B\u8853\u306E\u5834\u5408\u3001\u5B8C\u5168\u306A\u60C5\u5831\u3092\u8FD4\u3059\n  // RawCaseData\u578B\u306B\u30AD\u30E3\u30B9\u30C8\u3057\u3066\u8FD4\u3059 (procedure\u306Fstring\u3067\u3042\u308B\u3053\u3068\u304C\u4FDD\u8A3C\u3055\u308C\u3066\u3044\u308B)\n  // procedureName\u304Cnull\u306E\u5834\u5408\u3082\u30C7\u30D5\u30A9\u30EB\u30C8\u5024\u3092\u8A2D\u5B9A\u3057\u3001string\u578B\u3092\u4FDD\u8A3C\n  return {\n    ...basicInfo,\n    procedure: procedure, // procedure is guaranteed to be string here\n    procedureName: procedureName ?? '(\u540D\u79F0\u306A\u3057)', // Ensure string type for RawCaseData compatibility\n  };\n}\n\n/**\n * \u5165\u9662EF\u7D71\u5408\u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\u3092\u30D1\u30FC\u30B9\u3059\u308B\u95A2\u6570\n * \u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\u3092\u89E3\u6790\u3057\u3001\u60A3\u8005\u3054\u3068\u306E\u30C7\u30FC\u30BF\u3092\u62BD\u51FA\u3057\u307E\u3059\n * @param content - \u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\n * @returns \u7D71\u5408\u524D\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\u914D\u5217\n */\nexport function parseEFFile(content: string): CaseData[] {\n  const lines = content.split(/\\r?\\n/);\n  // \u30AD\u30FC\u3092\u8907\u5408\u30AD\u30FC (dataId_admission) \u306B\u5909\u66F4\n  const caseMap: Record<string, CaseData> = {};\n\n  // \u30D8\u30C3\u30C0\u30FC\u884C\u3092\u9664\u3044\u305F\u30C7\u30FC\u30BF\u884C\u3092\u51E6\u7406\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i].trim();\n    if (!line) {\n      continue;\n    }\n\n    try {\n      const columns = line.split('\\t');\n      const extractedData = extractCaseData(columns);\n\n      if (extractedData) {\n        const { dataId, discharge, admission, procedure, procedureName } = extractedData;\n\n        // \u8907\u5408\u30AD\u30FC\u3092\u4F5C\u6210\n        const caseKey = `${dataId}_${admission}`;\n\n        // \u65E2\u5B58\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\u3092\u53D6\u5F97\u307E\u305F\u306F\u65B0\u898F\u4F5C\u6210 (\u8907\u5408\u30AD\u30FC\u3092\u4F7F\u7528)\n        let currentCase = caseMap[caseKey];\n        if (!currentCase) {\n          currentCase = {\n            id: dataId,\n            admission: admission,\n            discharge: discharge, // \u521D\u671F\u5024\u3068\u3057\u3066\u8A2D\u5B9A\n            procedures: [],\n            procedureNames: [],\n          };\n          caseMap[caseKey] = currentCase;\n        }\n\n        // \u9000\u9662\u65E5\u306E\u66F4\u65B0 (00000000 \u3067\u306A\u304F\u3001\u65E2\u5B58\u3088\u308A\u65B0\u3057\u3044\u65E5\u4ED8\u306E\u5834\u5408)\n        // \u3053\u306E\u75C7\u4F8B (\u8907\u5408\u30AD\u30FC\u3067\u7279\u5B9A) \u306E\u9000\u9662\u65E5\u3092\u66F4\u65B0\n        if (\n          discharge &&\n          discharge !== '00000000' &&\n          (!currentCase.discharge ||\n            currentCase.discharge === '00000000' ||\n            discharge > currentCase.discharge)\n        ) {\n          currentCase.discharge = discharge;\n        }\n\n        // \u5BFE\u8C61\u624B\u8853\u30B3\u30FC\u30C9\u3068\u540D\u79F0\u3092\u8FFD\u52A0\uFF08procedure\u304Cnull\u3067\u306A\u3044\u5834\u5408\u306E\u307F\uFF09\n        // \u3053\u306E\u75C7\u4F8B (\u8907\u5408\u30AD\u30FC\u3067\u7279\u5B9A) \u306E\u624B\u8853\u30EA\u30B9\u30C8\u306B\u8FFD\u52A0\n        if (procedure && !currentCase.procedures.includes(procedure)) {\n          currentCase.procedures.push(procedure);\n          if (!currentCase.procedureNames) {\n            currentCase.procedureNames = [];\n          }\n          currentCase.procedureNames.push(procedureName ?? '(\u540D\u79F0\u306A\u3057)');\n        }\n      }\n    } catch {\n      // \u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u3066\u3082\u51E6\u7406\u3092\u7D99\u7D9A\u3059\u308B\u304C\u3001\u30ED\u30B0\u306F\u6B8B\u3055\u306A\u3044\n      continue;\n    }\n  }\n\n  return Object.values(caseMap);\n}\n\n/**\n * \u8907\u6570\u30D5\u30A1\u30A4\u30EB\u304B\u3089\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\u3092\u7D71\u5408\u3059\u308B\u95A2\u6570\n * \u540C\u4E00ID\u306E\u75C7\u4F8B\u306B\u3064\u3044\u3066\u306F\u3001\u9000\u9662\u65E5\u304C\u66F4\u65B0\u3055\u308C\u3066\u3044\u308B\u5834\u5408\u306B\u5DEE\u3057\u66FF\u3048\u3001\u624B\u8853\u30B3\u30FC\u30C9\u306F\u7D71\u5408\u3057\u307E\u3059\n * @param existingCases - \u65E2\u5B58\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\n * @param newCases - \u65B0\u3057\u3044\u75C7\u4F8B\u30C7\u30FC\u30BF\n * @returns \u7D71\u5408\u3055\u308C\u305F\u75C7\u4F8B\u30C7\u30FC\u30BF\n */\nexport function mergeCases(existingCases: CaseData[], newCases: CaseData[]): CaseData[] {\n  // \u30AD\u30FC\u3092\u8907\u5408\u30AD\u30FC (dataId_admission) \u306B\u5909\u66F4\n  const caseMap: Record<string, CaseData> = {};\n\n  // \u65E2\u5B58\u306E\u30B1\u30FC\u30B9\u3092\u30DE\u30C3\u30D7\u306B\u8FFD\u52A0 (\u8907\u5408\u30AD\u30FC\u3092\u4F7F\u7528)\n  for (const c of existingCases) {\n    const caseKey = `${c.id}_${c.admission}`;\n    caseMap[caseKey] = createSafeCase(c); // \u65E2\u5B58\u30C7\u30FC\u30BF\u3082\u5B89\u5168\u306B\u30B3\u30D4\u30FC\n  }\n\n  // \u65B0\u3057\u3044\u30B1\u30FC\u30B9\u3092\u30DE\u30FC\u30B8 (\u8907\u5408\u30AD\u30FC\u3092\u4F7F\u7528)\n  for (const c of newCases) {\n    const caseKey = `${c.id}_${c.admission}`;\n    if (caseMap[caseKey]) {\n      // \u65E2\u5B58\u75C7\u4F8B\u306E\u66F4\u65B0\u51E6\u7406 (\u8907\u5408\u30AD\u30FC\u3067\u7279\u5B9A\u3055\u308C\u305F\u75C7\u4F8B\u3092\u66F4\u65B0)\n      updateExistingCase(caseMap[caseKey], c);\n    } else {\n      // \u65B0\u3057\u3044\u75C7\u4F8B\u3092\u8FFD\u52A0 (\u8907\u5408\u30AD\u30FC\u3067\u30DE\u30C3\u30D7\u306B\u8FFD\u52A0)\n      caseMap[caseKey] = createSafeCase(c);\n    }\n  }\n\n  return Object.values(caseMap);\n}\n\n/**\n * \u65E2\u5B58\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\u3092\u65B0\u3057\u3044\u30C7\u30FC\u30BF\u3067\u66F4\u65B0\u3059\u308B\n * @param currentCase - \u66F4\u65B0\u5BFE\u8C61\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\n * @param newCase - \u65B0\u3057\u3044\u75C7\u4F8B\u30C7\u30FC\u30BF\n */\nfunction updateExistingCase(currentCase: CaseData, newCase: CaseData): void {\n  // \u9000\u9662\u65E5\u304C\u78BA\u5B9A\u3057\u305F\u5834\u5408\uFF0800000000 \u304B\u3089\u5177\u4F53\u7684\u306A\u65E5\u4ED8\u306B\u5909\u308F\u3063\u305F\u5834\u5408\uFF09\n  // \u307E\u305F\u306F\u3001\u3088\u308A\u65B0\u3057\u3044\u9000\u9662\u65E5\u304C\u6765\u305F\u5834\u5408 (YYYYMMDD\u5F62\u5F0F\u306A\u306E\u3067\u6587\u5B57\u5217\u6BD4\u8F03\u3067OK)\n  if (\n    newCase.discharge &&\n    newCase.discharge !== '00000000' &&\n    (!currentCase.discharge ||\n      currentCase.discharge === '00000000' ||\n      newCase.discharge > currentCase.discharge)\n  ) {\n    currentCase.discharge = newCase.discharge;\n  }\n\n  // procedures \u3068 procedureNames \u306E\u521D\u671F\u5316\u3092\u78BA\u5B9F\u306B\u884C\u3046\n  if (!Array.isArray(currentCase.procedures)) {\n    currentCase.procedures = [];\n  }\n  if (!Array.isArray(currentCase.procedureNames)) {\n    currentCase.procedureNames = [];\n  }\n\n  // \u65B0\u3057\u3044\u624B\u8853\u30B3\u30FC\u30C9\u3092\u8FFD\u52A0\n  mergeProcedures(currentCase, newCase);\n}\n\n/**\n * \u5B89\u5168\u306A\u75C7\u4F8B\u30C7\u30FC\u30BF\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u3092\u4F5C\u6210\u3059\u308B\n * @param c - \u5143\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\n * @returns \u914D\u5217\u304C\u521D\u671F\u5316\u3055\u308C\u305F\u75C7\u4F8B\u30C7\u30FC\u30BF\n */\nfunction createSafeCase(c: CaseData): CaseData {\n  return {\n    ...c,\n    procedures: Array.isArray(c.procedures) ? [...c.procedures] : [],\n    procedureNames: Array.isArray(c.procedureNames) ? [...c.procedureNames] : [],\n  };\n}\n\n/**\n * \u75C7\u4F8B\u306E\u51E6\u7F6E\u30C7\u30FC\u30BF\u3092\u7D71\u5408\u3059\u308B\n * @param currentCase - \u7D71\u5408\u5148\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\n * @param newCase - \u7D71\u5408\u5143\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\n */\nfunction mergeProcedures(currentCase: CaseData, newCase: CaseData): void {\n  // \u65B0\u3057\u3044\u624B\u8853\u30B3\u30FC\u30C9\u3092\u8FFD\u52A0\uFF08\u91CD\u8907\u3092\u907F\u3051\u308B\uFF09\n  const procedures = Array.isArray(newCase.procedures) ? newCase.procedures : [];\n  const procedureNames = Array.isArray(newCase.procedureNames) ? newCase.procedureNames : [];\n\n  for (let i = 0; i < procedures.length; i++) {\n    const proc = procedures[i];\n    if (!currentCase.procedures.includes(proc)) {\n      currentCase.procedures.push(proc);\n\n      // procedureNames\u304C\u672A\u5B9A\u7FA9\u306E\u5834\u5408\u306F\u521D\u671F\u5316\n      if (!currentCase.procedureNames) {\n        currentCase.procedureNames = [];\n      }\n      // \u5BFE\u5FDC\u3059\u308B\u624B\u8853\u540D\u3082\u8FFD\u52A0\uFF08\u5B58\u5728\u3057\u306A\u3044\u5834\u5408\u306F\u30C7\u30D5\u30A9\u30EB\u30C8\u5024\uFF09\n      currentCase.procedureNames.push(procedureNames[i] ?? '(\u540D\u79F0\u306A\u3057)');\n    }\n  }\n}\n", "/**\n * \u77ED\u671F\u6EDE\u5728\u624B\u8853\u7B49\u57FA\u672C\u6599\uFF13\u5224\u5B9A\u30D7\u30ED\u30B0\u30E9\u30E0 - \u30E6\u30FC\u30C6\u30A3\u30EA\u30C6\u30A3\u95A2\u6570\n * \u3053\u306E\u30D5\u30A1\u30A4\u30EB\u306B\u306F\u3001\u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u5168\u4F53\u3067\u4F7F\u7528\u3055\u308C\u308B\u6C4E\u7528\u7684\u306A\u95A2\u6570\u3092\u542B\u307F\u307E\u3059\u3002\n */\n\n/**\n * \u65E5\u4ED8\u6587\u5B57\u5217\uFF08yyyymmdd\uFF09\u3092Date\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u306B\u5909\u63DB\u3059\u308B\u95A2\u6570\n * @param dateStr - \u5909\u63DB\u3059\u308B\u65E5\u4ED8\u6587\u5B57\u5217\uFF08yyyymmdd\u5F62\u5F0F\uFF09\n * @returns Date\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u307E\u305F\u306Fnull\uFF08\u7121\u52B9\u306A\u65E5\u4ED8\u306E\u5834\u5408\uFF09\n */\nexport function parseDate(dateStr: string): Date | null {\n  if (!dateStr || dateStr === '00000000') return null;\n\n  try {\n    const year = parseInt(dateStr.substring(0, 4), 10);\n    const month = parseInt(dateStr.substring(4, 6), 10) - 1; // \u6708\u306F0\u304B\u3089\u59CB\u307E\u308B\n    const day = parseInt(dateStr.substring(6, 8), 10);\n\n    const date = new Date(year, month, day);\n\n    // \u6709\u52B9\u306A\u65E5\u4ED8\u304B\u30C1\u30A7\u30C3\u30AF\n    if (isNaN(date.getTime())) return null;\n\n    return date;\n  } catch (error) {\n    console.error(\n      `\u65E5\u4ED8\u306E\u89E3\u6790\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F: ${dateStr} - ${\n        error instanceof Error ? error.message : String(error)\n      }`,\n    );\n    return null;\n  }\n}\n\n/**\n * \u5165\u9662\u671F\u9593\uFF08\u65E5\u6570\uFF09\u3092\u8A08\u7B97\u3059\u308B\u95A2\u6570\n * @param admissionStr - \u5165\u9662\u65E5\uFF08yyyymmdd\u5F62\u5F0F\uFF09\n * @param dischargeStr - \u9000\u9662\u65E5\uFF08yyyymmdd\u5F62\u5F0F\uFF09\n * @returns \u5165\u9662\u65E5\u6570\u307E\u305F\u306F null\uFF08\u65E5\u4ED8\u304C\u7121\u52B9\u306A\u5834\u5408\uFF09\n */\nexport function calculateHospitalDays(admissionStr: string, dischargeStr: string): number | null {\n  const admissionDate = parseDate(admissionStr);\n  const dischargeDate = parseDate(dischargeStr);\n\n  if (!admissionDate || !dischargeDate) return null;\n\n  // \u30DF\u30EA\u79D2\u6570\u3092\u65E5\u6570\u306B\u5909\u63DB\uFF081\u65E5 = 24 * 60 * 60 * 1000 \u30DF\u30EA\u79D2\uFF09\n  // \u5165\u9662\u65E5\u3068\u9000\u9662\u65E5\u3082\u671F\u9593\u306B\u542B\u3081\u308B\u305F\u3081\u3001\u8A08\u7B97\u7D50\u679C\u306B1\u3092\u52A0\u3048\u308B\n  const diffDays = Math.round(\n    (dischargeDate.getTime() - admissionDate.getTime()) / (1000 * 60 * 60 * 24),\n  );\n  return diffDays + 1;\n}\n\n/**\n * \u65E5\u4ED8\u6587\u5B57\u5217\u306E\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3092\u5909\u63DB\u3059\u308B\u95A2\u6570\n * @param dateStr - \u5909\u63DB\u3059\u308B\u65E5\u4ED8\u6587\u5B57\u5217\uFF08yyyymmdd\u5F62\u5F0F\uFF09\n * @param format - \u51FA\u529B\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\uFF08'yyyymmdd'\u307E\u305F\u306F'yyyy/mm/dd'\uFF09\n * @returns \u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3055\u308C\u305F\u65E5\u4ED8\u6587\u5B57\u5217\u3001\u307E\u305F\u306F\u5143\u306E\u6587\u5B57\u5217\uFF08\u7121\u52B9\u306A\u65E5\u4ED8\u306E\u5834\u5408\uFF09\n */\nexport function formatDate(\n  dateStr: string,\n  format: 'yyyymmdd' | 'yyyy/mm/dd' = 'yyyymmdd',\n): string {\n  // 00000000\u306E\u5834\u5408\u306F\u305D\u306E\u307E\u307E\u8FD4\u3059\n  if (dateStr === '00000000') return dateStr;\n\n  // \u65E5\u4ED8\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u306B\u5909\u63DB\n  const date = parseDate(dateStr);\n  if (!date) return dateStr; // \u5909\u63DB\u3067\u304D\u306A\u3044\u5834\u5408\u306F\u5143\u306E\u6587\u5B57\u5217\u3092\u8FD4\u3059\n\n  // \u5E74\u3001\u6708\u3001\u65E5\u3092\u53D6\u5F97\n  const year = date.getFullYear();\n  const month = date.getMonth() + 1; // \u6708\u306F0\u304B\u3089\u59CB\u307E\u308B\u306E\u3067+1\n  const day = date.getDate();\n\n  // \u6307\u5B9A\u3055\u308C\u305F\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306B\u5909\u63DB\n  if (format === 'yyyy/mm/dd') {\n    return `${year}/${month.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}`;\n  } else {\n    return `${year}${month.toString().padStart(2, '0')}${day.toString().padStart(2, '0')}`;\n  }\n}\n\n/**\n * \u30A8\u30E9\u30FC\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u304B\u3089\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u53D6\u5F97\u3059\u308B\u30D8\u30EB\u30D1\u30FC\u95A2\u6570\n * @param error - \u30A8\u30E9\u30FC\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u307E\u305F\u306F\u4EFB\u610F\u306E\u5024\n * @returns \u30A8\u30E9\u30FC\u30E1\u30C3\u30BB\u30FC\u30B8\u6587\u5B57\u5217\n */\nexport function getErrorMessage(error: unknown): string {\n  if (error instanceof Error) return error.message;\n  return String(error);\n}\n", "/**\n * \u77ED\u671F\u6EDE\u5728\u624B\u8853\u7B49\u57FA\u672C\u6599\uFF13\u5224\u5B9A\u30D7\u30ED\u30B0\u30E9\u30E0 - \u8A55\u4FA1\u30ED\u30B8\u30C3\u30AF\n * \u3053\u306E\u30D5\u30A1\u30A4\u30EB\u306B\u306F\u3001\u77ED\u624B\uFF13\u8A72\u5F53\u75C7\u4F8B\u306E\u5224\u5B9A\u306A\u3069\u306E\u8A55\u4FA1\u30ED\u30B8\u30C3\u30AF\u3092\u542B\u307F\u307E\u3059\u3002\n */\n\nimport { CaseData, OutputSettings } from './types.ts';\nimport { calculateHospitalDays, formatDate } from './utils.ts'; // formatDate \u3092\u30A4\u30F3\u30DD\u30FC\u30C8\nimport {\n  COLONOSCOPY_PROCEDURE_CODES,\n  COLONOSCOPY_SPECIAL_ADDITIONS,\n  DEFAULT_RESULT_HEADER,\n  INELIGIBILITY_REASONS,\n  MAX_HOSPITAL_DAYS,\n  PROCEDURE_NAME_MAP,\n  TARGET_PROCEDURES,\n} from './constants.ts';\n\n/**\n * \u77ED\u624B\uFF13\u8A72\u5F53\u75C7\u4F8B\u3092\u5224\u5B9A\u3059\u308B\u95A2\u6570\n * \u5404\u75C7\u4F8B\u304C\u77ED\u671F\u6EDE\u5728\u624B\u8853\u7B49\u57FA\u672C\u6599\uFF13\u306E\u6761\u4EF6\u306B\u8A72\u5F53\u3059\u308B\u304B\u3092\u5224\u5B9A\u3057\u307E\u3059\n * @param cases - \u5224\u5B9A\u5BFE\u8C61\u306E\u75C7\u4F8B\u30C7\u30FC\u30BF\n * @returns \u77ED\u624B\uFF13\u306B\u8A72\u5F53\u3059\u308B\u75C7\u4F8B\u30C7\u30FC\u30BF\uFF08ID\u6607\u9806\u3067\u30BD\u30FC\u30C8\u6E08\u307F\uFF09\n */\nexport function evaluateCases(cases: CaseData[]): CaseData[] {\n  // \u5168\u75C7\u4F8B\u306B\u5BFE\u3057\u3066\u9069\u683C\u6027\u3068\u7406\u7531\u3092\u8A2D\u5B9A\n  const evaluatedCases = cases.map((c) => {\n    try {\n      // \u8A55\u4FA1\u7D50\u679C\u3092\u683C\u7D0D\u3059\u308B\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u3092\u4F5C\u6210\uFF08\u5143\u306E\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u3092\u30B3\u30D4\u30FC\uFF09\n      const evaluatedCase = { ...c };\n\n      // 1. \u9000\u9662\u65E5\u304C '00000000' \u3067\u306A\u3044\uFF08\u9000\u9662\u304C\u78BA\u5B9A\u3057\u3066\u3044\u308B\uFF09\n      if (!c.discharge || c.discharge === '00000000') {\n        evaluatedCase.isEligible = false;\n        evaluatedCase.reason = INELIGIBILITY_REASONS.UNDISCHARGED;\n        return evaluatedCase;\n      }\n\n      // 2. \u5BFE\u8C61\u624B\u8853\u7B49\u306E\u5B9F\u65BD\uFF08\u5C11\u306A\u304F\u3068\u30821\u3064\u306E\u5BFE\u8C61\u624B\u8853\u7B49\u304C\u5B9F\u65BD\u3055\u308C\u3066\u3044\u308B\uFF09\n      const targetProceduresFound = c.procedures.filter((p) => TARGET_PROCEDURES.includes(p));\n\n      if (targetProceduresFound.length === 0) {\n        evaluatedCase.isEligible = false;\n        evaluatedCase.reason = INELIGIBILITY_REASONS.NO_TARGET_PROCEDURE;\n        return evaluatedCase;\n      }\n\n      // 3. \u5165\u9662\u671F\u9593\u304C5\u65E5\u4EE5\u5185\n      const hospitalDays = calculateHospitalDays(c.admission, c.discharge);\n\n      if (hospitalDays === null || hospitalDays > MAX_HOSPITAL_DAYS) {\n        evaluatedCase.isEligible = false;\n        evaluatedCase.reason = INELIGIBILITY_REASONS.HOSPITAL_DAYS_EXCEEDED;\n        return evaluatedCase;\n      }\n\n      // 4. \u5165\u9662\u671F\u9593\u4E2D\u306B\u5BFE\u8C61\u624B\u8853\u7B49\u30922\u4EE5\u4E0A\u5B9F\u65BD\u3057\u3066\u3044\u306A\u3044\u304B\u30C1\u30A7\u30C3\u30AF\n      // \u305F\u3060\u3057\u3001\u540C\u4E00\u306E\u5BFE\u8C61\u624B\u8853\u7B49\u3092\u8907\u6570\u56DE\u5B9F\u65BD\u3059\u308B\u5834\u5408\u306F\u4F8B\u5916\u3068\u3059\u308B\n      if (targetProceduresFound.length > 1) {\n        // \u5BFE\u8C61\u624B\u8853\u7B49\u306E\u7A2E\u985E\u6570\u3092\u30AB\u30A6\u30F3\u30C8\uFF08\u91CD\u8907\u3092\u9664\u5916\uFF09\n        const uniqueTargetProcedures = new Set(targetProceduresFound);\n        if (uniqueTargetProcedures.size > 1) {\n          evaluatedCase.isEligible = false;\n          evaluatedCase.reason = INELIGIBILITY_REASONS.MULTIPLE_TARGET_PROCEDURES;\n          return evaluatedCase;\n        }\n      }\n\n      // 5. \u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u30FB\u7C98\u819C\u5207\u9664\u8853\u306E\u7279\u5B9A\u52A0\u7B97\u30C1\u30A7\u30C3\u30AF (\u4ED6\u306E\u624B\u8853\u30C1\u30A7\u30C3\u30AF\u3088\u308A\u5148\u306B\u5B9F\u65BD)\n      // \u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u30FB\u7C98\u819C\u5207\u9664\u8853\u3092\u5B9F\u65BD\u3057\u305F\u304B\u3069\u3046\u304B\n      const hasColonoscopy = c.procedures.some((p) => COLONOSCOPY_PROCEDURE_CODES.includes(p));\n\n      // \u7279\u5B9A\u52A0\u7B97\u304C\u542B\u307E\u308C\u3066\u3044\u308B\u304B\u3069\u3046\u304B\n      const hasSpecialAddition = c.procedures.some((p) =>\n        COLONOSCOPY_SPECIAL_ADDITIONS.includes(p)\n      );\n\n      // \u5185\u8996\u93E1\u7684\u5927\u8178\u30DD\u30EA\u30FC\u30D7\u8853\u306B\u7279\u5B9A\u52A0\u7B97\u304C\u3042\u308B\u5834\u5408\u306F\u5BFE\u8C61\u5916\n      if (hasColonoscopy && hasSpecialAddition) {\n        evaluatedCase.isEligible = false;\n        evaluatedCase.reason = INELIGIBILITY_REASONS.SPECIAL_ADDITION;\n        return evaluatedCase;\n      }\n\n      // 6. \u5165\u9662\u671F\u9593\u4E2D\u306B\u5BFE\u8C61\u624B\u8853\u7B49\u306B\u52A0\u3048\u3066\u3001\u4ED6\u306E\u624B\u8853\u3092\u5B9F\u65BD\u3057\u3066\u3044\u306A\u3044\u304B\u30C1\u30A7\u30C3\u30AF\n      // \u624B\u8853\u30B3\u30FC\u30C9\u306F\u901A\u5E38 '15' \u3067\u59CB\u307E\u308B\u304C\u3001\u8A3A\u7642\u660E\u7D30\u540D\u79F0\u306B\u300C\u52A0\u7B97\u300D\u304C\u542B\u307E\u308C\u308B\u30B3\u30FC\u30C9\u306F\u624B\u8853\u3067\u306F\u306A\u3044\u305F\u3081\u9664\u5916\n      const surgeryProcedures = c.procedures.filter((p, index) => {\n        // \u5BFE\u8C61\u624B\u8853\u7B49\u306B\u542B\u307E\u308C\u308B\u30B3\u30FC\u30C9\u306F\u9664\u5916\n        if (TARGET_PROCEDURES.includes(p)) return false;\n\n        // '15'\u3067\u59CB\u307E\u308B\u30B3\u30FC\u30C9\u306E\u307F\u3092\u5BFE\u8C61\n        if (!p.startsWith('15')) return false;\n\n        // \u8A3A\u7642\u660E\u7D30\u540D\u79F0\u306B\u300C\u52A0\u7B97\u300D\u304C\u542B\u307E\u308C\u308B\u30B3\u30FC\u30C9\u306F\u624B\u8853\u3067\u306F\u306A\u3044\u305F\u3081\u9664\u5916\n        if (\n          c.procedureNames &&\n          c.procedureNames[index] &&\n          c.procedureNames[index].includes('\u52A0\u7B97')\n        ) {\n          return false;\n        }\n\n        // \u52A0\u7B97\u30B3\u30FC\u30C9\u306F\u901A\u5E38\u3001\u7279\u5B9A\u306E\u30D1\u30BF\u30FC\u30F3\u3092\u6301\u3064\uFF08\u4F8B\uFF1A150000490\uFF09\n        // \u591A\u304F\u306E\u52A0\u7B97\u30B3\u30FC\u30C9\u306F '1500' \u3067\u59CB\u307E\u308A\u3001\u305D\u306E\u5F8C\u306B '00' \u304C\u7D9A\u304F\n        if (p.startsWith('1500') && p.substring(4, 6) === '00') return false;\n\n        return true;\n      });\n\n      if (surgeryProcedures.length > 0) {\n        evaluatedCase.isEligible = false;\n        evaluatedCase.reason = INELIGIBILITY_REASONS.OTHER_SURGERY;\n        return evaluatedCase;\n      }\n\n      // \u3059\u3079\u3066\u306E\u6761\u4EF6\u3092\u6E80\u305F\u3059\u5834\u5408\u306F\u77ED\u624B\uFF13\u5BFE\u8C61\u75C7\u4F8B\n      evaluatedCase.isEligible = true;\n\n      // \u5B9F\u65BD\u3055\u308C\u305F\u5BFE\u8C61\u624B\u8853\u306E\u540D\u79F0\u3092\u7406\u7531\u3068\u3057\u3066\u8A2D\u5B9A\n      const procedureCode = targetProceduresFound[0]; // \u6700\u521D\u306E\u5BFE\u8C61\u624B\u8853\u30B3\u30FC\u30C9\n      evaluatedCase.reason = PROCEDURE_NAME_MAP[procedureCode] || '\u5BFE\u8C61\u624B\u8853\u7B49';\n\n      return evaluatedCase;\n    } catch (error) {\n      console.error(\n        `\u75C7\u4F8B ${c.id} \u306E\u8A55\u4FA1\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F: ${\n          error instanceof Error ? error.message : String(error)\n        }`,\n      );\n      // \u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u305F\u5834\u5408\u306F\u8A72\u5F53\u3057\u306A\u3044\u3068\u5224\u65AD\n      return {\n        ...c,\n        isEligible: false,\n        reason: `\u8A55\u4FA1\u30A8\u30E9\u30FC: ${error instanceof Error ? error.message : String(error)}`,\n      };\n    }\n  });\n\n  // \u4FEE\u6B63: \u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\u305B\u305A\u3001\u5168\u3066\u306E\u8A55\u4FA1\u6E08\u307F\u75C7\u4F8B\u3092\u8FD4\u3059\n  // \u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\u306F formatResults \u3067\u884C\u3046\n  // ID\u9806\u306B\u30BD\u30FC\u30C8\n  return evaluatedCases.sort((a, b) => a.id.localeCompare(b.id));\n}\n\n/**\n * \u7D50\u679C\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3059\u308B\u95A2\u6570\n * \u5224\u5B9A\u7D50\u679C\u3092\u30BF\u30D6\u533A\u5207\u308A\u30C6\u30AD\u30B9\u30C8\u5F62\u5F0F\u3067\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3057\u307E\u3059\n * @param cases - \u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3059\u308B\u75C7\u4F8B\u30C7\u30FC\u30BF\n * @param headerLine - \u51FA\u529B\u30D8\u30C3\u30C0\u30FC\u884C\uFF08\u30C7\u30D5\u30A9\u30EB\u30C8: DEFAULT_RESULT_HEADER\uFF09\n * @param settings - \u51FA\u529B\u8A2D\u5B9A\uFF08outputMode \u3068 dateFormat \u3092\u542B\u3080\uFF09\n * @returns \u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u3055\u308C\u305F\u7D50\u679C\u30C6\u30AD\u30B9\u30C8\n */\nexport function formatResults(\n  cases: CaseData[],\n  headerLine: string = DEFAULT_RESULT_HEADER,\n  settings: OutputSettings, // \u30C7\u30D5\u30A9\u30EB\u30C8\u5024\u3092\u524A\u9664\u3057\u3001\u5FC5\u9808\u5F15\u6570\u3068\u3059\u308B\n): string {\n  // \u8A2D\u5B9A\u306B\u57FA\u3065\u3044\u3066\u51FA\u529B\u3059\u308B\u75C7\u4F8B\u3092\u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\n  const filteredCases = settings.outputMode === 'allCases'\n    ? cases\n    : cases.filter((c) => c.isEligible === true);\n\n  // \u75C7\u4F8B\u304C\u5B58\u5728\u3057\u306A\u3044\u5834\u5408\n  if (filteredCases.length === 0) {\n    return '\u8A72\u5F53\u3059\u308B\u75C7\u4F8B\u306F\u3042\u308A\u307E\u305B\u3093\u3002';\n  }\n\n  // \u30D8\u30C3\u30C0\u30FC\u884C\u3092\u914D\u5217\u306E\u6700\u521D\u306E\u8981\u7D20\u3068\u3057\u3066\u8FFD\u52A0\n  const lines = [headerLine];\n\n  // \u5404\u75C7\u4F8B\u306E\u30C7\u30FC\u30BF\u884C\u3092\u8FFD\u52A0\n  filteredCases.forEach((c) => {\n    // \u65E5\u4ED8\u3092\u6307\u5B9A\u3055\u308C\u305F\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u306B\u5909\u63DB\n    const admissionDate = formatDate(c.admission, settings.dateFormat);\n    const dischargeDate = formatDate(c.discharge, settings.dateFormat);\n\n    const line = `${c.id}\\t${admissionDate}\\t${dischargeDate}\\t${c.isEligible ? 'Yes' : 'No'}\\t${\n      c.reason || ''\n    }`;\n    lines.push(line);\n  });\n\n  // \u884C\u3092\u6539\u884C\u6587\u5B57\u3067\u7D50\u5408\u3057\u3066\u8FD4\u3059\n  return lines.join('\\n');\n}\n", "import { CaseData, OutputSettings } from './common/types.ts'; // OutputSettings \u3092\u30A4\u30F3\u30DD\u30FC\u30C8\nimport { readFileAsText } from './validator.ts'; // readFileAsText \u306F validator \u304B\u3089\u30A4\u30F3\u30DD\u30FC\u30C8\u3055\u308C\u308B\u60F3\u5B9A\nimport { mergeCases, parseEFFile } from './common/parsers.ts';\nimport { evaluateCases, formatResults } from './common/evaluator.ts';\nimport { DEFAULT_RESULT_HEADER } from './common/constants.ts'; // DEFAULT_RESULT_HEADER \u3092\u30A4\u30F3\u30DD\u30FC\u30C8\n\n/**\n * \u30D5\u30A1\u30A4\u30EB\u691C\u8A3C\u7D50\u679C\u578B\n * \u30D5\u30A1\u30A4\u30EB\u3054\u3068\u306E\u691C\u8A3C\u7D50\u679C\u3092\u8868\u3057\u307E\u3059\u3002\n */\nexport interface FileValidationResult {\n  file: File; // \u5BFE\u8C61\u30D5\u30A1\u30A4\u30EB\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n  isValid: boolean; // \u691C\u8A3C\u304C\u6210\u529F\u3057\u305F\u304B\n  warnings: string[]; // \u8B66\u544A\u30E1\u30C3\u30BB\u30FC\u30B8\u306E\u914D\u5217\n  errors: string[]; // \u30A8\u30E9\u30FC\u30E1\u30C3\u30BB\u30FC\u30B8\u306E\u914D\u5217\n}\n\n/**\n * \u30D5\u30A1\u30A4\u30EB\u51E6\u7406\u30AF\u30E9\u30B9\n * EF\u30D5\u30A1\u30A4\u30EB\u306E\u8AAD\u307F\u8FBC\u307F\u3068\u51E6\u7406\u3092\u884C\u3046\u30E6\u30FC\u30C6\u30A3\u30EA\u30C6\u30A3\n */\nclass FileProcessor {\n  /**\n   * \u8907\u6570\u306E\u30D5\u30A1\u30A4\u30EB\u3092\u51E6\u7406\u3059\u308B\n   * @param files \u51E6\u7406\u5BFE\u8C61\u306E\u30D5\u30A1\u30A4\u30EB\u914D\u5217\n   * @param settings \u51FA\u529B\u8A2D\u5B9A\n   * @returns \u51E6\u7406\u7D50\u679C\u306E\u30D7\u30ED\u30DF\u30B9\n   */\n  public async processFiles(files: File[], settings: OutputSettings): Promise<string> {\n    // settings \u5F15\u6570\u3092\u8FFD\u52A0\n    try {\n      if (!files || files.length === 0) {\n        throw new Error('\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093');\n      }\n\n      // \u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\u3092\u8AAD\u307F\u8FBC\u3080\n      const fileContents: string[] = [];\n      for (const file of files) {\n        const content = await readFileAsText(file);\n        fileContents.push(content);\n      }\n\n      // \u30D5\u30A1\u30A4\u30EB\u306E\u5185\u5BB9\u3092\u89E3\u6790\u3057\u3066\u75C7\u4F8B\u30C7\u30FC\u30BF\u3092\u7D71\u5408\n      let allCases: CaseData[] = [];\n      for (const content of fileContents) {\n        const cases = parseEFFile(content);\n        allCases = mergeCases(allCases, cases);\n      }\n\n      // \u5224\u5B9A\u51E6\u7406\u3092\u5B9F\u884C\n      const evaluatedCases = evaluateCases(allCases);\n\n      // \u7D50\u679C\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\n      const result = formatResults(evaluatedCases, DEFAULT_RESULT_HEADER, settings); // settings \u3092\u6E21\u3059\u3088\u3046\u306B\u4FEE\u6B63\n\n      return result;\n    } catch (error) {\n      console.error('\u30D5\u30A1\u30A4\u30EB\u51E6\u7406\u30A8\u30E9\u30FC:', error);\n      throw error;\n    }\n  }\n}\n\n// \u30B0\u30ED\u30FC\u30D0\u30EB\u3067\u30A2\u30AF\u30BB\u30B9\u53EF\u80FD\u306A\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4F5C\u6210\nexport const fileProcessor = new FileProcessor();\n", "/**\n * \u77ED\u671F\u6EDE\u5728\u624B\u8853\u7B49\u57FA\u672C\u6599\uFF13\u5224\u5B9A\u30D7\u30ED\u30B0\u30E9\u30E0 - \u30E1\u30A4\u30F3\u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\n *\n * \u3053\u306E\u30D5\u30A1\u30A4\u30EB\u306F\u3001\u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u306E\u30A8\u30F3\u30C8\u30EA\u30FC\u30DD\u30A4\u30F3\u30C8\u3067\u3059\u3002\n * \u5404\u30B3\u30F3\u30DD\u30FC\u30CD\u30F3\u30C8\u306E\u521D\u671F\u5316\u3068\u9023\u643A\u3092\u884C\u3044\u307E\u3059\u3002\n */\nimport { FileManager } from '../ui/components/file-manager.ts'; // fileManager \u30B7\u30F3\u30B0\u30EB\u30C8\u30F3\u306F\u4F7F\u308F\u306A\u3044\nimport { ResultViewer } from '../ui/components/result-viewer.ts'; // ResultViewer \u30AF\u30E9\u30B9\u3092\u30A4\u30F3\u30DD\u30FC\u30C8 (\u30B0\u30ED\u30FC\u30D0\u30EB\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u306F\u524A\u9664)\nimport { getNotificationSystem } from '../ui/components/notification.ts'; // getNotificationSystem \u3092\u30A4\u30F3\u30DD\u30FC\u30C8\nimport { fileProcessor } from '../core/file-processor.ts';\nimport { ErrorHandlerOptions } from '../core/common/types.ts'; // types.d.ts \u524A\u9664\u306B\u4F34\u3044\u30D1\u30B9\u5909\u66F4\n\n/**\n * \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u30AF\u30E9\u30B9\n */\nclass Application {\n  private loadingIndicator: HTMLElement | null = null;\n  private executeButton: HTMLButtonElement | null = null;\n  private fileManagerInstance: FileManager; // \u578B\u3092\u660E\u793A\n  private resultViewerInstance: ResultViewer; // ResultViewer \u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u4FDD\u6301\n\n  /**\n   * \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u30AF\u30E9\u30B9\u306E\u30B3\u30F3\u30B9\u30C8\u30E9\u30AF\u30BF\n   */\n  constructor() {\n    // \u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u306E\u4F5C\u6210 (\u4F9D\u5B58\u6027\u6CE8\u5165)\n    const notificationInstance = getNotificationSystem(); // \u5148\u306B\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\n    this.fileManagerInstance = new FileManager(notificationInstance); // FileManager \u306B\u6CE8\u5165\n    this.resultViewerInstance = new ResultViewer(); // ResultViewer \u3092\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u5316\n  }\n\n  /**\n   * \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u306E\u521D\u671F\u5316\n   */\n  public init(): void {\n    // DOM\u8981\u7D20\u306E\u53D6\u5F97\n    this.loadingIndicator = document.getElementById('loadingIndicator');\n    this.executeButton = document.getElementById('executeButton') as HTMLButtonElement;\n\n    // \u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u306E\u8A2D\u5B9A\n    this.setupEventListeners();\n\n    // \u30D5\u30A1\u30A4\u30EB\u30AF\u30EA\u30A2\u6642\u306E\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u3092\u8FFD\u52A0\n    document.addEventListener('filesClear', () => {\n      // ResultViewer \u306E\u7D50\u679C\u3082\u30AF\u30EA\u30A2\u3059\u308B (\u5FC5\u8981\u306B\u5FDC\u3058\u3066)\n      // this.resultViewerInstance.clearResult(); // clearResult \u30E1\u30BD\u30C3\u30C9\u304C\u3042\u308C\u3070\u547C\u3073\u51FA\u3059\n    });\n  }\n\n  /**\n   * \u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u306E\u8A2D\u5B9A\n   */\n  private setupEventListeners(): void {\n    // \u5B9F\u884C\u30DC\u30BF\u30F3\u306E\u30A4\u30D9\u30F3\u30C8\n    if (this.executeButton) {\n      this.executeButton.addEventListener('click', () => {\n        this.processFiles();\n      });\n    }\n\n    // \u4ED6\u306E\u30A4\u30D9\u30F3\u30C8\u30EA\u30B9\u30CA\u30FC\u3092\u8A2D\u5B9A...\n    // document.addEventListener('filesClear', () => { // init \u5185\u306B\u79FB\u52D5\n    //   // \u30D5\u30A1\u30A4\u30EB\u30AF\u30EA\u30A2\u6642\u306E\u51E6\u7406\uFF08\u30B9\u30C6\u30C3\u30D7\u66F4\u65B0\u306F\u524A\u9664\uFF09\n    // });\n  }\n\n  /**\n   * \u30D5\u30A1\u30A4\u30EB\u51E6\u7406\u306E\u5B9F\u884C\n   */\n  private async processFiles(): Promise<void> {\n    try {\n      // \u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u308B\u304B\u78BA\u8A8D\n      const selectedFiles = this.fileManagerInstance.getSelectedFiles();\n      if (selectedFiles.length === 0) {\n        this.handleError(new Error('\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093'), 'no-files', {\n          recoveryAction: {\n            message: '\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044',\n            label: '\u30D5\u30A1\u30A4\u30EB\u9078\u629E',\n            handler: () => {\n              const fileInput = document.getElementById('fileInput');\n              if (fileInput) fileInput.click();\n            },\n          },\n        });\n        return;\n      }\n\n      // \u51E6\u7406\u4E2D\u8868\u793A\n      if (this.loadingIndicator) {\n        this.loadingIndicator.classList.add('active');\n      }\n\n      // \u30D5\u30A1\u30A4\u30EB\u306E\u691C\u8A3C\n      const isValid = await this.fileManagerInstance.validateSelectedFiles();\n      if (!isValid) {\n        if (this.loadingIndicator) {\n          this.loadingIndicator.classList.remove('active');\n        }\n        // \u30B9\u30C6\u30C3\u30D7\u66F4\u65B0\u306F\u524A\u9664\n        return;\n      }\n\n      // UI\u304B\u3089\u51FA\u529B\u8A2D\u5B9A\u3092\u53D6\u5F97\n      const outputSettings = this.resultViewerInstance.getOutputSettings();\n\n      // \u51E6\u7406\u306E\u5B9F\u884C (\u8A2D\u5B9A\u3092\u6E21\u3059)\n      const resultText = await fileProcessor.processFiles(selectedFiles, outputSettings);\n\n      // \u7D50\u679C\u306E\u8868\u793A\n      this.resultViewerInstance.displayResult(resultText);\n\n      // \u6210\u529F\u901A\u77E5\n      getNotificationSystem().showToast('success', '\u51E6\u7406\u5B8C\u4E86', '\u51E6\u7406\u304C\u6B63\u5E38\u306B\u5B8C\u4E86\u3057\u307E\u3057\u305F', 5000, 2); // \u30B2\u30C3\u30BF\u30FC\u3092\u4F7F\u7528\n    } catch (error) {\n      this.handleError(error instanceof Error ? error : new Error('\u4E0D\u660E\u306A\u30A8\u30E9\u30FC'), 'processing', {\n        recoveryAction: {\n          message: '\u8A2D\u5B9A\u3092\u5909\u66F4\u3057\u3066\u518D\u8A66\u884C\u3057\u307E\u3059\u304B\uFF1F',\n          label: '\u518D\u8A66\u884C',\n          handler: () => {\n            if (this.executeButton) this.executeButton.click();\n          },\n        },\n        updateUI: () => {\n          // \u30A8\u30E9\u30FC\u6642\u306EUI\u66F4\u65B0\uFF08\u30B9\u30C6\u30C3\u30D7\u66F4\u65B0\u306F\u524A\u9664\uFF09\n        },\n      });\n    } finally {\n      // \u51E6\u7406\u4E2D\u8868\u793A\u3092\u975E\u8868\u793A\n      if (this.loadingIndicator) {\n        this.loadingIndicator.classList.remove('active');\n      }\n    }\n  }\n\n  /**\n   * \u30A8\u30E9\u30FC\u30CF\u30F3\u30C9\u30EA\u30F3\u30B0\n   * @param error \u30A8\u30E9\u30FC\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n   * @param context \u30A8\u30E9\u30FC\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\n   * @param options \u8FFD\u52A0\u30AA\u30D7\u30B7\u30E7\u30F3\n   */\n  private handleError(error: Error, context: string, options: ErrorHandlerOptions = {}): void {\n    console.error(`\u30A8\u30E9\u30FC (${context}):`, error);\n\n    // \u30A8\u30E9\u30FC\u30BF\u30A4\u30D7\u306B\u57FA\u3065\u3044\u3066\u9069\u5207\u306A\u30E1\u30C3\u30BB\u30FC\u30B8\u3068\u89E3\u6C7A\u7B56\u3092\u63D0\u4F9B\n    let title = '\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F';\n    let message = error.message || '\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F';\n    let solution = '';\n    const priority = 4; // \u30A8\u30E9\u30FC\u306F\u9AD8\u3044\u512A\u5148\u5EA6\n\n    switch (context) {\n      case 'processing':\n        title = '\u51E6\u7406\u30A8\u30E9\u30FC';\n        if (error.message.includes('\u30E1\u30E2\u30EA')) {\n          solution =\n            '\u30D5\u30A1\u30A4\u30EB\u30B5\u30A4\u30BA\u304C\u5927\u304D\u3059\u304E\u308B\u53EF\u80FD\u6027\u304C\u3042\u308A\u307E\u3059\u3002\u5C0F\u3055\u306A\u30D5\u30A1\u30A4\u30EB\u306B\u5206\u5272\u3057\u3066\u51E6\u7406\u3057\u3066\u304F\u3060\u3055\u3044';\n        } else {\n          solution = '\u5165\u529B\u30C7\u30FC\u30BF\u3092\u78BA\u8A8D\u3057\u3001\u518D\u5EA6\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044';\n        }\n        break;\n\n      case 'no-files':\n        title = '\u30D5\u30A1\u30A4\u30EB\u672A\u9078\u629E';\n        message = '\u30D5\u30A1\u30A4\u30EB\u304C\u9078\u629E\u3055\u308C\u3066\u3044\u307E\u305B\u3093';\n        solution = '\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E\u3057\u3066\u304B\u3089\u51E6\u7406\u3092\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044';\n        break;\n\n      default:\n        solution = '\u554F\u984C\u304C\u89E3\u6C7A\u3057\u306A\u3044\u5834\u5408\u306F\u3001\u30DA\u30FC\u30B8\u3092\u518D\u8AAD\u307F\u8FBC\u307F\u3057\u3066\u304F\u3060\u3055\u3044';\n    }\n\n    // \u89E3\u6C7A\u7B56\u304C\u3042\u308B\u5834\u5408\u306F\u30E1\u30C3\u30BB\u30FC\u30B8\u306B\u8FFD\u52A0\n    const fullMessage = solution\n      ? `${message}<br><span class=\"error-solution\">\u89E3\u6C7A\u7B56: ${solution}</span>`\n      : message;\n\n    // \u901A\u77E5\u3092\u8868\u793A\n    getNotificationSystem().showToast('error', title, fullMessage, 8000, priority); // \u30B2\u30C3\u30BF\u30FC\u3092\u4F7F\u7528\n\n    // \u30A8\u30E9\u30FC\u56DE\u5FA9\u306E\u305F\u3081\u306E\u30A2\u30AF\u30B7\u30E7\u30F3\u3092\u63D0\u4F9B\n    if (\n      options.recoveryAction &&\n      options.recoveryAction.message &&\n      options.recoveryAction.label &&\n      options.recoveryAction.handler\n    ) {\n      const recoveryAction = {\n        message: options.recoveryAction.message,\n        label: options.recoveryAction.label,\n        handler: options.recoveryAction.handler,\n      };\n\n      setTimeout(() => {\n        getNotificationSystem().showRecoveryToast(recoveryAction); // \u30B2\u30C3\u30BF\u30FC\u3092\u4F7F\u7528\n      }, 1000);\n    }\n\n    // \u30A8\u30E9\u30FC\u72B6\u614B\u3092UI\u306B\u53CD\u6620\n    if (options.updateUI) {\n      options.updateUI();\n    }\n  }\n}\n\n// DOMContentLoaded \u30A4\u30D9\u30F3\u30C8\u3067\u521D\u671F\u5316\ndocument.addEventListener('DOMContentLoaded', () => {\n  try {\n    const app = new Application();\n    app.init();\n  } catch (error) {\n    console.error('\u521D\u671F\u5316\u30A8\u30E9\u30FC:', error);\n    // \u30A8\u30E9\u30FC\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u753B\u9762\u306B\u8868\u793A\n    const errorDiv = document.createElement('div');\n    errorDiv.className = 'initialization-error';\n    errorDiv.textContent = '\u521D\u671F\u5316\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F\u3002\u30DA\u30FC\u30B8\u3092\u518D\u8AAD\u307F\u8FBC\u307F\u3057\u3066\u304F\u3060\u3055\u3044\u3002';\n    document.body.prepend(errorDiv);\n  }\n});\n"],
  "mappings": "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",
  "names": ["NotificationSystem", "containerId", "container", "historyButton", "type", "title", "message", "duration", "priority", "timestamp", "toastId", "toastData", "a", "b", "toast", "visibleToasts", "existingModal", "modal", "historyItems", "item", "timeString", "button", "e", "icon", "action", "recoveryToastId", "notificationSystemInstance", "getNotificationSystem", "validateFiles", "files", "validationResults", "file", "content", "readFileAsText", "result", "validateFileContent", "resolve", "reject", "reader", "event", "validateBasicContent", "lines", "validateHeaderLine", "validateDataLines", "line", "headerLine", "trimmedHeader", "sampleSize", "tabWarningIssued", "columnCountWarningIssued", "actionDetailNumWarningIssued", "i", "lineWarnings", "validateDataLine", "columns", "actionDetailNum", "lineIndex", "dateActionResult", "validateDateAndActionDetail", "admission", "e", "FileManager", "notificationSystemInstance", "fileSelectButton", "e", "event", "target", "fileName", "files", "textFiles", "file", "existingFileNames", "f", "newFiles", "duplicateCount", "initialLength", "results", "validateFiles", "result", "error", "validationResults", "html", "fileStatus", "msg", "icon", "context", "options", "title", "message", "solution", "priority", "fullMessage", "recoveryAction", "ResultViewer", "viewMode", "textToCopy", "err", "resultText", "debugInfo", "displayText", "resultContainer", "hasResult", "tbody", "lines", "i", "columns", "row", "j", "cell", "blob", "url", "date", "dateStr", "eligibleOnlyRadio", "dateFormatRadios", "dateFormat", "radio", "DEFAULT_RESULT_HEADER", "COLONOSCOPY_PROCEDURE_CODE_SMALL", "COLONOSCOPY_PROCEDURE_CODE_LARGE", "COLONOSCOPY_PROCEDURE_CODES", "PROCEDURE_NAME_MAP", "TARGET_PROCEDURES", "COLONOSCOPY_SPECIAL_ADDITIONS", "MAX_HOSPITAL_DAYS", "INELIGIBILITY_REASONS", "extractCaseData", "columns", "dataId", "admission", "discharge", "basicInfo", "procedure", "procedureName", "TARGET_PROCEDURES", "parseEFFile", "content", "lines", "caseMap", "line", "extractedData", "caseKey", "currentCase", "mergeCases", "existingCases", "newCases", "c", "createSafeCase", "updateExistingCase", "newCase", "mergeProcedures", "procedures", "procedureNames", "i", "proc", "parseDate", "dateStr", "year", "month", "day", "date", "error", "calculateHospitalDays", "admissionStr", "dischargeStr", "admissionDate", "dischargeDate", "formatDate", "format", "evaluateCases", "cases", "c", "evaluatedCase", "INELIGIBILITY_REASONS", "targetProceduresFound", "p", "TARGET_PROCEDURES", "hospitalDays", "calculateHospitalDays", "MAX_HOSPITAL_DAYS", "hasColonoscopy", "COLONOSCOPY_PROCEDURE_CODES", "hasSpecialAddition", "COLONOSCOPY_SPECIAL_ADDITIONS", "index", "procedureCode", "PROCEDURE_NAME_MAP", "error", "a", "b", "formatResults", "headerLine", "DEFAULT_RESULT_HEADER", "settings", "filteredCases", "lines", "admissionDate", "formatDate", "dischargeDate", "line", "FileProcessor", "files", "settings", "fileContents", "file", "content", "readFileAsText", "allCases", "cases", "parseEFFile", "mergeCases", "evaluatedCases", "evaluateCases", "formatResults", "DEFAULT_RESULT_HEADER", "error", "fileProcessor", "Application", "notificationInstance", "getNotificationSystem", "FileManager", "ResultViewer", "selectedFiles", "fileInput", "outputSettings", "resultText", "fileProcessor", "error", "context", "options", "title", "message", "solution", "priority", "fullMessage", "recoveryAction", "errorDiv"]
}
