# Project Overview

## 前提条件

* 入院EF統合ファイルについては、`入院EF統合ファイルについて.md`を参照すること。
* 短期滞在手術等基本料３（以下、「短手３」という。）については、`短期滞在手術等基本料３について.md`を参照すること。

## プログラムの狙い

* このプログラムは、入院EF統合ファイルを読み込み、それぞれの症例が短手３に該当するかどうかを判別する。

## プログラム構成

* プログラムは以下のファイルで構成される：
  * `index.html` - ユーザーインターフェース
  * `common.js` - 共通のビジネスロジック（データ解析、判定処理など）
  * `main.js` - ブラウザ環境での実行に関する処理
  * `test.js` - 自動テスト実行用スクリプト

* 各ファイルの役割：
  * `common.js` - 両環境（ブラウザとNode.js）で共通して使用される関数を定義
  * `main.js` - ブラウザ上でのUI処理（ファイル読み込み、結果表示など）
  * `test.js` - Node.js環境でのテスト実行（サンプルデータの処理と結果検証）

## 仕様

* プログラムは`HTML`ファイルと`JavaScript`で構成される。
* Windows PCのローカルに保存され、`HTML`ファイルをブラウザで開いて実行される。
* EFファイルを入力できる。仕様は`入力データ`を参照のこと。
* "実行"ボタンを押すと、EF対象症例を判定する処理を行う。
* 結果は、`出力データ`に従い対象症例を出力する。

## 入力データ

* 1つ以上の入院統合EFファイル。
* 複数入力可（連続した複数月のファイルが入力される可能性がある）。
* プログラム上のファイルピッカーで選択できる。

## 出力データ

* 次のフォーマットで短手３該当症例を出力する。
* フォーマットはタブ区切りテキストファイルである。
* 1行目はタイトル行で、2行目以降にデータを出力する。
* 出力順は`データ識別番号`の昇順とする。

~~~
データ識別番号	入院年月日	退院年月日
~~~

## テストデータと実行方法

* テストデータは`test_data\sampleEF`ディレクトリに格納されている入院EF統合ファイルです。
* 仕様通り処理を行った場合の期待される結果は`test_data\expect.txt`です。
* テストの実行方法：
  * コマンドラインで``node test.js``を実行
  * 正常に動作する場合は「テスト成功: 出力結果が期待される結果と一致しました。」と表示される

## 開発とメンテナンス

* ビジネスロジックの変更が必要な場合は`common.js`を修正する
* UI関連の変更が必要な場合は`index.html`と`main.js`を修正する
* テスト関連の変更が必要な場合は`test.js`を修正する
* 新しい機能を追加する場合は、適切なファイルに実装し、必要に応じてテストを追加する

## 注意点

* `入院EF統合ファイル`の`退院年月日`が`00000000`である場合
    * その症例の患者はその`入院EF統合ファイル`の対象となる月中に退院しなかったことを意味します。
    * つまり、その症例が`短手３該当症例`であるかどうかは未確定です。
    * ただし、それ以降の別ファイルで、退院日が確定することがあります。その場合はファイルを跨いでいても正しく判定してください。

